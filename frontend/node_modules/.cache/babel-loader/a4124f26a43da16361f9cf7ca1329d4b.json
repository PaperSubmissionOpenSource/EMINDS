{"remainingRequest":"/Users/shengrui/Desktop/system_framework-main/frontend/node_modules/babel-loader/lib/index.js!/Users/shengrui/Desktop/system_framework-main/frontend/node_modules/eslint-loader/index.js??ref--13-0!/Users/shengrui/Desktop/system_framework-main/frontend/src/components/EventprogressionView/EventprogressionView.js?vue&type=script&lang=js&","dependencies":[{"path":"/Users/shengrui/Desktop/system_framework-main/frontend/src/components/EventprogressionView/EventprogressionView.js","mtime":1729690042937},{"path":"/Users/shengrui/Desktop/system_framework-main/frontend/node_modules/cache-loader/dist/cjs.js","mtime":1729690872023},{"path":"/Users/shengrui/Desktop/system_framework-main/frontend/node_modules/babel-loader/lib/index.js","mtime":1729690872396},{"path":"/Users/shengrui/Desktop/system_framework-main/frontend/node_modules/eslint-loader/index.js","mtime":1729690872072}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM3Lm9iamVjdC52YWx1ZXMiOwppbXBvcnQgX3R5cGVvZiBmcm9tICIvVXNlcnMvc2hlbmdydWkvRGVza3RvcC9zeXN0ZW1fZnJhbWV3b3JrLW1haW4vZnJvbnRlbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lLWNvcmVqczIvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM3LmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2LnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNy5zeW1ib2wuYXN5bmMtaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5zZXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lczYuc3RyaW5nLnN0YXJ0cy13aXRoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXM2Lm51bWJlci5jb25zdHJ1Y3RvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzNi5yZWdleHAuc3BsaXQiOwppbXBvcnQgZGF0YVNlcnZpY2UgZnJvbSAiLi4vLi4vc2VydmljZS9kYXRhU2VydmljZS5qcyI7CmltcG9ydCBwaXBlU2VydmljZSBmcm9tICIuLi8uLi9zZXJ2aWNlL3BpcGVTZXJ2aWNlLmpzIjsKaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnOwppbXBvcnQgJCwgeyBkYXRhIH0gZnJvbSAnanF1ZXJ5JzsKaW1wb3J0ICogYXMgU2Fua2V5IGZyb20gIi4uLy4uL2Fzc2V0cy9zYW5rZXkuanMiOwppbXBvcnQgeyBzbGlkZXJCb3R0b20sIHNsaWRlckxlZnQgfSBmcm9tICdkMy1zaW1wbGUtc2xpZGVyJzsKaW1wb3J0IHsgZm9ybWF0UHJlZml4LCBwYXRoLCBzY2hlbWVHbkJ1LCBzeW1ib2xEaWFtb25kMiB9IGZyb20gJ2QzJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdFdmVudHByb2dyZXNzaW9uVmlldycsCiAgY29tcG9uZW50czoge30sCiAgcHJvcHM6IHt9LAogIGNvbXB1dGVkOiB7fSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY29sb3JfYmFjazogIiNlOWVjZWYiLAogICAgICAvL3Nhbmtleeabsue6v+eahOminOiJsgogICAgICBjb2xvcl9iYWNrX2luZGl2aWR1YWw6ICIjQzNDM0M5IiwKICAgICAgLy/pq5jkuq7mm7Lnur/nmoTpopzoibIKICAgICAgb3BhY2l0eV9iYWNrOiAwLjYsCiAgICAgIGxpbmVfY29sb3I6ICcjMDAzMDQ5JywKICAgICAgc2Fua2V5X2xpbmVjb2xvcjogJyNkM2QzZDMnLAogICAgICBiYWNrZ3JvdW5kX2NvbG9yOiAnd2hpdGUnLAogICAgICBob3Zlcl9jb2xvcjogJyNDM0MzQzknLAogICAgICBwYXR0ZXJuX2RhdGE6IG5ldyBBcnJheSgpLAogICAgICBzZWdtZW50X2RhdGE6IG5ldyBBcnJheSgpLAogICAgICBzdGFydF9mbGFnOiAwLAogICAgICBiZXR0ZXJfY29sb3I6ICcjQURDMkJDJywKICAgICAgd29yc2VfY29sb3I6ICcjZjVjYWMzJywKICAgICAgYW5nbGVfY29sb3I6ICcjZTVlOWYyJywKICAgICAgLy/lm5vkuKrop5LnmoTpopzoibIKICAgICAgY29sb3JfbGlzdDogWyIjNzY4Zjg5IiwgIiNhZGI0OWYiLCAiI0VGRThCRCIsICIjZTlkMWI0IiwgIiNkZGJjYWIiLCAiI2QyYWFhMyJdLAogICAgICAvLyBjb2xvcl9saXN0OiBbIiNCNkI2QzYiLCAiI0FEQjlDMSIsICIjQUZCNUE0IiwgIiNFRkU4QkQiLCAiI2U5ZDFiNCIsICIjZDJhYWEzIl0sCiAgICAgIC8vIGNvbG9yX2xpc3Q6IFsiI2Y0ZjFkZSIsICIjZWFiNjlmIiwgIiNlMDdhNWYiLCAiIzNkNDA1YiIsICIjODFiMjlhIiwgIiNmMmNjOGYiXSwKICAgICAgLy8gY29sb3JfbGlzdDogWyIjMjY0NjUzIiwgIiMyYTlkOGYiLCAiI2U5YzQ2YSIsICIjZjRhMjYxIiwgIiNlNzZmNTEiLCAiI0UzQzZBOSJdLAogICAgICAvLyBjb2xvcl9saXN0OiBbIiNCNUI1QzUiLCAiI0UyQzlCMyIsICIjRUNDMEMwIiwgIiNDQUQ1QzMiLCAiIzlDQjhDRCIsICIjRTNDNkE5Il0sCiAgICAgIGFsbF9ub2RlczogW10sCiAgICAgIGRpdmlkZV9saW5lOiAnI2QwYjhhYycsCiAgICAgIG92ZXJhbGw6IDAsCiAgICAgIC8vIDDooajnpLrpu5jorqTpgInmi6nmn6XnnIvlhajlsYBiZXR0ZXIsIDHooajnpLrlhajlsYB3b3JzZe+8jC0x6KGo56S655uu5YmN5Zyo5bGV56S6YWxpZ27nmoRzYW5rZXkKICAgICAgeV9wb3NpdGlvbjoge30sCiAgICAgIHlfcG9zaXRpb25fYmluYXJ5OiB7fSwKICAgICAgdHJhbnNpdGlvbl9tYXA6IFtdLAogICAgICBleHRyYWN0ZWRfc2VxdWVuY2U6IFtdLAogICAgICAvL+WtmOWCqOWMheWQq+ivpWNsaWNrcGF0aOeahOW6j+WIlwogICAgICB3aWR0aF9iYXI6IDE1LAogICAgICB5X3NjYWxlX2g6IDAsCiAgICAgIGNsaWNrcGF0aDogJycKICAgIH07CiAgfSwKICB3YXRjaDogewogICAgc3RhcnRfZmxhZzogZnVuY3Rpb24gc3RhcnRfZmxhZygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChfdGhpcy5zdGFydF9mbGFnID09IDIpIHsKICAgICAgICBfdGhpcy5kcmF3ZXZlbnRwcm9ncmVzc2lvblNhbmtleShfdGhpcy5zZWdtZW50X2RhdGFbMF0sIF90aGlzLnNlZ21lbnRfZGF0YVsyXVswXSwgX3RoaXMucGF0dGVybl9kYXRhKTsKCiAgICAgICAgX3RoaXMuc3RhcnRfZmxhZyA9IDA7CiAgICAgIH0KICAgIH0sCiAgICBvdmVyYWxsOiBmdW5jdGlvbiBvdmVyYWxsKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgJCgnLnByb2dyZXNzaW9ub3ZlcnZpZXcnKS5yZW1vdmUoKTsKICAgICAgJCgnLm92ZXJhbGwtYmV0dGVyJykuYXR0cigiZmlsbCIsIF90aGlzLmJhY2tncm91bmRfY29sb3IpOwogICAgICAkKCcub3ZlcmFsbC13b3JzZScpLmF0dHIoImZpbGwiLCBfdGhpcy5iYWNrZ3JvdW5kX2NvbG9yKTsKCiAgICAgIGlmIChfdGhpcy5vdmVyYWxsID09IDAgfHwgX3RoaXMub3ZlcmFsbCA9PSAxKSB7CiAgICAgICAgcGlwZVNlcnZpY2UuZW1pdFBhdHRlcm5Ob25lKCJub25lIik7CiAgICAgIH0KCiAgICAgIGlmIChfdGhpcy5vdmVyYWxsID09IDApIHsKICAgICAgICAkKCcuY2xpY2twYXRodHJhbnNpdGlvbicpLnJlbW92ZSgpOwogICAgICAgICQoJy5vdmVyYWxsLWJldHRlcicpLmF0dHIoImZpbGwiLCBfdGhpcy5iZXR0ZXJfY29sb3IpOwoKICAgICAgICBfdGhpcy5kcmF3ZXZlbnRwcm9ncmVzc2lvblNhbmtleShfdGhpcy5zZWdtZW50X2RhdGFbMF0sIF90aGlzLnNlZ21lbnRfZGF0YVsyXVswXSwgX3RoaXMucGF0dGVybl9kYXRhKTsKICAgICAgfQoKICAgICAgaWYgKF90aGlzLm92ZXJhbGwgPT0gMSkgewogICAgICAgICQoJy5jbGlja3BhdGh0cmFuc2l0aW9uJykucmVtb3ZlKCk7CiAgICAgICAgJCgnLm92ZXJhbGwtd29yc2UnKS5hdHRyKCJmaWxsIiwgX3RoaXMud29yc2VfY29sb3IpOwoKICAgICAgICBfdGhpcy5kcmF3ZXZlbnRwcm9ncmVzc2lvblNhbmtleShfdGhpcy5zZWdtZW50X2RhdGFbMF0sIF90aGlzLnNlZ21lbnRfZGF0YVsyXVsxXSwgX3RoaXMucGF0dGVybl9kYXRhKTsKICAgICAgfQogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuZHJhd0xlZ2VuZFNlbGVjdCgpOwoKICAgIHBpcGVTZXJ2aWNlLm9uUGF0dGVybihmdW5jdGlvbiAocGF0dGVybl9kYXRhKSB7CiAgICAgIC8vY29uc29sZS5sb2coJyoqKioqKm9uUGF0dGVybioqKioqKicsIHBhdHRlcm5fZGF0YSkKICAgICAgX3RoaXMucGF0dGVybl9kYXRhWzBdID0gX3RoaXMuZGljTWFwKHBhdHRlcm5fZGF0YVswXSk7CiAgICAgIF90aGlzLnBhdHRlcm5fZGF0YVsxXSA9IF90aGlzLmxpc3RNYXAocGF0dGVybl9kYXRhWzFdKTsKICAgICAgX3RoaXMuc3RhcnRfZmxhZyA9IF90aGlzLnN0YXJ0X2ZsYWcgKyAxOwogICAgfSk7CiAgICBwaXBlU2VydmljZS5vblNlZ21lbnQoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coJyoqKioqKm9uU2VnbWVudCoqKioqKicsIGRhdGEpOyAvLyAqKioqKioqKm1hcCoqKioqKioKCiAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgMjsgdCsrKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhWzFdW3RdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGRhdGFbMV1bdF1baV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgZGF0YVsxXVt0XVtpXVtqXVszXSA9IF90aGlzLnN0YWdlTWFwKGRhdGFbMV1bdF1baV1bal1bM10pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yICh2YXIgX3QgPSAwOyBfdCA8IDI7IF90KyspIHsKICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgZGF0YVsyXVtfdF0ubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICBmb3IgKHZhciBfaiA9IDA7IF9qIDwgZGF0YVsyXVtfdF1bX2ldLmxlbmd0aDsgX2orKykgewogICAgICAgICAgICBmb3IgKHZhciBwID0gMDsgcCA8IGRhdGFbMl1bX3RdW19pXVtfal0ubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgICBkYXRhWzJdW190XVtfaV1bX2pdW3BdWzBdID0gX3RoaXMuc3RhZ2VNYXAoZGF0YVsyXVtfdF1bX2ldW19qXVtwXVswXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIF90aGlzLnNlZ21lbnRfZGF0YSA9IGRhdGE7CiAgICAgIF90aGlzLnN0YXJ0X2ZsYWcgPSBfdGhpcy5zdGFydF9mbGFnICsgMTsKICAgIH0pOwogICAgcGlwZVNlcnZpY2Uub25DbGlja1BhdGgoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgX3RoaXMub3ZlcmFsbCA9IC0xOwoKICAgICAgaWYgKGRhdGFbMV0gIT0gLTEpIHsKICAgICAgICBfdGhpcy50cmFuc2l0aW9uX21hcCA9IGRhdGFbMV07CiAgICAgICAgJCgiLmNsaWNrcGF0aHRyYW5zaXRpb24iKS5yZW1vdmUoKTsKICAgICAgICBfdGhpcy5jbGlja3BhdGggPSBkYXRhWzBdOwoKICAgICAgICBfdGhpcy5kcmF3S2V5UGF0aChfdGhpcy5zZWdtZW50X2RhdGFbMF0sIF90aGlzLnNlZ21lbnRfZGF0YVsyXSwgX3RoaXMucGF0dGVybl9kYXRhLCBkYXRhWzBdLCBkYXRhWzFdKTsKICAgICAgfQogICAgfSk7IC8vIHBpcGVTZXJ2aWNlLm9uU3RhZ2UoZnVuY3Rpb24gKG1zZykgewogICAgLy8gICAgIHZhciBkYXRhID0gbXNnWzJdCiAgICAvLyAgICAgdmFyIGFjdGl2ZV9rX21zZyA9IG1zZ1swXQogICAgLy8gICAgIHZhciBwYXNzaXZlX2tfbXNnID0gbXNnWzFdCiAgICAvLyAgICAgZGF0YSA9IGV2YWwoIigiICsgZGF0YSArICIpIikKICAgIC8vICAgICBfdGhpcy5kcmF3U3RhZ2UoYWN0aXZlX2tfbXNnLCBwYXNzaXZlX2tfbXNnLCBkYXRhKQogICAgLy8gfSkKCiAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KCIuZXZlbnRwcm9ncmVzc2lvbnZpZXdib2R5IikuYXBwZW5kKCJzdmciKS5hdHRyKCJ3aWR0aCIsIDg4MCkuYXR0cigiaGVpZ2h0IiwgNDUwKS5hdHRyKCJjbGFzcyIsICJldmVudHByb2dyZXNzaW9uIik7CiAgICB2YXIgc3ZnX2JvdW5kID0gc3ZnLmFwcGVuZCgnZycpLmF0dHIoIndpZHRoIiwgODgwKS5hdHRyKCJoZWlnaHQiLCA0NTApLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoMCwgLTMwKSIpOwogIH0sCiAgbWV0aG9kczogewogICAgbnVtYmVyMmxpdGVyYWxNYXA6IGZ1bmN0aW9uIG51bWJlcjJsaXRlcmFsTWFwKHN0YWdlKSB7CiAgICAgIGlmIChzdGFnZSA9PSAwKSB7CiAgICAgICAgcmV0dXJuICdhJzsKICAgICAgfQoKICAgICAgaWYgKHN0YWdlID09IDEpIHsKICAgICAgICByZXR1cm4gJ2InOwogICAgICB9CgogICAgICBpZiAoc3RhZ2UgPT0gMikgewogICAgICAgIHJldHVybiAnYyc7CiAgICAgIH0KCiAgICAgIGlmIChzdGFnZSA9PSAzKSB7CiAgICAgICAgcmV0dXJuICdkJzsKICAgICAgfQoKICAgICAgaWYgKHN0YWdlID09IDQpIHsKICAgICAgICByZXR1cm4gJ2UnOwogICAgICB9CgogICAgICBpZiAoc3RhZ2UgPT0gNSkgewogICAgICAgIHJldHVybiAnZic7CiAgICAgIH0KICAgIH0sCiAgICBkcmF3U3RhZ2VDb3B5OiBmdW5jdGlvbiBkcmF3U3RhZ2VDb3B5KGtleSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGtleV9saXN0ID0ga2V5LnNwbGl0KCIiKS5tYXAoTnVtYmVyKTsgLy8g5bCG5a2X56ym5Liy5ouG5YiG5Li65a2X56ym5pWw57uE77yM54S25ZCO5bCG5q+P5Liq5a2X56ym6L2s5o2i5Li65pWw5a2XCgogICAgICBjb25zb2xlLmxvZyhrZXlfbGlzdCk7CiAgICAgIGQzLnNlbGVjdCgnLnN0YWdlY29weXN2ZycpLnJlbW92ZSgpOwogICAgICB2YXIgdGFyZ2V0U1ZHID0gZDMuc2VsZWN0KCcuZXZlbnRwcm9ncmVzc2lvbicpLmFwcGVuZCgnZycpLmF0dHIoIndpZHRoIiwgMjUwKS5hdHRyKCJoZWlnaHQiLCAyMDApLmF0dHIoImNsYXNzIiwgInN0YWdlY29weXN2ZyIpLnN0eWxlKCd6LWluZGV4JywgMykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSg2MjAsIDI4MCknKTsKICAgICAgdGFyZ2V0U1ZHLmFwcGVuZCgncmVjdCcpLmF0dHIoJ3gnLCAwKS5hdHRyKCd5JywgMCkuYXR0cignd2lkdGgnLCAyNjApLmF0dHIoJ2hlaWdodCcsIDE0NykuYXR0cignZmlsbCcsICd3aGl0ZScpLmF0dHIoJ3N0cm9rZScsIF90aGlzLnNhbmtleV9saW5lY29sb3IpOwoKICAgICAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoaSkgewogICAgICAgIHZhciBzb3VyY2VHMSA9IGQzLnNlbGVjdCgnLnN0YWdlX3NpbmdsZScgKyBrZXlfbGlzdFtpXSk7CiAgICAgICAgdmFyIHNvdXJjZUcyID0gZDMuc2VsZWN0KCcuc3RhZ2VfaW50ZXJhY3Rpb24nICsga2V5X2xpc3RbaV0pOyAvLyDlsIbnm67moIdTVkflhYPntKDnmoTlpKflsI/orr7nva7kuLrkuI7mupA8Zz7lhYPntKDnm7jlkIwKCiAgICAgICAgdGFyZ2V0U1ZHLmF0dHIoIndpZHRoIiwgc291cmNlRzEuYXR0cigid2lkdGgiKSkuYXR0cigiaGVpZ2h0Iiwgc291cmNlRzEuYXR0cigiaGVpZ2h0IikpOyAvLyDlnKjnm67moIdTVkflhYPntKDkuK3liJvlu7rkuIDkuKrmlrDnmoQ8Zz7lhYPntKAKCiAgICAgICAgdmFyIHRhcmdldEcxID0gdGFyZ2V0U1ZHLmFwcGVuZCgiZyIpOwogICAgICAgIHZhciB0YXJnZXRHMiA9IHRhcmdldFNWRy5hcHBlbmQoImciKTsKICAgICAgICB0YXJnZXRHMS5odG1sKHNvdXJjZUcxLmh0bWwoKSkuYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKGtleS5sZW5ndGggPT0gMykgewogICAgICAgICAgICByZXR1cm4gInNjYWxlKDAuNikgdHJhbnNsYXRlKCIgKyAoMjAgKyBpICogMTMwKSArICIsIDApIjsKICAgICAgICAgIH0gZWxzZSBpZiAoa2V5Lmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgIHJldHVybiAic2NhbGUoMC42KSB0cmFuc2xhdGUoIiArICg2MCArIGkgKiAxNzApICsgIiwgMCkiOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICJzY2FsZSgwLjYpIHRyYW5zbGF0ZSgxNDAsIDApIjsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0YXJnZXRHMi5odG1sKHNvdXJjZUcyLmh0bWwoKSkuYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKGtleS5sZW5ndGggPT0gMykgewogICAgICAgICAgICByZXR1cm4gInNjYWxlKDAuNikgdHJhbnNsYXRlKCIgKyAoMjAgKyBpICogMTMwKSArICIsIDApIjsKICAgICAgICAgIH0gZWxzZSBpZiAoa2V5Lmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgIHJldHVybiAic2NhbGUoMC42KSB0cmFuc2xhdGUoIiArICg2MCArIGkgKiAxNzApICsgIiwgMCkiOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICJzY2FsZSgwLjYpIHRyYW5zbGF0ZSgxNDAsIDApIjsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgX2xvb3AoaSk7CiAgICAgIH0KICAgIH0sCiAgICBsaXN0TWFwOiBmdW5jdGlvbiBsaXN0TWFwKGxzdCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHJlc3VsdCA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgdGVtcF90ID0gbHN0W2ldOwogICAgICAgIHZhciB0ZW1wX24gPSAnJzsKCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0ZW1wX3QubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIHRlbXBfbiArPSBfdGhpcy5zdGFnZU1hcChwYXJzZUludCh0ZW1wX3Rbal0pKS50b1N0cmluZygpOwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0LnB1c2godGVtcF9uKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCiAgICBkaWNNYXA6IGZ1bmN0aW9uIGRpY01hcChkaWMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoZGljKTsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGtfdCA9IGtleXNbaV07CiAgICAgICAgdmFyIGtfbiA9ICcnOwoKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGtfdC5sZW5ndGg7IGorKykgewogICAgICAgICAga19uICs9IF90aGlzLnN0YWdlTWFwKHBhcnNlSW50KGtfdFtqXSkpLnRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICByZXN1bHRba19uXSA9IGRpY1trX3RdOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKICAgIHN0YWdlTWFwOiBmdW5jdGlvbiBzdGFnZU1hcChzdGFnZSkgewogICAgICBpZiAoc3RhZ2UgPT0gMCkgewogICAgICAgIHJldHVybiAyOwogICAgICB9CgogICAgICBpZiAoc3RhZ2UgPT0gMSkgewogICAgICAgIHJldHVybiA0OwogICAgICB9CgogICAgICBpZiAoc3RhZ2UgPT0gMikgewogICAgICAgIHJldHVybiAwOwogICAgICB9CgogICAgICBpZiAoc3RhZ2UgPT0gMykgewogICAgICAgIHJldHVybiAxOwogICAgICB9CgogICAgICBpZiAoc3RhZ2UgPT0gNCkgewogICAgICAgIHJldHVybiAzOwogICAgICB9CgogICAgICBpZiAoc3RhZ2UgPT0gNSkgewogICAgICAgIHJldHVybiA1OwogICAgICB9CiAgICB9LAogICAgZHJhd0xlZ2VuZFNlbGVjdDogZnVuY3Rpb24gZHJhd0xlZ2VuZFNlbGVjdCgpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoIi5wcm9ncmVzc2lvbnZpZXdoZWFkZXIiKS5hcHBlbmQoInN2ZyIpLmF0dHIoIndpZHRoIiwgNzUwKS5hdHRyKCJoZWlnaHQiLCAyMCk7CiAgICAgIHZhciBnX2xlZ2VuZCA9IHN2Zy5hcHBlbmQoJ2cnKTsKICAgICAgZ19sZWdlbmQuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsIDIwKS5hdHRyKCJ5IiwgMykuYXR0cigid2lkdGgiLCAxMCkuYXR0cigiaGVpZ2h0IiwgMTApLmF0dHIoImZpbGwiLCBfdGhpcy5iZXR0ZXJfY29sb3IpLmF0dHIoInN0cm9rZSIsICJibGFjayIpLm9uKCJjbGljayIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy5vdmVyYWxsID0gMDsKICAgICAgfSkuYXR0cigiY2xhc3MiLCAib3ZlcmFsbC1iZXR0ZXIiKTsKICAgICAgZ19sZWdlbmQuYXBwZW5kKCJ0ZXh0IikuYXR0cigieCIsIDM1KS5hdHRyKCJ5IiwgMTMpLmF0dHIoImZvbnQtc2l6ZSIsIDEzKS50ZXh0KCJncm91cDEiKTsKICAgICAgZ19sZWdlbmQuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsIDgyKS5hdHRyKCJ5IiwgMykuYXR0cigid2lkdGgiLCAxMCkuYXR0cigiaGVpZ2h0IiwgMTApLmF0dHIoImZpbGwiLCBfdGhpcy5iYWNrZ3JvdW5kX2NvbG9yKS5hdHRyKCJzdHJva2UiLCAiYmxhY2siKS5vbigiY2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMub3ZlcmFsbCA9IDE7CiAgICAgIH0pLmF0dHIoImNsYXNzIiwgIm92ZXJhbGwtd29yc2UiKTsKICAgICAgZ19sZWdlbmQuYXBwZW5kKCJ0ZXh0IikuYXR0cigieCIsIDk3KS5hdHRyKCJ5IiwgMTMpLmF0dHIoImZvbnQtc2l6ZSIsIDEzKS50ZXh0KCJncm91cDIiKTsKICAgICAgZ19sZWdlbmQuYXBwZW5kKCJjaXJjbGUiKS5hdHRyKCJjeCIsIDc0MSkuYXR0cigiY3kiLCA3KS5hdHRyKCJyIiwgNSkuYXR0cigiZmlsbCIsICJ3aGl0ZSIpLmF0dHIoInN0cm9rZSIsICJyZWQiKTsKICAgICAgZ19sZWdlbmQuYXBwZW5kKCJ0ZXh0IikuYXR0cigieCIsIDczOCkuYXR0cigieSIsIDEwKS5hdHRyKCJmb250LXNpemUiLCA4KS50ZXh0KCI/IikuYXR0cigiZmlsbCIsICIjYmM0YjUxIik7CiAgICB9LAogICAgZHJhd0xlZ2VuZDogZnVuY3Rpb24gZHJhd0xlZ2VuZChzdGFnZV9udW1iZXIpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoIi5wcm9ncmVzc2lvbnZpZXdoZWFkZXIiKS5hcHBlbmQoInN2ZyIpLmF0dHIoIndpZHRoIiwgNjAwKS5hdHRyKCJoZWlnaHQiLCAyMCk7CiAgICAgIHZhciBkb21haW5feCA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGFnZV9udW1iZXI7IGkrKykgewogICAgICAgIGRvbWFpbl94LnB1c2goaSk7CiAgICAgIH0KCiAgICAgIHZhciBjb2xvciA9IGQzLnNjYWxlT3JkaW5hbCgpLmRvbWFpbihkb21haW5feCkucmFuZ2UoX3RoaXMuY29sb3JfbGlzdCk7CiAgICAgIHZhciBnX2xlZ2VuZCA9IHN2Zy5hcHBlbmQoJ2cnKTsKCiAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgc3RhZ2VfbnVtYmVyOyBjKyspIHsKICAgICAgICBzdmcuYXBwZW5kKCJjaXJjbGUiKS5hdHRyKCJjeCIsIDIyICsgYyAqIDgwKS5hdHRyKCJjeSIsIDEwKS5hdHRyKCJyIiwgNykuYXR0cigiZmlsbCIsIGNvbG9yKGMpKS5hdHRyKCJzdHJva2UiLCAiIzViNWI1YiIpOwogICAgICAgIHN2Zy5hcHBlbmQoInRleHQiKS5hdHRyKCJ4IiwgMzUgKyBjICogODApLmF0dHIoInkiLCAxNCkuYXR0cigiZm9udC1zaXplIiwgMTMpLnRleHQoInN0YWdlICIgKyAoYyArIDEpKTsKICAgICAgfQogICAgfSwKICAgIHNwbGl0U3RyaW5nOiBmdW5jdGlvbiBzcGxpdFN0cmluZyhTLCBQKSB7CiAgICAgIHZhciByZXN1bHQgPSBbXTsKCiAgICAgIHdoaWxlIChTLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgc2VnbWVudCA9ICcnOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IFAubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChTLnN0YXJ0c1dpdGgoUFtpXSkpIHsKICAgICAgICAgICAgaWYgKFBbaV0ubGVuZ3RoID4gc2VnbWVudC5sZW5ndGgpIHsKICAgICAgICAgICAgICBzZWdtZW50ID0gUFtpXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNlZ21lbnQgPT09ICcnKSB7CiAgICAgICAgICAvLyDlpoLmnpzmib7kuI3liLDljLnphY3nmoRwYXR0ZXJu77yM6K+05piO5peg5rOV5YiG6Kej5a2X56ym5LiyCiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHJlc3VsdC5wdXNoKHNlZ21lbnQpOwogICAgICAgIFMgPSBTLnNsaWNlKHNlZ21lbnQubGVuZ3RoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCiAgICBqdWRnZVN1YlN0cmluZzogZnVuY3Rpb24ganVkZ2VTdWJTdHJpbmcocGFyZW50U3RyaW5nLCBzdWJTdHJpbmcpIHsKICAgICAgdmFyIGZsYWcgPSAwOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJlbnRTdHJpbmcubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAocGFyZW50U3RyaW5nW2ldID09IHN1YlN0cmluZ1swXSkgewogICAgICAgICAgdmFyIGZsYWdfdGVtcCA9IDE7CgogICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzdWJTdHJpbmcubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgaWYgKHBhcmVudFN0cmluZ1tpICsgal0gIT0gc3ViU3RyaW5nW2pdKSB7CiAgICAgICAgICAgICAgZmxhZ190ZW1wID0gMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZsYWcgPSBmbGFnX3RlbXA7CgogICAgICAgICAgaWYgKGZsYWcgPT0gMSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICBmaW5kU3Vic3RyaW5nUG9zaXRpb25zOiBmdW5jdGlvbiBmaW5kU3Vic3RyaW5nUG9zaXRpb25zKHN0ciwgc3Vic3RyKSB7CiAgICAgIHZhciBwb3NpdGlvbnMgPSBbXTsKICAgICAgdmFyIHBvcyA9IHN0ci5pbmRleE9mKHN1YnN0cik7CgogICAgICB3aGlsZSAocG9zICE9PSAtMSkgewogICAgICAgIHBvc2l0aW9ucy5wdXNoKHBvcyk7CiAgICAgICAgcG9zID0gc3RyLmluZGV4T2Yoc3Vic3RyLCBwb3MgKyAxKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc2l0aW9uczsKICAgIH0sCiAgICBkcmF3S2V5UGF0aDogZnVuY3Rpb24gZHJhd0tleVBhdGgoc3RhZ2VfbnVtYmVyLCBzZWdtZW50X2RhdGEsIHBhdHRlcm5fZGF0YSwgY2xpY2twYXRoLCBwYXRoX2RhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoIi5ldmVudHByb2dyZXNzaW9uIikuYXBwZW5kKCJnIikuYXR0cigiY2xhc3MiLCAic3ZnIikuYXR0cigid2lkdGgiLCA4MDApLmF0dHIoImhlaWdodCIsIDQ1MCkuYXR0cigiY2xhc3MiLCAiY2xpY2twYXRodHJhbnNpdGlvbiIpLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoMCwgMCkiKTsgLy8g6aaW5YWI5Zyo5bqP5YiX5pWw5o2u5LitZXh0YXJjdOWHuuaJgOacieWMheWQq2NsaWNrcGF0aOeahOi3r+W+hAoKICAgICAgdmFyIGRhdGFfc2VxdWVuY2UgPSBbXTsKICAgICAgdmFyIGRhdGFfc3RyaW5nID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlZ21lbnRfZGF0YVswXS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciB0ZW1wX2luZGl2aWR1YWwgPSBbXTsKICAgICAgICB2YXIgdGVtcF9zdHJpbmcgPSAnJzsKCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzZWdtZW50X2RhdGFbMF1baV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIHRlbXBfaW5kaXZpZHVhbC5wdXNoKHBhcnNlSW50KHNlZ21lbnRfZGF0YVswXVtpXVtqXVswXSkpOwogICAgICAgICAgdGVtcF9zdHJpbmcgPSB0ZW1wX3N0cmluZyArIHNlZ21lbnRfZGF0YVswXVtpXVtqXVswXTsKICAgICAgICB9CgogICAgICAgIGRhdGFfc2VxdWVuY2UucHVzaCh0ZW1wX2luZGl2aWR1YWwpOwogICAgICAgIGRhdGFfc3RyaW5nLnB1c2godGVtcF9zdHJpbmcpOwogICAgICB9CgogICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCBzZWdtZW50X2RhdGFbMV0ubGVuZ3RoOyBfaTIrKykgewogICAgICAgIHZhciBfdGVtcF9pbmRpdmlkdWFsID0gW107CiAgICAgICAgdmFyIF90ZW1wX3N0cmluZyA9ICcnOwoKICAgICAgICBmb3IgKHZhciBfajIgPSAwOyBfajIgPCBzZWdtZW50X2RhdGFbMV1bX2kyXS5sZW5ndGg7IF9qMisrKSB7CiAgICAgICAgICBfdGVtcF9pbmRpdmlkdWFsLnB1c2gocGFyc2VJbnQoc2VnbWVudF9kYXRhWzFdW19pMl1bX2oyXVswXSkpOwoKICAgICAgICAgIF90ZW1wX3N0cmluZyA9IF90ZW1wX3N0cmluZyArIHNlZ21lbnRfZGF0YVsxXVtfaTJdW19qMl1bMF07CiAgICAgICAgfQoKICAgICAgICBkYXRhX3NlcXVlbmNlLnB1c2goX3RlbXBfaW5kaXZpZHVhbCk7CiAgICAgICAgZGF0YV9zdHJpbmcucHVzaChfdGVtcF9zdHJpbmcpOwogICAgICB9IC8vIGV4dHJhY3Tlh7rmiYDmnInljIXmi6zor6XlrZDluo/liJfnmoTluo/liJcKCgogICAgICB2YXIgZGF0YV9leHRyYWN0ZWQgPSBbXTsKCiAgICAgIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IGRhdGFfc3RyaW5nLmxlbmd0aDsgX2kzKyspIHsKICAgICAgICBpZiAoX3RoaXMuanVkZ2VTdWJTdHJpbmcoZGF0YV9zdHJpbmdbX2kzXSwgY2xpY2twYXRoKSkgewogICAgICAgICAgZGF0YV9leHRyYWN0ZWQucHVzaChkYXRhX3N0cmluZ1tfaTNdKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBwYXRoX2xhdHRlciA9IFtdOwogICAgICB2YXIgcGF0aF9mb3JtZXIgPSBbXTsKICAgICAgdmFyIGV4dHJhY3RlZF9zZXF1ZW5jZSA9IFtdOwoKICAgICAgZm9yICh2YXIgX2k0ID0gMDsgX2k0IDwgZGF0YV9leHRyYWN0ZWQubGVuZ3RoOyBfaTQrKykgewogICAgICAgIC8vIOmmluWFiOimgeaJvuWIsGNsaWNrcGF0aOWHuueOsOeahOS9jee9rgogICAgICAgIHZhciBwb3NpdGlvbnMgPSBfdGhpcy5maW5kU3Vic3RyaW5nUG9zaXRpb25zKGRhdGFfZXh0cmFjdGVkW19pNF0sIGNsaWNrcGF0aCk7CgogICAgICAgIGZvciAodmFyIF9qMyA9IDA7IF9qMyA8IHBvc2l0aW9ucy5sZW5ndGg7IF9qMysrKSB7CiAgICAgICAgICBpZiAocG9zaXRpb25zW19qM10gPT0gMCB8fCBwb3NpdGlvbnNbX2ozXSArIGNsaWNrcGF0aC5sZW5ndGggPT0gZGF0YV9leHRyYWN0ZWRbX2k0XS5sZW5ndGgpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDnhLblkI7miopjbGlja3BhdGjliY3lkI7ot6/lvoTliIbop6PmjokKICAgICAgICAgICAgdmFyIGZfdGVtcCA9IGRhdGFfZXh0cmFjdGVkW19pNF0uc3Vic3RyaW5nKDAsIHBvc2l0aW9uc1tfajNdKTsKCiAgICAgICAgICAgIHZhciBsX3RlbXAgPSBkYXRhX2V4dHJhY3RlZFtfaTRdLnN1YnN0cmluZyhwb3NpdGlvbnNbX2ozXSArIGNsaWNrcGF0aC5sZW5ndGgsIGRhdGFfZXh0cmFjdGVkW19pNF0ubGVuZ3RoKTsKCiAgICAgICAgICAgIHZhciBmX3RlbXBfc2VnbWVudCA9IF90aGlzLnNwbGl0U3RyaW5nKGZfdGVtcCwgcGF0dGVybl9kYXRhWzFdKTsKCiAgICAgICAgICAgIHZhciBsX3RlbXBfc2VnbWVudCA9IF90aGlzLnNwbGl0U3RyaW5nKGxfdGVtcCwgcGF0dGVybl9kYXRhWzFdKTsKCiAgICAgICAgICAgIHBhdGhfZm9ybWVyLnB1c2goZl90ZW1wX3NlZ21lbnQpOwogICAgICAgICAgICBwYXRoX2xhdHRlci5wdXNoKGxfdGVtcF9zZWdtZW50KTsKICAgICAgICAgICAgZXh0cmFjdGVkX3NlcXVlbmNlLnB1c2goW190aGlzLnNwbGl0U3RyaW5nKGZfdGVtcCwgcGF0dGVybl9kYXRhWzFdKSwgX3RoaXMuc3BsaXRTdHJpbmcobF90ZW1wLCBwYXR0ZXJuX2RhdGFbMV0pXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgdHJlZV9mb3JtZXIgPSBfdGhpcy5jcmVhdGVUcmVlRnJvbVNlcXVlbmNlcyhwYXRoX2Zvcm1lcik7CgogICAgICB2YXIgdHJlZV9sYXR0ZXIgPSBfdGhpcy5jcmVhdGVUcmVlRnJvbVNlcXVlbmNlcyhwYXRoX2xhdHRlcik7CgogICAgICB2YXIgZG9tYWluX3ggPSBbXTsKCiAgICAgIGZvciAodmFyIF9pNSA9IDA7IF9pNSA8IHN0YWdlX251bWJlcjsgX2k1KyspIHsKICAgICAgICBkb21haW5feC5wdXNoKF9pNSk7CiAgICAgIH0KCiAgICAgIHZhciBjb2xvciA9IGQzLnNjYWxlT3JkaW5hbCgpLmRvbWFpbihkb21haW5feCkucmFuZ2UoX3RoaXMuY29sb3JfbGlzdCk7CiAgICAgIHZhciBsaW5lR2VuZXJhdG9yID0gZDMubGluZSgpLngoZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4gZC54OwogICAgICB9KS55KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgcmV0dXJuIGQueTsKICAgICAgfSkuY3VydmUoZDMuY3VydmVDYXRtdWxsUm9tLmFscGhhKDAuNSkpOyAvLyDnlLvkuK3pl7QKCiAgICAgIHZhciB3aWR0aCA9IDg0MDsKICAgICAgdmFyIGhlaWdodCA9IDI1MCAqIDEuMzsKICAgICAgdmFyIHdpZHRoX2JhciA9IDE1OwogICAgICB2YXIgZnJlcXVlbmN5X2NlbnRlciA9IHBhdGhfZm9ybWVyLmxlbmd0aDsKICAgICAgdmFyIHlfc2NhbGVfaCA9IGhlaWdodCAvIGZyZXF1ZW5jeV9jZW50ZXI7CiAgICAgIF90aGlzLnlfc2NhbGVfaCA9IHlfc2NhbGVfaDsKICAgICAgdmFyIHN2Z19jZW50ZXIgPSBzdmcuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnY2VudGVyJyk7CiAgICAgIHN2Z19jZW50ZXIuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsIHdpZHRoIC8gMiAtIDUpLmF0dHIoInkiLCAyMCkuYXR0cigid2lkdGgiLCB3aWR0aF9iYXIgKiAyICsgMTApLmF0dHIoImhlaWdodCIsIGhlaWdodCArIDEwKS5hdHRyKCJmaWxsIiwgIm5vbmUiKS5hdHRyKCJzdHJva2UiLCBfdGhpcy5jb2xvcl9iYWNrKS5hdHRyKCJvcGFjaXR5IiwgX3RoaXMub3BhY2l0eV9iYWNrKTsKICAgICAgdmFyIHlfc3RhcnRfYmFyID0gMjU7CgogICAgICBmb3IgKHZhciBfaTYgPSAwOyBfaTYgPCBjbGlja3BhdGgubGVuZ3RoOyBfaTYrKykgewogICAgICAgIHZhciB4X3N0YXJ0X3RlbXAgPSB3aWR0aCAvIDIgKyBfaTYgKiB3aWR0aF9iYXIgKiAyIC8gY2xpY2twYXRoLmxlbmd0aDsKCiAgICAgICAgaWYgKGNsaWNrcGF0aC5sZW5ndGggPT0gMSkgewogICAgICAgICAgeF9zdGFydF90ZW1wID0gd2lkdGggLyAyICsgX2k2ICogd2lkdGhfYmFyICsgNzsKICAgICAgICB9CgogICAgICAgIHN2Z19jZW50ZXIuYXBwZW5kKCdyZWN0JykuYXR0cigneCcsIHhfc3RhcnRfdGVtcCkuYXR0cigneScsIHlfc3RhcnRfYmFyKS5hdHRyKCd3aWR0aCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChjbGlja3BhdGgubGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gd2lkdGhfYmFyOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIDIgLyBjbGlja3BhdGgubGVuZ3RoICogd2lkdGhfYmFyOwogICAgICAgICAgfQogICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIHlfc2NhbGVfaCAqIGZyZXF1ZW5jeV9jZW50ZXIpLmF0dHIoJ2ZpbGwnLCBjb2xvcihwYXJzZUludChjbGlja3BhdGhbX2k2XSkpKS5hdHRyKCdzdHJva2UnLCAnd2hpdGUnKS5hdHRyKCdjbGFzcycsICdjZW50ZXIta2V5Jykub24oJ21vdXNlZW50ZXInLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkKCcuY2VudGVyLWtleScpLmF0dHIoJ3N0cm9rZScsIF90aGlzLmhvdmVyX2NvbG9yKS5hdHRyKCdzdHJva2Utd2lkdGgnLCAzKTsKICAgICAgICAgICQoJy5jZW50ZXItaG92ZXInKS5hdHRyKCd2aXNpYmlsaXR5JywgJ3Zpc2FibGUnKTsgLy9jb25zb2xlLmxvZygnVGVzdDEtZHJhd1N0YWdlQ29weScsIGNsaWNrcGF0aCkKCiAgICAgICAgICBfdGhpcy5kcmF3U3RhZ2VDb3B5KGNsaWNrcGF0aCk7CiAgICAgICAgfSkub24oJ21vdXNlbGVhdmUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkKCcuY2VudGVyLWtleScpLmF0dHIoJ3N0cm9rZScsICd3aGl0ZScpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDAuNSk7CiAgICAgICAgICAkKCcuY2VudGVyLWhvdmVyJykuYXR0cigndmlzaWJpbGl0eScsICdoaWRkZW4nKTsKICAgICAgICAgIGQzLnNlbGVjdCgnLnN0YWdlY29weXN2ZycpLnJlbW92ZSgpOwogICAgICAgIH0pOwogICAgICB9IC8vIOeUu+S4reW/g2hvdmVy5Zu+5qCHCgoKICAgICAgdmFyIHN2Z19jZW50ZXJfaG92ZXIgPSBzdmdfY2VudGVyLmFwcGVuZCgnZycpLmF0dHIoImNsYXNzIiwgImNlbnRlci1ob3ZlciIpLmF0dHIoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7CiAgICAgIHN2Z19jZW50ZXJfaG92ZXIuYXBwZW5kKCdyZWN0JykuYXR0cigneCcsIHdpZHRoIC8gMiAtIHdpZHRoX2JhciAqIDMpLmF0dHIoJ3knLCBoZWlnaHQgLyAyKS5hdHRyKCd3aWR0aCcsIDEyMCkuYXR0cignaGVpZ2h0JywgMzApLmF0dHIoJ2ZpbGwnLCAnd2hpdGUnKS5hdHRyKCdzdHJva2UnLCAnI2QzZDNkMycpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDAuNSk7CiAgICAgIHZhciBkZWdyZWUgPSBfdGhpcy5wYXR0ZXJuX2RhdGFbMF1bY2xpY2twYXRoXTsKICAgICAgc3ZnX2NlbnRlcl9ob3Zlci5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4Iiwgd2lkdGggLyAyKS5hdHRyKCJ5IiwgaGVpZ2h0IC8gMiArIDUpLmF0dHIoIndpZHRoIiwgMzIpLmF0dHIoImhlaWdodCIsIDIwKS5hdHRyKCJzdHJva2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGRlZ3JlZVswXSA+IGRlZ3JlZVsxXSkgewogICAgICAgICAgcmV0dXJuIF90aGlzLmJldHRlcl9jb2xvcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIF90aGlzLndvcnNlX2NvbG9yOwogICAgICAgIH0KICAgICAgfSkuYXR0cigiZmlsbCIsICJub25lIik7CiAgICAgIHN2Z19jZW50ZXJfaG92ZXIuYXBwZW5kKCJ0ZXh0IikuYXR0cigieCIsIHdpZHRoIC8gMiArIDEpLmF0dHIoInkiLCBoZWlnaHQgLyAyICsgMjApLmF0dHIoImZvbnQtc2l6ZSIsIDE1KS50ZXh0KGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gTWF0aC5hYnMoKGRlZ3JlZVswXSAtIGRlZ3JlZVsxXSkgKiAxMDApLnRvRml4ZWQoMSk7CiAgICAgIH0pLmF0dHIoImZpbGwiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGRlZ3JlZVswXSA+IGRlZ3JlZVsxXSkgewogICAgICAgICAgcmV0dXJuIF90aGlzLmJldHRlcl9jb2xvcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIF90aGlzLndvcnNlX2NvbG9yOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHZhciBwYXRoX3RyYW5zaXRpb25fZm9ybWVyID0gX3RoaXMudHJhbnNpdGlvbl9tYXBbY2xpY2twYXRoXVswXTsKICAgICAgdmFyIHBhdGhfdHJhbnNpdGlvbl9sYXR0ZXIgPSBfdGhpcy50cmFuc2l0aW9uX21hcFtjbGlja3BhdGhdWzFdOwogICAgICBzdmdfY2VudGVyX2hvdmVyLmFwcGVuZCgicmVjdCIpLmF0dHIoIngiLCB3aWR0aCAvIDIgLSAzOCkuYXR0cigieSIsIGhlaWdodCAvIDIgKyA1KS5hdHRyKCJ3aWR0aCIsIDMyKS5hdHRyKCJoZWlnaHQiLCAyMCAqIHBhdGhfdHJhbnNpdGlvbl9mb3JtZXJbMF0pLmF0dHIoInN0cm9rZSIsICdub25lJykuYXR0cigiZmlsbCIsIF90aGlzLmJldHRlcl9jb2xvcik7CiAgICAgIHN2Z19jZW50ZXJfaG92ZXIuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsIHdpZHRoIC8gMiAtIDM4KS5hdHRyKCJ5IiwgaGVpZ2h0IC8gMiArIDUgKyAyMCAqIHBhdGhfdHJhbnNpdGlvbl9mb3JtZXJbMF0pLmF0dHIoIndpZHRoIiwgMzIpLmF0dHIoImhlaWdodCIsIDIwICogcGF0aF90cmFuc2l0aW9uX2Zvcm1lclsxXSkuYXR0cigic3Ryb2tlIiwgJ25vbmUnKS5hdHRyKCJmaWxsIiwgX3RoaXMud29yc2VfY29sb3IpOwogICAgICBzdmdfY2VudGVyX2hvdmVyLmFwcGVuZCgicmVjdCIpLmF0dHIoIngiLCB3aWR0aCAvIDIgKyAzOCkuYXR0cigieSIsIGhlaWdodCAvIDIgKyA1KS5hdHRyKCJ3aWR0aCIsIDMyKS5hdHRyKCJoZWlnaHQiLCAyMCAqIHBhdGhfdHJhbnNpdGlvbl9sYXR0ZXJbMF0pLmF0dHIoInN0cm9rZSIsICdub25lJykuYXR0cigiZmlsbCIsIF90aGlzLmJldHRlcl9jb2xvcik7CiAgICAgIHN2Z19jZW50ZXJfaG92ZXIuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsIHdpZHRoIC8gMiArIDM4KS5hdHRyKCJ5IiwgaGVpZ2h0IC8gMiArIDUgKyAyMCAqIHBhdGhfdHJhbnNpdGlvbl9sYXR0ZXJbMF0pLmF0dHIoIndpZHRoIiwgMzIpLmF0dHIoImhlaWdodCIsIDIwICogcGF0aF90cmFuc2l0aW9uX2xhdHRlclsxXSkuYXR0cigic3Ryb2tlIiwgJ25vbmUnKS5hdHRyKCJmaWxsIiwgX3RoaXMud29yc2VfY29sb3IpOyAvLyDnlLvnrKxp5bGC6Lev5b6E77yM55S75Ye65p2l5bm25LiU6L+U5Zue5q+P5LiA5Liq5paw54q25oCB55qE5byA5aeL6IqC54K55ZKM57uT5p2f6IqC54K5CgogICAgICBmb3IgKHZhciBfaTcgPSAxOyBfaTcgPCA1OyBfaTcrKykgewogICAgICAgIGZvciAodmFyIF9qNCA9IDA7IF9qNCA8IDI7IF9qNCsrKSB7CiAgICAgICAgICB2YXIgdHlwZSA9ICcnOwogICAgICAgICAgX3RoaXMuYWxsX25vZGVzID0gW107CiAgICAgICAgICB2YXIgX3hfc3RhcnRfdGVtcCA9IDA7CgogICAgICAgICAgaWYgKF9qNCA9PSAxKSB7CiAgICAgICAgICAgIHR5cGUgPSAnbGF0dGVyJzsKCiAgICAgICAgICAgIF90aGlzLm9idGFpblN1YlBhdGgodHJlZV9sYXR0ZXIsIF9pNyk7CgogICAgICAgICAgICBfeF9zdGFydF90ZW1wID0gd2lkdGggLyAyICsgX2k3ICogd2lkdGhfYmFyICogNi44OwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdHlwZSA9ICdmb3JtZXInOwoKICAgICAgICAgICAgX3RoaXMub2J0YWluU3ViUGF0aCh0cmVlX2Zvcm1lciwgX2k3KTsKCiAgICAgICAgICAgIF94X3N0YXJ0X3RlbXAgPSB3aWR0aCAvIDIgLSBfaTcgKiB3aWR0aF9iYXIgKiA2Ljg7CiAgICAgICAgICB9IC8vIGo9MOihqOekuueUu2xhdHRlcu+8jGo9MeihqOekuueUu2Zvcm1lcgoKCiAgICAgICAgICB2YXIgc3ZnX3RlbXAgPSBzdmcuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCB0eXBlICsgX2k3KTsKCiAgICAgICAgICB2YXIgX3BhdGggPSBfdGhpcy5zb3J0QXJyYXkoX3RoaXMuYWxsX25vZGVzLCBwYXR0ZXJuX2RhdGEpOwoKICAgICAgICAgIHZhciB0X3N1bSA9IDA7CgogICAgICAgICAgZm9yICh2YXIgdHQgPSAwOyB0dCA8IF90aGlzLmFsbF9ub2Rlcy5sZW5ndGg7IHR0KyspIHsKICAgICAgICAgICAgdF9zdW0gKz0gX3RoaXMuYWxsX25vZGVzW3R0XVsxXTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgeV9zdGFydF90ZW1wID0gMjU7CiAgICAgICAgICB2YXIgcGF0aF90ZW1wID0gcGF0aF9mb3JtZXI7CgogICAgICAgICAgaWYgKHR5cGUgPT0gJ2xhdHRlcicpIHsKICAgICAgICAgICAgcGF0aF90ZW1wID0gcGF0aF9sYXR0ZXI7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMuZHJhd1BhdGgoX3BhdGgsIHN2Z190ZW1wLCBfeF9zdGFydF90ZW1wLCB5X3N0YXJ0X3RlbXAsIHN0YWdlX251bWJlciwgeV9zY2FsZV9oLCBjb2xvciwgd2lkdGgsIHdpZHRoX2JhciwgdHlwZSArIF9pNywgcGF0aF90ZW1wLCBleHRyYWN0ZWRfc2VxdWVuY2UpOwogICAgICAgIH0KICAgICAgfSAvLyDnlLvmr4/kuKTlsYLkuYvpl7TnmoRsaW5rCgoKICAgICAgZm9yICh2YXIgX2k4ID0gMDsgX2k4IDwgcGF0aF9mb3JtZXIubGVuZ3RoOyBfaTgrKykgewogICAgICAgIHBhdGhfZm9ybWVyW19pOF0udW5zaGlmdChjbGlja3BhdGgpOwogICAgICB9CgogICAgICBmb3IgKHZhciBfaTkgPSAwOyBfaTkgPCBwYXRoX2xhdHRlci5sZW5ndGg7IF9pOSsrKSB7CiAgICAgICAgcGF0aF9sYXR0ZXJbX2k5XS51bnNoaWZ0KGNsaWNrcGF0aCk7CiAgICAgIH0KCiAgICAgIF90aGlzLnlfcG9zaXRpb25fYmluYXJ5WydsYXR0ZXInICsgMCArICctYmV0dGVyJ10gPSBbd2lkdGggLyAyIC0gNSwgeV9zdGFydF9iYXJdOwogICAgICBfdGhpcy55X3Bvc2l0aW9uX2JpbmFyeVsnZm9ybWVyJyArIDAgKyAnLWJldHRlciddID0gW3dpZHRoIC8gMiAtIDUsIHlfc3RhcnRfYmFyXTsKICAgICAgX3RoaXMueV9wb3NpdGlvbl9iaW5hcnlbJ2xhdHRlcicgKyAwICsgJy13b3JzZSddID0gW3dpZHRoIC8gMiAtIDUsIHlfc3RhcnRfYmFyXTsKICAgICAgX3RoaXMueV9wb3NpdGlvbl9iaW5hcnlbJ2Zvcm1lcicgKyAwICsgJy13b3JzZSddID0gW3dpZHRoIC8gMiAtIDUsIHlfc3RhcnRfYmFyXTsKCiAgICAgIGZvciAodmFyIF9pMTAgPSAwOyBfaTEwIDwgNDsgX2kxMCsrKSB7CiAgICAgICAgdmFyIGZvcm1lcl9mbG93ID0gX3RoaXMuY2FsY3VsYXRlRmxvdyhwYXRoX2Zvcm1lciwgX2kxMCwgcGF0dGVybl9kYXRhKTsKCiAgICAgICAgdmFyIGxhdHRlcl9mbG93ID0gX3RoaXMuY2FsY3VsYXRlRmxvdyhwYXRoX2xhdHRlciwgX2kxMCwgcGF0dGVybl9kYXRhKTsgLy8g5YWI55S7bGF0dGVyCgoKICAgICAgICBfdGhpcy5kcmF3TGluaygnbGF0dGVyJywgbGF0dGVyX2Zsb3csIHN2Zywgd2lkdGhfYmFyLCBfaTEwLCB5X3NjYWxlX2gsICJnIiwgMCk7CgogICAgICAgIF90aGlzLmRyYXdMaW5rKCdmb3JtZXInLCBmb3JtZXJfZmxvdywgc3ZnLCB3aWR0aF9iYXIsIF9pMTAsIHlfc2NhbGVfaCwgImciLCAwKTsKICAgICAgfQogICAgfSwKICAgIGRyYXdMaW5rOiBmdW5jdGlvbiBkcmF3TGluayh0eXBlLCBmbG93LCBzdmcsIHdpZHRoX2JhciwgbnVtLCB5X3NjYWxlX2gsIGZsYWcsIHlfZCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHNvdXJjZV94ID0gMDsKICAgICAgdmFyIHNvdXJjZV94MiA9IDA7CiAgICAgIHZhciB0ID0gNTsKCiAgICAgIGlmICh0eXBlID09ICdsYXR0ZXInKSB7CiAgICAgICAgc291cmNlX3ggPSBfdGhpcy55X3Bvc2l0aW9uX2JpbmFyeVt0eXBlICsgbnVtICsgJy1iZXR0ZXInXVswXSArIDIgKiB3aWR0aF9iYXIgKyAxMDsKICAgICAgICBzb3VyY2VfeDIgPSBfdGhpcy55X3Bvc2l0aW9uX2JpbmFyeVt0eXBlICsgKG51bSArIDEpICsgJy1iZXR0ZXInXVswXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzb3VyY2VfeCA9IF90aGlzLnlfcG9zaXRpb25fYmluYXJ5W3R5cGUgKyBudW0gKyAnLWJldHRlciddWzBdOwogICAgICAgIHNvdXJjZV94MiA9IF90aGlzLnlfcG9zaXRpb25fYmluYXJ5W3R5cGUgKyAobnVtICsgMSkgKyAnLWJldHRlciddWzBdICsgMiAqIHdpZHRoX2JhciArIDEwOwogICAgICAgIHQgPSAtNTsKICAgICAgfQoKICAgICAgdmFyIHNvdXJjZV95X2JldHRlciA9IF90aGlzLnlfcG9zaXRpb25fYmluYXJ5W3R5cGUgKyBudW0gKyAnLWJldHRlciddWzFdOwogICAgICB2YXIgc291cmNlX3lfd29yc2UgPSBfdGhpcy55X3Bvc2l0aW9uX2JpbmFyeVt0eXBlICsgbnVtICsgJy13b3JzZSddWzFdOwogICAgICB2YXIgc291cmNlX3lfYmV0dGVyMiA9IF90aGlzLnlfcG9zaXRpb25fYmluYXJ5W3R5cGUgKyAobnVtICsgMSkgKyAnLWJldHRlciddWzFdOwogICAgICB2YXIgc291cmNlX3lfd29yc2UyID0gX3RoaXMueV9wb3NpdGlvbl9iaW5hcnlbdHlwZSArIChudW0gKyAxKSArICctd29yc2UnXVsxXTsKCiAgICAgIGlmICh5X2QgPCAwKSB7CiAgICAgICAgc291cmNlX3lfYmV0dGVyID0gLXlfZDsKICAgICAgICBzb3VyY2VfeV93b3JzZSA9IC15X2Q7CiAgICAgIH0KCiAgICAgIGlmICh5X2QgPiAwKSB7CiAgICAgICAgc291cmNlX3lfYmV0dGVyMiA9IHlfZDsKICAgICAgICBzb3VyY2VfeV93b3JzZTIgPSB5X2Q7CiAgICAgIH0KCiAgICAgIHZhciBsaW5lR2VuZXJhdG9yID0gZDMubGluZSgpLngoZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4gZC54OwogICAgICB9KS55KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgcmV0dXJuIGQueTsKICAgICAgfSkuY3VydmUoZDMuY3VydmVDYXRtdWxsUm9tLmFscGhhKDAuNSkpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHsKICAgICAgICBmbG93W2ldICo9IHlfc2NhbGVfaDsKICAgICAgICB2YXIgZGF0YV90ZW1wID0gW107CgogICAgICAgIGlmIChpID09IDApIHsKICAgICAgICAgIGRhdGFfdGVtcCA9IFt7CiAgICAgICAgICAgIHg6IHNvdXJjZV94LAogICAgICAgICAgICB5OiBzb3VyY2VfeV9iZXR0ZXIKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgeDogc291cmNlX3ggKyB0LAogICAgICAgICAgICB5OiBzb3VyY2VfeV9iZXR0ZXIKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgeDogc291cmNlX3gyIC0gdCwKICAgICAgICAgICAgeTogc291cmNlX3lfYmV0dGVyMgogICAgICAgICAgfSwgewogICAgICAgICAgICB4OiBzb3VyY2VfeDIsCiAgICAgICAgICAgIHk6IHNvdXJjZV95X2JldHRlcjIKICAgICAgICAgIH1dOwogICAgICAgICAgc291cmNlX3lfYmV0dGVyICs9IGZsb3dbaV07CiAgICAgICAgICBzb3VyY2VfeV9iZXR0ZXIyICs9IGZsb3dbaV07CiAgICAgICAgfSBlbHNlIGlmIChpID09IDEpIHsKICAgICAgICAgIGRhdGFfdGVtcCA9IFt7CiAgICAgICAgICAgIHg6IHNvdXJjZV94LAogICAgICAgICAgICB5OiBzb3VyY2VfeV9iZXR0ZXIKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgeDogc291cmNlX3ggKyB0LAogICAgICAgICAgICB5OiBzb3VyY2VfeV9iZXR0ZXIKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgeDogc291cmNlX3gyIC0gdCwKICAgICAgICAgICAgeTogc291cmNlX3lfd29yc2UyCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IHNvdXJjZV94MiwKICAgICAgICAgICAgeTogc291cmNlX3lfd29yc2UyCiAgICAgICAgICB9XTsKICAgICAgICAgIHNvdXJjZV95X2JldHRlciArPSBmbG93W2ldOwogICAgICAgICAgc291cmNlX3lfd29yc2UyICs9IGZsb3dbaV07CiAgICAgICAgfSBlbHNlIGlmIChpID09IDIpIHsKICAgICAgICAgIGRhdGFfdGVtcCA9IFt7CiAgICAgICAgICAgIHg6IHNvdXJjZV94LAogICAgICAgICAgICB5OiBzb3VyY2VfeV93b3JzZQogICAgICAgICAgfSwgewogICAgICAgICAgICB4OiBzb3VyY2VfeCArIHQsCiAgICAgICAgICAgIHk6IHNvdXJjZV95X3dvcnNlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IHNvdXJjZV94MiAtIHQsCiAgICAgICAgICAgIHk6IHNvdXJjZV95X2JldHRlcjIKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgeDogc291cmNlX3gyLAogICAgICAgICAgICB5OiBzb3VyY2VfeV9iZXR0ZXIyCiAgICAgICAgICB9XTsKICAgICAgICAgIHNvdXJjZV95X2JldHRlcjIgKz0gZmxvd1tpXTsKICAgICAgICAgIHNvdXJjZV95X3dvcnNlICs9IGZsb3dbaV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRhdGFfdGVtcCA9IFt7CiAgICAgICAgICAgIHg6IHNvdXJjZV94LAogICAgICAgICAgICB5OiBzb3VyY2VfeV93b3JzZQogICAgICAgICAgfSwgewogICAgICAgICAgICB4OiBzb3VyY2VfeCArIHQsCiAgICAgICAgICAgIHk6IHNvdXJjZV95X3dvcnNlCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgIHg6IHNvdXJjZV94MiAtIHQsCiAgICAgICAgICAgIHk6IHNvdXJjZV95X3dvcnNlMgogICAgICAgICAgfSwgewogICAgICAgICAgICB4OiBzb3VyY2VfeDIsCiAgICAgICAgICAgIHk6IHNvdXJjZV95X3dvcnNlMgogICAgICAgICAgfV07CiAgICAgICAgICBzb3VyY2VfeV93b3JzZTIgKz0gZmxvd1tpXTsKICAgICAgICAgIHNvdXJjZV95X3dvcnNlICs9IGZsb3dbaV07CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGZsb3dbaV07IGsrKykgewogICAgICAgICAgZm9yICh2YXIgcCA9IDA7IHAgPCA0OyBwKyspIHsKICAgICAgICAgICAgZGF0YV90ZW1wW3BdLnkgKz0gMTsKICAgICAgICAgIH0KCiAgICAgICAgICBzdmcuYXBwZW5kKCJwYXRoIikuZGF0dW0oZGF0YV90ZW1wKS5hdHRyKCJmaWxsIiwgIm5vbmUiKS5hdHRyKCJzdHJva2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChmbGFnID09ICdnJykgewogICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jb2xvcl9iYWNrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jb2xvcl9iYWNrX2luZGl2aWR1YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmF0dHIoInN0cm9rZS13aWR0aCIsIDEpLmF0dHIoIm9wYWNpdHkiLCBfdGhpcy5vcGFjaXR5X2JhY2spLmF0dHIoImQiLCBsaW5lR2VuZXJhdG9yKS5sb3dlcigpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNhbGN1bGF0ZUZsb3c6IGZ1bmN0aW9uIGNhbGN1bGF0ZUZsb3cocGF0aF9zZXF1ZW5jZSwgbiwgcGF0dGVybl9kYXRhKSB7CiAgICAgIC8vIOmAmui/h3NlcXVlbmNl6I635b6X56ysbuWxguWIsOesrG4rMeWxgueahOa1gemHjwogICAgICB2YXIgcmVzdWx0ID0gWzAsIDAsIDAsIDBdOyAvL+WlveWPmOWlve+8jOWlveWPmOWdj++8jOWdj+WPmOWlve+8jOWdj+WPmOWdjwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoX3NlcXVlbmNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKG4gPiBwYXRoX3NlcXVlbmNlW2ldLmxlbmd0aCAtIDIpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGtleTEgPSBwYXRoX3NlcXVlbmNlW2ldW25dOwogICAgICAgIHZhciBrZXkyID0gcGF0aF9zZXF1ZW5jZVtpXVtuICsgMV07CgogICAgICAgIGlmIChwYXR0ZXJuX2RhdGFbMF1ba2V5MV1bMF0gPiBwYXR0ZXJuX2RhdGFbMF1ba2V5MV1bMV0pIHsKICAgICAgICAgIC8v5YmN6Z2i55qE6Lev5b6E5piv5aW9CiAgICAgICAgICBpZiAocGF0dGVybl9kYXRhWzBdW2tleTJdWzBdID4gcGF0dGVybl9kYXRhWzBdW2tleTJdWzFdKSB7CiAgICAgICAgICAgIC8v5ZCO6Z2i55qE6Lev5b6E5piv5aW9CiAgICAgICAgICAgIHJlc3VsdFswXSArPSAxOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy/lkI7pnaLnmoTot6/lvoTmmK/lnY8KICAgICAgICAgICAgcmVzdWx0WzFdICs9IDE7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYXR0ZXJuX2RhdGFbMF1ba2V5Ml1bMF0gPiBwYXR0ZXJuX2RhdGFbMF1ba2V5Ml1bMV0pIHsKICAgICAgICAgICAgLy/lkI7pnaLnmoTot6/lvoTmmK/lpb0KICAgICAgICAgICAgcmVzdWx0WzJdICs9IDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL+WQjumdoueahOi3r+W+hOaYr+WdjwogICAgICAgICAgICByZXN1bHRbM10gKz0gMTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAogICAgZHJhd1BhdGg6IGZ1bmN0aW9uIGRyYXdQYXRoKHBhdGgsIHN2ZywgeF9zdGFydCwgeV9zdGFydCwgc3RhZ2VfbnVtYmVyLCB5X3NjYWxlLCBjb2xvciwgd2lkdGgsIHdpZHRoX2JhciwgY2xhc3NfbmFtZSwgcGF0aF9zZXF1ZW5jZSwgZXh0cmFjdGVkX3NlcXVlbmNlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBfdGhpcy55X3Bvc2l0aW9uX2JpbmFyeVtjbGFzc19uYW1lICsgJy1iZXR0ZXInXSA9IFt4X3N0YXJ0IC0gNSwgeV9zdGFydF07CgogICAgICB2YXIgeV9lbmQgPSBfdGhpcy5kcmF3U3ViUGF0aChwYXRoWzBdLCBzdmcsIHhfc3RhcnQsIHlfc3RhcnQsIHN0YWdlX251bWJlciwgeV9zY2FsZSwgY29sb3IsIHdpZHRoLCB3aWR0aF9iYXIsIGNsYXNzX25hbWUsIHBhdGhfc2VxdWVuY2UsIGV4dHJhY3RlZF9zZXF1ZW5jZSk7IC8v55S75aW96Lev5b6E55qE6IOM5pmvCgoKICAgICAgdmFyIHN2Z190ZW1wID0gc3ZnLmFwcGVuZCgnZycpLmxvd2VyKCk7CiAgICAgIHZhciBjb2xvcl9zdHJva2UgPSBfdGhpcy5jb2xvcl9iYWNrOwogICAgICBzdmdfdGVtcC5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IiwgeF9zdGFydCAtIDUpLmF0dHIoInkiLCB5X3N0YXJ0IC0gNSkuYXR0cigid2lkdGgiLCB3aWR0aF9iYXIgKiAyICsgMTApLmF0dHIoImhlaWdodCIsIHlfZW5kIC0geV9zdGFydCArIDEwKS5hdHRyKCJmaWxsIiwgIm5vbmUiKS5hdHRyKCJvcGFjaXR5IiwgX3RoaXMub3BhY2l0eV9iYWNrKS5hdHRyKCJzdHJva2UiLCBjb2xvcl9zdHJva2UpOyAvL+eUu+WIhuWJsue6vwoKICAgICAgeV9lbmQgKz0gMTA7CiAgICAgIHlfc3RhcnQgPSB5X2VuZDsKICAgICAgX3RoaXMueV9wb3NpdGlvbl9iaW5hcnlbY2xhc3NfbmFtZSArICctd29yc2UnXSA9IFt4X3N0YXJ0IC0gMTAsIHlfc3RhcnQgKyA1XTsKICAgICAgc3ZnX3RlbXAuYXBwZW5kKCJsaW5lIikuYXR0cigieDEiLCB4X3N0YXJ0ICsgMiAqIHdpZHRoX2JhciArIDEwKS5hdHRyKCJ4MiIsIHhfc3RhcnQgLSAxMCkuYXR0cigieTEiLCB5X2VuZCkuYXR0cigieTIiLCB5X2VuZCkuYXR0cigic3Ryb2tlLXdpZHRoIiwgMikuYXR0cigic3Ryb2tlIiwgX3RoaXMuZGl2aWRlX2xpbmUpOwogICAgICB5X2VuZCA9IF90aGlzLmRyYXdTdWJQYXRoKHBhdGhbMV0sIHN2ZywgeF9zdGFydCwgeV9lbmQgKyAxMCwgc3RhZ2VfbnVtYmVyLCB5X3NjYWxlLCBjb2xvciwgd2lkdGgsIHdpZHRoX2JhciwgY2xhc3NfbmFtZSwgcGF0aF9zZXF1ZW5jZSwgZXh0cmFjdGVkX3NlcXVlbmNlKTsgLy8g55S75Z2P6Lev5b6E55qE6IOM5pmvCgogICAgICBzdmdfdGVtcC5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IiwgeF9zdGFydCAtIDUpLmF0dHIoInkiLCB5X3N0YXJ0ICsgMTApLmF0dHIoIndpZHRoIiwgd2lkdGhfYmFyICogMiArIDEwKS5hdHRyKCJoZWlnaHQiLCB5X2VuZCAtIHlfc3RhcnQgLSA1KS5hdHRyKCJmaWxsIiwgIm5vbmUiKS5hdHRyKCJvcGFjaXR5IiwgX3RoaXMub3BhY2l0eV9iYWNrKS5hdHRyKCJzdHJva2UiLCBjb2xvcl9zdHJva2UpOwogICAgfSwKICAgIG9idGFpbkFsbFBhdGg6IGZ1bmN0aW9uIG9idGFpbkFsbFBhdGgobnVtLCBrZXksIHBhdGhfc2VxdWVuY2UpIHsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoX3NlcXVlbmNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKHBhdGhfc2VxdWVuY2VbaV0ubGVuZ3RoID4gbnVtICYmIHBhdGhfc2VxdWVuY2VbaV1bbnVtXSA9PSBrZXkpIHsKICAgICAgICAgIGZvciAodmFyIGogPSBudW0gKyAxOyBqIDwgcGF0aF9zZXF1ZW5jZVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgICByZXN1bHQucHVzaChwYXRoX3NlcXVlbmNlW2ldW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAogICAgY2FsY3VsYXRlUmF0aW86IGZ1bmN0aW9uIGNhbGN1bGF0ZVJhdGlvKHNlcXVlbmNlLCBrZXlfZGVncmVlX21hcCkgewogICAgICB2YXIgcmVzdWx0ID0gWzAsIDBdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZXF1ZW5jZS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBkaWZmZXJlbmNlID0ga2V5X2RlZ3JlZV9tYXBbc2VxdWVuY2VbaV1dWzBdIC0ga2V5X2RlZ3JlZV9tYXBbc2VxdWVuY2VbaV1dWzFdOwoKICAgICAgICBpZiAoZGlmZmVyZW5jZSA+IDApIHsKICAgICAgICAgIHJlc3VsdFswXSArPSBkaWZmZXJlbmNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHRbMV0gKz0gTWF0aC5hYnMoZGlmZmVyZW5jZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAocmVzdWx0WzBdICsgcmVzdWx0WzFdID09IDApIHsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBbcmVzdWx0WzBdIC8gKHJlc3VsdFswXSArIHJlc3VsdFsxXSksIHJlc3VsdFsxXSAvIChyZXN1bHRbMF0gKyByZXN1bHRbMV0pXTsKICAgICAgfQogICAgfSwKICAgIGRyYXdTdWJQYXRoOiBmdW5jdGlvbiBkcmF3U3ViUGF0aChkYXRhLCBzdmcsIHhfc3RhcnQsIHlfc3RhcnQsIHN0YWdlX251bWJlciwgeV9zY2FsZSwgY29sb3IsIHdpZHRoLCB3aWR0aF9iYXIsIGNsYXNzX25hbWUsIHBhdGhfc2VxdWVuY2UsIGV4dHJhY3RlZF9zZXF1ZW5jZSkgewogICAgICAvLyBkYXRh5piv55SxW+i3r+W+hO+8jOmikeeOh13nu4TmiJDnmoTluo/liJcKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoZGF0YSk7CiAgICAgIHZhciBzdmdfdGVtcCA9IHN2Zy5hcHBlbmQoJ2cnKS5sb3dlcigpOyAvLyDnlLtob3ZlcuS5i+WQjuS8muaYvuekuuWHuuadpeeahG5lZ2F0aXZlL3Bvc2l0aXZlIGRlZ3JlZeS7peWPim5lZ2F0aXZlL3Bvc2l0aXZlIGNoYW5nZQoKICAgICAgdmFyIGtleV9kZWdyZWVfbWFwID0gX3RoaXMucGF0dGVybl9kYXRhWzBdOyAvL+WtmOWCqOS6hui/meS4qnBhdGjnmoTlpb3lnY/popHnjocnMTMnOlswLjQsIDAuN10KCiAgICAgIHZhciBrZXlfcCA9IG5ldyBTZXQoKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhZ2VfbnVtYmVyOyBpKyspIHsKICAgICAgICBmb3IgKHZhciBqID0gLTE7IGogPCBzdGFnZV9udW1iZXI7IGorKykgewogICAgICAgICAgZm9yICh2YXIgaWogPSAtMTsgaWogPCBzdGFnZV9udW1iZXI7IGlqKyspIHsKICAgICAgICAgICAgaWYgKGogPT0gLTEpIHsKICAgICAgICAgICAgICBrZXlfcC5hZGQoaS50b1N0cmluZygpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoaWogPT0gLTEpIHsKICAgICAgICAgICAgICAgIGtleV9wLmFkZChpLnRvU3RyaW5nKCkgKyBqLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBrZXlfcC5hZGQoaS50b1N0cmluZygpICsgai50b1N0cmluZygpICsgaWoudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgIHZhciBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CgogICAgICB0cnkgewogICAgICAgIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoKSB7CiAgICAgICAgICB2YXIga2V5ID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgaWYgKGtleXMuaW5jbHVkZXMoa2V5KSkgewogICAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIC8vIOmcgOimgeW+l+WIsOi/meS4gOWxguW8gOWni+S7pWtleeS4unN0YXJ055qE5ZCO57utCiAgICAgICAgICAgICAgdmFyIHNlcXVlbmNlc190ZW1wID0gX3RoaXMub2J0YWluQWxsUGF0aChwYXJzZUludChjbGFzc19uYW1lW2NsYXNzX25hbWUubGVuZ3RoIC0gMV0pIC0gMSwga2V5LCBwYXRoX3NlcXVlbmNlKTsgLy8g6YCa6L+Hc2VxdWVuY2XlvpfliLDot6/lvoTnmoTmg4XlhrUKCgogICAgICAgICAgICAgIHZhciBwYXRoX3RyYW5zaXRpb25fdGVtcCA9IF90aGlzLmNhbGN1bGF0ZVJhdGlvKHNlcXVlbmNlc190ZW1wLCBrZXlfZGVncmVlX21hcCk7CgogICAgICAgICAgICAgIHZhciBkZWdyZWUgPSBrZXlfZGVncmVlX21hcFtrZXldOyAvLyDnhLblkI7pnIDopoHpgJrov4dwYXRoX3RyYW5zaXRpb25fdGVtcOWSjGRlZ3JlZeeUu+WbvgoKICAgICAgICAgICAgICBfdGhpcy55X3Bvc2l0aW9uW2NsYXNzX25hbWUgKyAnLScgKyBrZXldID0geV9zdGFydDsKICAgICAgICAgICAgICB2YXIgZGF0YV9maW5hbF90ID0gW107CgogICAgICAgICAgICAgIGZvciAodmFyIHAgPSAwOyBwIDwgZXh0cmFjdGVkX3NlcXVlbmNlLmxlbmd0aDsgcCsrKSB7CiAgICAgICAgICAgICAgICBpZiAoY2xhc3NfbmFtZVswXSA9PSAnZicpIHsKICAgICAgICAgICAgICAgICAgaWYgKGV4dHJhY3RlZF9zZXF1ZW5jZVtwXVswXVtwYXJzZUludChjbGFzc19uYW1lW2NsYXNzX25hbWUubGVuZ3RoIC0gMV0pIC0gMV0gPT0ga2V5KSB7CiAgICAgICAgICAgICAgICAgICAgLy8g5oqK5bqP5YiX5YaN5ou86LW35p2lCiAgICAgICAgICAgICAgICAgICAgZGF0YV9maW5hbF90LnB1c2goZXh0cmFjdGVkX3NlcXVlbmNlW3BdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChjbGFzc19uYW1lWzBdID09ICdsJykgewogICAgICAgICAgICAgICAgICBpZiAoZXh0cmFjdGVkX3NlcXVlbmNlW3BdWzFdW3BhcnNlSW50KGNsYXNzX25hbWVbY2xhc3NfbmFtZS5sZW5ndGggLSAxXSkgLSAxXSA9PSBrZXkpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhX2ZpbmFsX3QucHVzaChleHRyYWN0ZWRfc2VxdWVuY2VbcF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSAvL2NvbnNvbGUubG9nKCIqKioqKioqKioqZGF0YV9maW5hbF90IixjbGFzc19uYW1lLCBrZXksIGRhdGFfZmluYWxfdC5sZW5ndGgsIF90aGlzLmNhbGN1bGF0ZVRlbXAyKGRhdGEpLCBleHRyYWN0ZWRfc2VxdWVuY2UpCgoKICAgICAgICAgICAgICB2YXIgZGF0YV9maW5hbCA9IFtdOwoKICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IGRhdGFfZmluYWxfdC5sZW5ndGg7IHQrKykgewogICAgICAgICAgICAgICAgdmFyIHRlbXBfcCA9IFtdOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIHEgPSAzOyBxID49IDA7IHEtLSkgewogICAgICAgICAgICAgICAgICBpZiAoZGF0YV9maW5hbF90W3RdWzBdLmxlbmd0aCA+IHEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMucGF0dGVybl9kYXRhWzBdW2RhdGFfZmluYWxfdFt0XVswXVtxXV1bMF0gPiBfdGhpcy5wYXR0ZXJuX2RhdGFbMF1bZGF0YV9maW5hbF90W3RdWzBdW3FdXVsxXSkgewogICAgICAgICAgICAgICAgICAgICAgdGVtcF9wLnB1c2goMSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHRlbXBfcC5wdXNoKC0xKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcF9wLnB1c2goMCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMucGF0dGVybl9kYXRhWzBdW190aGlzLmNsaWNrcGF0aF1bMF0gPiBfdGhpcy5wYXR0ZXJuX2RhdGFbMF1bX3RoaXMuY2xpY2twYXRoXVsxXSkgewogICAgICAgICAgICAgICAgICB0ZW1wX3AucHVzaCgxKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRlbXBfcC5wdXNoKC0xKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmb3IgKHZhciBfcSA9IDA7IF9xIDwgNDsgX3ErKykgewogICAgICAgICAgICAgICAgICBpZiAoZGF0YV9maW5hbF90W3RdWzFdLmxlbmd0aCA+IF9xKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnBhdHRlcm5fZGF0YVswXVtkYXRhX2ZpbmFsX3RbdF1bMV1bX3FdXVswXSA+IF90aGlzLnBhdHRlcm5fZGF0YVswXVtkYXRhX2ZpbmFsX3RbdF1bMV1bX3FdXVsxXSkgewogICAgICAgICAgICAgICAgICAgICAgdGVtcF9wLnB1c2goMSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHRlbXBfcC5wdXNoKC0xKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcF9wLnB1c2goMCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkYXRhX2ZpbmFsLnB1c2godGVtcF9wKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBfbG9vcDMgPSBmdW5jdGlvbiBfbG9vcDMoX3QyKSB7CiAgICAgICAgICAgICAgICBzdmdfdGVtcC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCd4JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBpZiAoa2V5Lmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4geF9zdGFydCArIF90MiAqIDIgLyBrZXkubGVuZ3RoICogd2lkdGhfYmFyOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB4X3N0YXJ0ICsgX3QyICogMiAvIGtleS5sZW5ndGggKiB3aWR0aF9iYXI7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLmF0dHIoJ3knLCB5X3N0YXJ0KS5hdHRyKCd3aWR0aCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgaWYgKGtleS5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdpZHRoX2JhcjsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMiAvIGtleS5sZW5ndGggKiB3aWR0aF9iYXI7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIHlfc2NhbGUgKiBkYXRhW2tleV0pLmF0dHIoJ2ZpbGwnLCBjb2xvcihwYXJzZUludChrZXlbX3QyXSkpKS5hdHRyKCdzdHJva2UnLCAnd2hpdGUnKS5hdHRyKCdzdHJva2Utd2lkdGgnLCAwLjA1KS5hdHRyKCdjbGFzcycsIGNsYXNzX25hbWUgKyBrZXkpLmF0dHIoJ2lkJywgeV9zdGFydCkuc3R5bGUoJ3otaW5kZXgnLCAyKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHBpcGVTZXJ2aWNlLmVtaXRDbGlja1BhdGgoW2tleSwgLTFdKTsKICAgICAgICAgICAgICAgIH0pLm9uKCdtb3VzZWVudGVyJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAkKCcuJyArIGNsYXNzX25hbWUgKyBrZXkpLmF0dHIoJ3N0cm9rZScsIF90aGlzLmhvdmVyX2NvbG9yKS5hdHRyKCdzdHJva2Utd2lkdGgnLCAxKTsKICAgICAgICAgICAgICAgICAgJCgnLicgKyBjbGFzc19uYW1lICsgJy5ob3Zlci4nICsga2V5KS5hdHRyKCd2aXNpYmlsaXR5JywgJ3Zpc2FibGUnKTsgLy9jb25zb2xlLmxvZygnVGVzdDItZHJhd1N0YWdlQ29weScsIGtleSkKCiAgICAgICAgICAgICAgICAgIF90aGlzLmRyYXdTdGFnZUNvcHkoa2V5KTsgLy8g55S7aG92ZXLkuYvlkI7kvJrmmL7npLrnmoRzYW5rZXkKICAgICAgICAgICAgICAgICAgLy8g5YWI5o+Q5Y+W5Zyo6L+Z5Liq5L2N572u5LiK5pyJa2V55YWD57Sg55qEc2VxdWVuY2UKICAgICAgICAgICAgICAgICAgLy8g57uf6K6h5q+P5Liq5pe26Ze054K55LmL6Ze055qE5rWB5ZCR77yMcmVzdWx0WzAsMCwwLDBd5aW95Yiw5aW977yM5aW95Yiw5Z2P77yM5Z2P5Yiw5aW977yM5Z2P5Yiw5Z2PCgoKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX3AgPSA0OyBfcCA8IGRhdGFfZmluYWxbMF0ubGVuZ3RoIC0gMTsgX3ArKykgewogICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wX3Jlc3VsdCA9IFswLCAwLCAwLCAwXTsKCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX3EyID0gMDsgX3EyIDwgZGF0YV9maW5hbC5sZW5ndGg7IF9xMisrKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YV9maW5hbFtfcTJdW19wXSA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhX2ZpbmFsW19xMl1bX3AgKyAxXSA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9yZXN1bHRbMF0gKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFfZmluYWxbX3EyXVtfcCArIDFdID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9yZXN1bHRbMV0gKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhX2ZpbmFsW19xMl1bX3BdID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhX2ZpbmFsW19xMl1bX3AgKyAxXSA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9yZXN1bHRbMl0gKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFfZmluYWxbX3EyXVtfcCArIDFdID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9yZXN1bHRbM10gKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIHlfc3RhcnRfaSA9IDA7CgogICAgICAgICAgICAgICAgICAgIGlmIChfcCAtIDMgPT0gcGFyc2VJbnQoY2xhc3NfbmFtZVs2XSkgJiYgY2xhc3NfbmFtZVswXSA9PSAnbCcpIHsKICAgICAgICAgICAgICAgICAgICAgIHlfc3RhcnRfaSA9IHBhcnNlRmxvYXQoJCgnLicgKyBjbGFzc19uYW1lICsga2V5KS5hdHRyKCdpZCcpKSAtIDM7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoX3AgLSA0ID09IHBhcnNlSW50KGNsYXNzX25hbWVbNl0pICYmIGNsYXNzX25hbWVbMF0gPT0gJ2wnKSB7CiAgICAgICAgICAgICAgICAgICAgICB5X3N0YXJ0X2kgPSAtcGFyc2VGbG9hdCgkKCcuJyArIGNsYXNzX25hbWUgKyBrZXkpLmF0dHIoJ2lkJykpIC0gMzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYXdMaW5rKCdsYXR0ZXInLCB0ZW1wX3Jlc3VsdCwgc3ZnX3RlbXAyLCBfdGhpcy53aWR0aF9iYXIsIF9wIC0gNCwgX3RoaXMueV9zY2FsZV9oLCAiaSIsIHlfc3RhcnRfaSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9wMiA9IDQ7IF9wMiA+PSAxOyBfcDItLSkgewogICAgICAgICAgICAgICAgICAgIHZhciBfdGVtcF9yZXN1bHQgPSBbMCwgMCwgMCwgMF07CgogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9xMyA9IDA7IF9xMyA8IGRhdGFfZmluYWwubGVuZ3RoOyBfcTMrKykgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFfZmluYWxbX3EzXVtfcDJdID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFfZmluYWxbX3EzXVtfcDIgLSAxXSA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RlbXBfcmVzdWx0WzBdICs9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhX2ZpbmFsW19xM11bX3AyIC0gMV0gPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGVtcF9yZXN1bHRbMV0gKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhX2ZpbmFsW19xM11bX3AyXSA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YV9maW5hbFtfcTNdW19wMiAtIDFdID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGVtcF9yZXN1bHRbMl0gKz0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFfZmluYWxbX3EzXVtfcDIgLSAxXSA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIF90ZW1wX3Jlc3VsdFszXSArPSAxOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgX3lfc3RhcnRfaSA9IDA7CgogICAgICAgICAgICAgICAgICAgIGlmICg1IC0gX3AyID09IHBhcnNlSW50KGNsYXNzX25hbWVbNl0pICYmIGNsYXNzX25hbWVbMF0gPT0gJ2YnKSB7CiAgICAgICAgICAgICAgICAgICAgICBfeV9zdGFydF9pID0gcGFyc2VGbG9hdCgkKCcuJyArIGNsYXNzX25hbWUgKyBrZXkpLmF0dHIoJ2lkJykpIC0gMzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICg0IC0gX3AyID09IHBhcnNlSW50KGNsYXNzX25hbWVbNl0pICYmIGNsYXNzX25hbWVbMF0gPT0gJ2YnKSB7CiAgICAgICAgICAgICAgICAgICAgICBfeV9zdGFydF9pID0gLXBhcnNlRmxvYXQoJCgnLicgKyBjbGFzc19uYW1lICsga2V5KS5hdHRyKCdpZCcpKSAtIDM7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBfdGhpcy5kcmF3TGluaygnZm9ybWVyJywgX3RlbXBfcmVzdWx0LCBzdmdfdGVtcDIsIF90aGlzLndpZHRoX2JhciwgNCAtIF9wMiwgX3RoaXMueV9zY2FsZV9oLCAiaSIsIF95X3N0YXJ0X2kpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KS5vbignbW91c2VsZWF2ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgJCgnLicgKyBjbGFzc19uYW1lICsga2V5KS5hdHRyKCdzdHJva2UnLCAnd2hpdGUnKS5hdHRyKCdzdHJva2Utd2lkdGgnLCAwLjUpOwogICAgICAgICAgICAgICAgICAkKCcuJyArIGNsYXNzX25hbWUgKyAnLmhvdmVyLicgKyBrZXkpLmF0dHIoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCgnLnN0YWdlY29weXN2ZycpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgZm9yICh2YXIgX3QyID0gMDsgX3QyIDwga2V5Lmxlbmd0aDsgX3QyKyspIHsKICAgICAgICAgICAgICAgIF9sb29wMyhfdDIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGtleS5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAvLyDnlLvnqbrnmb3pg6jliIbnmoTvvIzmr5TlpoLlvZPlj6rlh7rnjrDkuIDkuKrnmoTml7blgJnlj7PovrnpnIDopoHooaXotrMKICAgICAgICAgICAgICAgIHN2Z190ZW1wLmFwcGVuZCgncmVjdCcpLmF0dHIoJ3gnLCB4X3N0YXJ0ICsgd2lkdGhfYmFyKS5hdHRyKCd5JywgeV9zdGFydCkuYXR0cignd2lkdGgnLCB3aWR0aF9iYXIpLmF0dHIoJ2hlaWdodCcsIHlfc2NhbGUgKiBkYXRhW2tleV0pLmF0dHIoJ2ZpbGwnLCAnd2hpdGUnKS5hdHRyKCdzdHJva2UnLCAnI2QzZDNkMycpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDAuNSkuYXR0cignY2xhc3MnLCBjbGFzc19uYW1lICsga2V5KS5zdHlsZSgnei1pbmRleCcsIDIpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcGlwZVNlcnZpY2UuZW1pdENsaWNrUGF0aChba2V5LCAtMV0pOwogICAgICAgICAgICAgICAgfSkub24oJ21vdXNlZW50ZXInLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICQoJy4nICsgY2xhc3NfbmFtZSArIGtleSkuYXR0cignc3Ryb2tlJywgX3RoaXMuaG92ZXJfY29sb3IpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDEpOwogICAgICAgICAgICAgICAgICAkKCcuJyArIGNsYXNzX25hbWUgKyAnLmhvdmVyLicgKyBrZXkpLmF0dHIoJ3Zpc2liaWxpdHknLCAndmlzYWJsZScpOyAvL2NvbnNvbGUubG9nKCdUZXN0My1kcmF3U3RhZ2VDb3B5Jywga2V5KQoKICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhd1N0YWdlQ29weShrZXkpOwogICAgICAgICAgICAgICAgfSkub24oJ21vdXNlbGVhdmUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICQoJy4nICsgY2xhc3NfbmFtZSArIGtleSkuYXR0cignc3Ryb2tlJywgJ3doaXRlJykuYXR0cignc3Ryb2tlLXdpZHRoJywgMC41KTsKICAgICAgICAgICAgICAgICAgJCgnLicgKyBjbGFzc19uYW1lICsgJy5ob3Zlci4nICsga2V5KS5hdHRyKCd2aXNpYmlsaXR5JywgJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICBkMy5zZWxlY3QoJy5zdGFnZWNvcHlzdmcnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHN2Z190ZW1wMiA9IHN2Zy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsIGNsYXNzX25hbWUgKyAnIGhvdmVyICcgKyBrZXkpLmF0dHIoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJykuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgwLCA1KSIpOyAvLyDnlLtob3ZlcuS5i+WQjuS8muaYvuekuueahHBhdGggdHJhbnNpdGlvbuWSjHBvc2l0aXZlL25lZ2F0aXZlIGRlZ3JlZQoKICAgICAgICAgICAgICBzdmdfdGVtcDIuYXBwZW5kKCdyZWN0JykuYXR0cigneCcsIHhfc3RhcnQpLmF0dHIoJ3knLCB5X3N0YXJ0ICsgeV9zY2FsZSAqIGRhdGFba2V5XSAvIDIpLmF0dHIoJ3dpZHRoJywgODApLmF0dHIoJ2hlaWdodCcsIDMwKS5hdHRyKCdmaWxsJywgJ3doaXRlJykuYXR0cignc3Ryb2tlJywgJyNkM2QzZDMnKS5hdHRyKCdzdHJva2Utd2lkdGgnLCAwLjUpOwogICAgICAgICAgICAgIHN2Z190ZW1wMi5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKGNsYXNzX25hbWVbMF0gPT0gJ2YnKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB4X3N0YXJ0ICsgNDI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4geF9zdGFydCArIDU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkuYXR0cigieSIsIHlfc3RhcnQgKyB5X3NjYWxlICogZGF0YVtrZXldIC8gMiArIDUpLmF0dHIoIndpZHRoIiwgMzIpLmF0dHIoImhlaWdodCIsIDIwKS5hdHRyKCJzdHJva2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoZGVncmVlWzBdID4gZGVncmVlWzFdKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5iZXR0ZXJfY29sb3I7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMud29yc2VfY29sb3I7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkuYXR0cigiZmlsbCIsICJub25lIik7CiAgICAgICAgICAgICAgc3ZnX3RlbXAyLmFwcGVuZCgidGV4dCIpLmF0dHIoIngiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoY2xhc3NfbmFtZVswXSA9PSAnZicpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHhfc3RhcnQgKyA0MzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB4X3N0YXJ0ICsgNjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KS5hdHRyKCJ5IiwgeV9zdGFydCArIHlfc2NhbGUgKiBkYXRhW2tleV0gLyAyICsgMjApLmF0dHIoImZvbnQtc2l6ZSIsIDE1KS50ZXh0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLmFicygoZGVncmVlWzBdIC0gZGVncmVlWzFdKSAqIDEwMCkudG9GaXhlZCgxKTsKICAgICAgICAgICAgICB9KS5hdHRyKCJmaWxsIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKGRlZ3JlZVswXSA+IGRlZ3JlZVsxXSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuYmV0dGVyX2NvbG9yOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLndvcnNlX2NvbG9yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHN2Z190ZW1wMi5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKGNsYXNzX25hbWVbMF0gPT0gJ2wnKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB4X3N0YXJ0ICsgNDI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZXR1cm4geF9zdGFydCArIDU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkuYXR0cigieSIsIHlfc3RhcnQgKyB5X3NjYWxlICogZGF0YVtrZXldIC8gMiArIDUpLmF0dHIoIndpZHRoIiwgMzIpLmF0dHIoImhlaWdodCIsIDIwICogcGF0aF90cmFuc2l0aW9uX3RlbXBbMF0pLmF0dHIoInN0cm9rZSIsICdub25lJykuYXR0cigiZmlsbCIsIF90aGlzLmJldHRlcl9jb2xvcik7CiAgICAgICAgICAgICAgc3ZnX3RlbXAyLmFwcGVuZCgicmVjdCIpLmF0dHIoIngiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoY2xhc3NfbmFtZVswXSA9PSAnbCcpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHhfc3RhcnQgKyA0MjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB4X3N0YXJ0ICsgNTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KS5hdHRyKCJ5IiwgeV9zdGFydCArIHlfc2NhbGUgKiBkYXRhW2tleV0gLyAyICsgNSArIDIwICogcGF0aF90cmFuc2l0aW9uX3RlbXBbMF0pLmF0dHIoIndpZHRoIiwgMzIpLmF0dHIoImhlaWdodCIsIDIwICogcGF0aF90cmFuc2l0aW9uX3RlbXBbMV0pLmF0dHIoInN0cm9rZSIsICdub25lJykuYXR0cigiZmlsbCIsIF90aGlzLndvcnNlX2NvbG9yKTsKICAgICAgICAgICAgICB5X3N0YXJ0ICs9IHlfc2NhbGUgKiBkYXRhW2tleV0gKyAwLjM7CiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0ga2V5X3BbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7CiAgICAgICAgICBfbG9vcDIoKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICBfaXRlcmF0b3JFcnJvciA9IGVycjsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKCFfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uICYmIF9pdGVyYXRvci5yZXR1cm4gIT0gbnVsbCkgewogICAgICAgICAgICBfaXRlcmF0b3IucmV0dXJuKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGlmIChfZGlkSXRlcmF0b3JFcnJvcikgewogICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB5X3N0YXJ0OwogICAgfSwKICAgIG9idGFpblN1YlBhdGg6IGZ1bmN0aW9uIG9idGFpblN1YlBhdGgobm9kZSwgZGVwdGgpIHsKICAgICAgdmFyIGN1cnJlbnREZXB0aCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMDsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoX3R5cGVvZihub2RlKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICBpZiAoY3VycmVudERlcHRoID09PSBkZXB0aCkgewogICAgICAgICAgX3RoaXMuYWxsX25vZGVzLnB1c2goW25vZGUudmFsdWUsIG5vZGUuY291bnRdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGNoaWxkTm9kZXMgPSBPYmplY3QudmFsdWVzKG5vZGUpOwogICAgICAgICAgY2hpbGROb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZE5vZGUpIHsKICAgICAgICAgICAgaWYgKF90eXBlb2YoY2hpbGROb2RlKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICBfdGhpcy5vYnRhaW5TdWJQYXRoKGNoaWxkTm9kZSwgZGVwdGgsIGN1cnJlbnREZXB0aCArIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBjYWxjdWxhdGVUZW1wOiBmdW5jdGlvbiBjYWxjdWxhdGVUZW1wKGFycikgewogICAgICB2YXIgc3VtID0gMDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgc3VtICs9IGFycltpXVsxXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHN1bTsKICAgIH0sCiAgICBjYWxjdWxhdGVUZW1wMjogZnVuY3Rpb24gY2FsY3VsYXRlVGVtcDIodHJlZSkgewogICAgICB2YXIgc3VtID0gMDsKICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyh0cmVlKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIHN1bSArPSB0cmVlW2tleXNbaV1dOwogICAgICB9CgogICAgICByZXR1cm4gc3VtOwogICAgfSwKICAgIHNvcnRBcnJheTogZnVuY3Rpb24gc29ydEFycmF5KHNlcSwgcGF0dGVybl9kYXRhKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgdHJlZSA9IHt9OwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZXEubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgaXRlbSA9IHNlcVtpXTsKCiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRyZWUpLmluY2x1ZGVzKGl0ZW1bMF0pKSB7CiAgICAgICAgICB0cmVlW2l0ZW1bMF1dICs9IGl0ZW1bMV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRyZWVbaXRlbVswXV0gPSBpdGVtWzFdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIF90aGlzLnNvcnRUcmVlKHRyZWUsIHBhdHRlcm5fZGF0YSk7CiAgICB9LAogICAgc29ydFRyZWU6IGZ1bmN0aW9uIHNvcnRUcmVlKHRyZWUsIHBhdHRlcm5fZGF0YSkgewogICAgICAvLyDlpb3nu5Pngrk6W+aMieeFp3N0YWdl57G75Yir5o6S5bqPXSzlnY/oioLngrk6W+aMieeFp3N0YWdl57G75Yir5o6S5bqPXQogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHRyZWVfa2V5cyA9IE9iamVjdC5rZXlzKHRyZWUpOwogICAgICB2YXIgYmV0dGVyX2xpc3QgPSB7fTsKICAgICAgdmFyIHdvcnNlX2xpc3QgPSB7fTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJlZV9rZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGtleSA9IHRyZWVfa2V5c1tpXTsKICAgICAgICB2YXIgbnVtYmVyID0gdHJlZVt0cmVlX2tleXNbaV1dOwoKICAgICAgICBpZiAocGF0dGVybl9kYXRhWzBdW2tleV1bMF0gPiBwYXR0ZXJuX2RhdGFbMF1ba2V5XVsxXSkgewogICAgICAgICAgYmV0dGVyX2xpc3Rba2V5XSA9IG51bWJlcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgd29yc2VfbGlzdFtrZXldID0gbnVtYmVyOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIFtiZXR0ZXJfbGlzdCwgd29yc2VfbGlzdF07CiAgICB9LAogICAgZHJhd19nbHlwaDogZnVuY3Rpb24gZHJhd19nbHlwaChzdmcsIHBhdGhwYXR0ZXJuLCBwYXRodHJhbnNpdGlvbiwgY29sb3IsIGZsYWcpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHN2Zy5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IiwgMzY1KS5hdHRyKCJ5IiwgNDAwKS5hdHRyKCJ3aWR0aCIsIDcwKS5hdHRyKCJoZWlnaHQiLCAyMCkuYXR0cigiZmlsbCIsICcjNWI1YjViJykuYXR0cigic3Ryb2tlIiwgJyM1YjViNWInKS5hdHRyKCJvcGFjaXR5IiwgMC4xKTsKICAgICAgc3ZnLmFwcGVuZCgicmVjdCIpLmF0dHIoIngiLCAzNTIpLmF0dHIoInkiLCAzOTUpLmF0dHIoIndpZHRoIiwgOTYpLmF0dHIoImhlaWdodCIsIDMwKS5hdHRyKCJmaWxsIiwgJ25vbmUnKS5hdHRyKCJzdHJva2UiLCAnIzViNWI1YicpLmF0dHIoIm9wYWNpdHkiLCAwLjIpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRocGF0dGVybi5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpIDwgcGF0aHBhdHRlcm4ubGVuZ3RoIC0gMSkgewogICAgICAgICAgc3ZnLmFwcGVuZCgibGluZSIpLmF0dHIoIngxIiwgMzg0ICsgaSAqIDMwKS5hdHRyKCJ4MiIsIDM4NCArIChpICsgMSkgKiAzMCkuYXR0cigieTEiLCA0MTApLmF0dHIoInkyIiwgNDEwKS5hdHRyKCJzdHJva2UiLCAiYmxhY2siKTsKICAgICAgICB9CgogICAgICAgIHN2Zy5hcHBlbmQoImNpcmNsZSIpLmF0dHIoImN4IiwgMzg0ICsgaSAqIDMwKS5hdHRyKCJjeSIsIDQxMCkuYXR0cigiciIsIDcpLmF0dHIoImZpbGwiLCBjb2xvcihwYXJzZUludChwYXRocGF0dGVybltpXSkpKS5hdHRyKCJzdHJva2UiLCAnIzViNWI1YicpOwogICAgICB9CgogICAgICB2YXIgaGVpZ2h0X3BhdGggPSAzMDsKICAgICAgdmFyIGdvb2QgPSBwYXRodHJhbnNpdGlvblswXTsKICAgICAgdmFyIGJhZCA9IHBhdGh0cmFuc2l0aW9uWzFdOyAvLyDnlLvkuK3lv4PnmoTliY3pnaLlkozlkI7pnaLnmoTot6/lvoTovaznp7sKCiAgICAgIGlmIChmbGFnID09ICJsIikgewogICAgICAgIHN2Zy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCJ4IiwgNDM1KS5hdHRyKCJ5IiwgMzk1KS5hdHRyKCJmaWxsIiwgX3RoaXMuYmV0dGVyX2NvbG9yKS5hdHRyKCJ3aWR0aCIsIDEzKS5hdHRyKCJoZWlnaHQiLCBoZWlnaHRfcGF0aCAqIGdvb2QpLmF0dHIoIm9wYWNpdHkiLCAwLjgpOwogICAgICAgIHN2Zy5hcHBlbmQoJ3JlY3QnKS5hdHRyKCJ4IiwgNDM1KS5hdHRyKCJ5IiwgMzk1ICsgaGVpZ2h0X3BhdGggKiBnb29kKS5hdHRyKCJmaWxsIiwgX3RoaXMud29yc2VfY29sb3IpLmF0dHIoIndpZHRoIiwgMTMpLmF0dHIoImhlaWdodCIsIGhlaWdodF9wYXRoICogYmFkKS5hdHRyKCJvcGFjaXR5IiwgMC44KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdmcuYXBwZW5kKCdyZWN0JykuYXR0cigieCIsIDM1MikuYXR0cigieSIsIDM5NSkuYXR0cigiZmlsbCIsIF90aGlzLmJldHRlcl9jb2xvcikuYXR0cigid2lkdGgiLCAxMykuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0X3BhdGggKiBnb29kKS5hdHRyKCJvcGFjaXR5IiwgMC44KTsKICAgICAgICBzdmcuYXBwZW5kKCdyZWN0JykuYXR0cigieCIsIDM1MikuYXR0cigieSIsIDM5NSArIGhlaWdodF9wYXRoICogZ29vZCkuYXR0cigiZmlsbCIsIF90aGlzLndvcnNlX2NvbG9yKS5hdHRyKCJ3aWR0aCIsIDEzKS5hdHRyKCJoZWlnaHQiLCBoZWlnaHRfcGF0aCAqIGJhZCkuYXR0cigib3BhY2l0eSIsIDAuOCk7CiAgICAgIH0KICAgIH0sCiAgICBjYWxjdWxhdGVfbm9kZTogZnVuY3Rpb24gY2FsY3VsYXRlX25vZGUodHJlZSwgcGF0dGVybl9kYXRhKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgcmVzdWx0X24xID0gW107CiAgICAgIHZhciByZXN1bHRfbjIgPSBbXTsgLy8g6K6h566X5Ye66L+Z5Liq6IqC54K555qE5a2Q6IqC54K56aKR546H5pyA6auY55qE5Zub5LiqCgogICAgICB2YXIgdHJlZV9rZXlzID0gT2JqZWN0LmtleXModHJlZSk7CiAgICAgIHZhciBkYXRhID0ge307CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyZWVfa2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGRhdGFbdHJlZV9rZXlzW2ldXSA9IHRyZWVbdHJlZV9rZXlzW2ldXVsnY291bnQnXTsKICAgICAgfQoKICAgICAgdmFyIHJlc3VsdCA9IF90aGlzLm1heG5PYnRhaW4oZGF0YSwgNCk7IC8vY29uc29sZS5sb2coInRoZSBmb3VyIG5vZGVzIG5leHQiLCByZXN1bHQpCgoKICAgICAgZm9yICh2YXIgX2kxMSA9IDA7IF9pMTEgPCByZXN1bHQubGVuZ3RoOyBfaTExKyspIHsKICAgICAgICBfdGhpcy5hbGxfbm9kZXMgPSBbXTsKCiAgICAgICAgX3RoaXMudHJhdmVyc2VUcmVlKHRyZWVbcmVzdWx0W19pMTFdWzBdXSk7CgogICAgICAgIGlmIChfdGhpcy5hbGxfbm9kZXMubGVuZ3RoID09IDApIHsKICAgICAgICAgIHJlc3VsdF9uMS5wdXNoKHJlc3VsdFtfaTExXVswXSk7CiAgICAgICAgICByZXN1bHRfbjIucHVzaCgnZW5kJyk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIHZhciB0cmFuc2l0aW9uID0gWzAsIDBdOyAvL+Wlve+8jOWdjwoKICAgICAgICBmb3IgKHZhciBfaTEyID0gMDsgX2kxMiA8IF90aGlzLmFsbF9ub2Rlcy5sZW5ndGg7IF9pMTIrKykgewogICAgICAgICAgdHJhbnNpdGlvblswXSArPSBwYXR0ZXJuX2RhdGFbMF1bX3RoaXMuYWxsX25vZGVzW19pMTJdWzBdXVswXSAqIF90aGlzLmFsbF9ub2Rlc1tfaTEyXVsxXTsKICAgICAgICAgIHRyYW5zaXRpb25bMV0gKz0gcGF0dGVybl9kYXRhWzBdW190aGlzLmFsbF9ub2Rlc1tfaTEyXVswXV1bMV0gKiBfdGhpcy5hbGxfbm9kZXNbX2kxMl1bMV07CiAgICAgICAgfQoKICAgICAgICB2YXIgczEgPSB0cmFuc2l0aW9uWzBdICsgdHJhbnNpdGlvblsxXTsKICAgICAgICB0cmFuc2l0aW9uWzBdIC89IHMxOwogICAgICAgIHRyYW5zaXRpb25bMV0gLz0gczE7CiAgICAgICAgcmVzdWx0X24xLnB1c2gocmVzdWx0W19pMTFdKTsKICAgICAgICByZXN1bHRfbjIucHVzaCh0cmFuc2l0aW9uKTsKICAgICAgfQoKICAgICAgcmV0dXJuIFtyZXN1bHRfbjEsIHJlc3VsdF9uMl07CiAgICB9LAogICAgY3JlYXRlVHJlZUZyb21TZXF1ZW5jZXM6IGZ1bmN0aW9uIGNyZWF0ZVRyZWVGcm9tU2VxdWVuY2VzKHNlcXVlbmNlcykgewogICAgICB2YXIgcm9vdCA9IHt9OwogICAgICBzZXF1ZW5jZXMuZm9yRWFjaChmdW5jdGlvbiAoc2VxdWVuY2UpIHsKICAgICAgICB2YXIgY3VycmVudE5vZGUgPSByb290OwogICAgICAgIHNlcXVlbmNlLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICBpZiAoIWN1cnJlbnROb2RlW3ZhbHVlXSkgewogICAgICAgICAgICBjdXJyZW50Tm9kZVt2YWx1ZV0gPSB7CiAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgIGNvdW50OiAwCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgY3VycmVudE5vZGVbdmFsdWVdLmNvdW50Kys7CiAgICAgICAgICBjdXJyZW50Tm9kZSA9IGN1cnJlbnROb2RlW3ZhbHVlXTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiByb290OwogICAgfSwKICAgIHRyYXZlcnNlVHJlZTogZnVuY3Rpb24gdHJhdmVyc2VUcmVlKG5vZGUpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChfdHlwZW9mKG5vZGUpID09PSAib2JqZWN0IikgewogICAgICAgIF90aGlzLmFsbF9ub2Rlcy5wdXNoKFtub2RlLnZhbHVlLCBub2RlLmNvdW50XSk7CgogICAgICAgIHZhciBjaGlsZE5vZGVzID0gT2JqZWN0LnZhbHVlcyhub2RlKTsKICAgICAgICBjaGlsZE5vZGVzLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkTm9kZSkgewogICAgICAgICAgaWYgKF90eXBlb2YoY2hpbGROb2RlKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgX3RoaXMudHJhdmVyc2VUcmVlKGNoaWxkTm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBkcmF3SW5kaXZpZHVhbFNlcXVlbmNlOiBmdW5jdGlvbiBkcmF3SW5kaXZpZHVhbFNlcXVlbmNlKHN0YWdlX251bWJlciwgZGF0YSwgeF9zdGFydCwgeV9zdGFydCwgcGF0dGVybl9kYXRhKSB7CiAgICAgIHZhciBzdmcgPSBkMy5zZWxlY3QoIi5ldmVudHByb2dyZXNzaW9uIikuYXBwZW5kKCJnIikuYXR0cigiY2xhc3MiLCAic3ZnIikuYXR0cigid2lkdGgiLCA4MDApLmF0dHIoImhlaWdodCIsIDc1MCkuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgwLCAiICsgKHlfc3RhcnQgKyAxMCkgKyAiKSIpOwogICAgICB2YXIgd2lkdGggPSA4MDA7CiAgICAgIHZhciBoZWlnaHQgPSAzNTA7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHVzZXJfbnVtYmVyID0gZGF0YS5sZW5ndGg7CiAgICAgIHZhciBkb21haW5feCA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGFnZV9udW1iZXI7IGkrKykgewogICAgICAgIGRvbWFpbl94LnB1c2goaSk7CiAgICAgIH0KCiAgICAgIHZhciBjb2xvciA9IGQzLnNjYWxlT3JkaW5hbCgpLmRvbWFpbihkb21haW5feCkucmFuZ2UoX3RoaXMuY29sb3JfbGlzdCk7CiAgICAgIHZhciB4X3NjYWxlID0gZDMuc2NhbGVMaW5lYXIoKS5yYW5nZShbeF9zdGFydCArIDEwLCB4X3N0YXJ0ICsgMTAwXSkuZG9tYWluKFswLCA1XSk7CiAgICAgIHZhciB5X3NjYWxlID0gZDMuc2NhbGVMaW5lYXIoKS5yYW5nZShbeV9zdGFydCArIDQwLCB5X3N0YXJ0ICsgNDAgKyBoZWlnaHRdKS5kb21haW4oWzAsIDIwXSk7CgogICAgICBmb3IgKHZhciBfaTEzID0gMDsgX2kxMyA8IDM1OyBfaTEzKyspIHsKICAgICAgICB2YXIgbGF0dGVyX3RvZ2V0aGVyID0gMDsKCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkYXRhW19pMTNdLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAobGF0dGVyX3RvZ2V0aGVyID09IDApIHsKICAgICAgICAgICAgLy8g5Yik5pat5ZCO6Z2i6L+Y5pyJ5aSa5bCR5Liq5pWw5o2uCiAgICAgICAgICAgIHZhciBsYXR0ZXJfbnVtID0gZGF0YVtfaTEzXS5sZW5ndGggLSBqIC0gMTsKICAgICAgICAgICAgdmFyIHZhbHVlID0gMDsgLy/mnIDlpJrkuI3ogIPomZHotoXov4cz5Liq5pWw5o2uCgogICAgICAgICAgICBpZiAobGF0dGVyX251bSA+IDMpIHsKICAgICAgICAgICAgICBsYXR0ZXJfbnVtID0gMzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGxhdHRlcl9udW0gPT0gMCkgewogICAgICAgICAgICAgIHZhciB2YWx1ZV9hcnIgPSBwYXR0ZXJuX2RhdGFbMF1bZGF0YVtfaTEzXVtqXVswXVswXS50b1N0cmluZygpXTsKCiAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZV9hcnJbMF0gLSB2YWx1ZV9hcnJbMV07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgdCA9IGxhdHRlcl9udW07IHQgPj0gMDsgdC0tKSB7CiAgICAgICAgICAgICAgICAvLyDlkI7pnaLot5/lh6DkuKrmlbDmja7ngrkKICAgICAgICAgICAgICAgIHZhciBrZXlfdGVtcCA9IGRhdGFbX2kxM11bal1bMF1bMF0udG9TdHJpbmcoKTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBwID0gMTsgcCA8PSB0OyBwKyspIHsKICAgICAgICAgICAgICAgICAga2V5X3RlbXAgPSBrZXlfdGVtcCArIGRhdGFbX2kxM11baiArIHBdWzBdWzBdLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHBhdHRlcm5fZGF0YVsxXS5pbmNsdWRlcyhrZXlfdGVtcCkpIHsKICAgICAgICAgICAgICAgICAgbGF0dGVyX3RvZ2V0aGVyID0gdDsKICAgICAgICAgICAgICAgICAgdmFyIF92YWx1ZV9hcnIgPSBwYXR0ZXJuX2RhdGFbMF1ba2V5X3RlbXBdOwogICAgICAgICAgICAgICAgICB2YWx1ZSA9IF92YWx1ZV9hcnJbMF0gLSBfdmFsdWVfYXJyWzFdOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN2Zy5hcHBlbmQoInJlY3QiKS5hdHRyKCJ4IiwgeF9zY2FsZShqKSAtIDcpLmF0dHIoInkiLCB5X3NjYWxlKF9pMTMpIC0gOCkuYXR0cigid2lkdGgiLCB4X3NjYWxlKGogKyBsYXR0ZXJfdG9nZXRoZXIpIC0geF9zY2FsZShqKSArIDE0KS5hdHRyKCJoZWlnaHQiLCAxNSkuYXR0cigiZmlsbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAodmFsdWUgPiAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuYmV0dGVyX2NvbG9yOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMud29yc2VfY29sb3I7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5hdHRyKCJvcGFjaXR5IiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocGF0dGVybl9kYXRhKQogICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAwLjYgKyAtdmFsdWU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAwLjYgKyB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsYXR0ZXJfdG9nZXRoZXIgPSBsYXR0ZXJfdG9nZXRoZXIgKyAxOwogICAgICAgICAgfQoKICAgICAgICAgIHN2Zy5hcHBlbmQoImNpcmNsZSIpLmF0dHIoImN4IiwgeF9zY2FsZShqKSkuYXR0cigiY3kiLCB5X3NjYWxlKF9pMTMpKS5hdHRyKCJyIiwgNikuYXR0cigic3Ryb2tlIiwgIiM1YjViNWIiKS5hdHRyKCJmaWxsIiwgY29sb3IoZGF0YVtfaTEzXVtqXVswXVswXSkpOwogICAgICAgICAgbGF0dGVyX3RvZ2V0aGVyID0gbGF0dGVyX3RvZ2V0aGVyIC0gMTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBkZWVwQ2xvbmU6IGZ1bmN0aW9uIGRlZXBDbG9uZShpbml0YWxPYmosIGZpbmFsT2JqKSB7CiAgICAgIHZhciBvYmogPSBmaW5hbE9iaiB8fCB7fTsKCiAgICAgIGZvciAodmFyIGkgaW4gaW5pdGFsT2JqKSB7CiAgICAgICAgdmFyIHByb3AgPSBpbml0YWxPYmpbaV07IC8vIOmBv+WFjeebuOS6kuW8leeUqOWvueixoeWvvOiHtOatu+W+queOr++8jOWmgmluaXRhbE9iai5hID0gaW5pdGFsT2Jq55qE5oOF5Ya1CgogICAgICAgIGlmIChwcm9wID09PSBvYmopIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKF90eXBlb2YocHJvcCkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICBvYmpbaV0gPSBwcm9wLmNvbnN0cnVjdG9yID09PSBBcnJheSA/IFtdIDoge307CiAgICAgICAgICBhcmd1bWVudHMuY2FsbGVlKHByb3AsIG9ialtpXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9ialtpXSA9IHByb3A7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gb2JqOwogICAgfSwKICAgIGRyYXdldmVudHByb2dyZXNzaW9uU2Fua2V5OiBmdW5jdGlvbiBkcmF3ZXZlbnRwcm9ncmVzc2lvblNhbmtleShzdGFnZV9udW1iZXIsIGRhdGEsIHBhdHRlcm5fZGF0YSkgewogICAgICB2YXIgeV9zdGFydCA9IDA7CiAgICAgIHZhciBkb21haW5feCA9IFtdOwoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhZ2VfbnVtYmVyOyBpKyspIHsKICAgICAgICBkb21haW5feC5wdXNoKGkpOwogICAgICB9CgogICAgICB2YXIgY29sb3IgPSBkMy5zY2FsZU9yZGluYWwoKS5kb21haW4oZG9tYWluX3gpLnJhbmdlKF90aGlzLmNvbG9yX2xpc3QpOwogICAgICB2YXIgd2lkdGggPSA4NTA7CiAgICAgIHZhciBoZWlnaHQgPSA0MDA7CiAgICAgIHZhciB1c2VyX251bWJlciA9IGRhdGEubGVuZ3RoOwogICAgICB2YXIgc3ZnID0gZDMuc2VsZWN0KCIuZXZlbnRwcm9ncmVzc2lvbiIpLmFwcGVuZCgiZyIpLmF0dHIoImNsYXNzIiwgInByb2dyZXNzaW9ub3ZlcnZpZXciKS5hdHRyKCJ3aWR0aCIsIDg1MCkuYXR0cigiaGVpZ2h0IiwgNDUwKS5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKDAsIDEwKSIpOwogICAgICB2YXIgc3RhZ2VzID0gW107CgogICAgICBmb3IgKHZhciBfaTE0ID0gMDsgX2kxNCA8IHN0YWdlX251bWJlcjsgX2kxNCsrKSB7CiAgICAgICAgc3RhZ2VzLnB1c2goX2kxNCk7CiAgICAgIH0KCiAgICAgIHZhciBkYXRhX3NlcXVlbmNlID0gW107CgogICAgICBmb3IgKHZhciBfaTE1ID0gMDsgX2kxNSA8IHVzZXJfbnVtYmVyOyBfaTE1KyspIHsKICAgICAgICAvL+WvueS6juavj+S4gOS4quS6ugogICAgICAgIHZhciBpbmRpdmlkdWFsX3NlcXVlbmNlID0gW107CgogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGF0YVtfaTE1XS5sZW5ndGggLSAxOyBqKyspIHsKICAgICAgICAgIC8v5a+55LqO5q+P5LiA5Liq5pe26Ze0CiAgICAgICAgICBpbmRpdmlkdWFsX3NlcXVlbmNlLnB1c2goZGF0YVtfaTE1XVtqXVswXVswXSk7CiAgICAgICAgfQoKICAgICAgICBkYXRhX3NlcXVlbmNlLnB1c2goaW5kaXZpZHVhbF9zZXF1ZW5jZSk7CiAgICAgIH0KCiAgICAgIHZhciBrZXlfc2VxdWVuY2UgPSBbXTsKICAgICAgdmFyIHZhbHVlX3NlcXVlbmNlID0gW107IC8vIOiuoeeul+avj+S4queCueWxnuS6juS7gOS5iHBhdHRlcm7vvIznm7jlvZPkuo7nu5nmr4/kuKrngrnotYvkuohwYXR0ZXJuIGtleQoKICAgICAgZm9yICh2YXIgX2kxNiA9IDA7IF9pMTYgPCBkYXRhX3NlcXVlbmNlLmxlbmd0aDsgX2kxNisrKSB7CiAgICAgICAgdmFyIGxhdHRlcl90b2dldGhlciA9IDA7CiAgICAgICAgdmFyIGluZGl2aWR1YWxfa2V5ID0gW107CiAgICAgICAgdmFyIGluZGl2aWR1YWxfdmFsdWUgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgX2o1ID0gMDsgX2o1IDwgZGF0YV9zZXF1ZW5jZVtfaTE2XS5sZW5ndGg7IF9qNSsrKSB7CiAgICAgICAgICBpZiAobGF0dGVyX3RvZ2V0aGVyID09IDApIHsKICAgICAgICAgICAgLy8g5Yik5pat5ZCO6Z2i6L+Y5pyJ5aSa5bCR5Liq5pWw5o2uCiAgICAgICAgICAgIHZhciBsYXR0ZXJfbnVtID0gZGF0YV9zZXF1ZW5jZVtfaTE2XS5sZW5ndGggLSBfajUgLSAxOwogICAgICAgICAgICB2YXIgdmFsdWUgPSAwOwogICAgICAgICAgICB2YXIga2V5X3RlbXAgPSAnJzsgLy/mnIDlpJrkuI3ogIPomZHotoXov4cx5Liq5pWw5o2uCgogICAgICAgICAgICBpZiAobGF0dGVyX251bSA+IDEpIHsKICAgICAgICAgICAgICBsYXR0ZXJfbnVtID0gMTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGxhdHRlcl9udW0gPT0gMCkgewogICAgICAgICAgICAgIHZhciB2YWx1ZV9hcnIgPSBwYXR0ZXJuX2RhdGFbMF1bZGF0YV9zZXF1ZW5jZVtfaTE2XVtfajVdLnRvU3RyaW5nKCldOwoKICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlX2FyclswXSAtIHZhbHVlX2FyclsxXTsKICAgICAgICAgICAgICBrZXlfdGVtcCA9IGRhdGFfc2VxdWVuY2VbX2kxNl1bX2o1XS50b1N0cmluZygpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZvciAodmFyIHQgPSBsYXR0ZXJfbnVtOyB0ID49IDA7IHQtLSkgewogICAgICAgICAgICAgICAgLy8g5ZCO6Z2i6Lef5Yeg5Liq5pWw5o2u54K5CiAgICAgICAgICAgICAgICBrZXlfdGVtcCA9IGRhdGFfc2VxdWVuY2VbX2kxNl1bX2o1XS50b1N0cmluZygpOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIHAgPSAxOyBwIDw9IHQ7IHArKykgewogICAgICAgICAgICAgICAgICBrZXlfdGVtcCA9IGtleV90ZW1wICsgZGF0YV9zZXF1ZW5jZVtfaTE2XVtfajUgKyBwXS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChwYXR0ZXJuX2RhdGFbMV0uaW5jbHVkZXMoa2V5X3RlbXApKSB7CiAgICAgICAgICAgICAgICAgIGxhdHRlcl90b2dldGhlciA9IHQ7CiAgICAgICAgICAgICAgICAgIHZhciBfdmFsdWVfYXJyMiA9IHBhdHRlcm5fZGF0YVswXVtrZXlfdGVtcF07CiAgICAgICAgICAgICAgICAgIHZhbHVlID0gX3ZhbHVlX2FycjJbMF0gLSBfdmFsdWVfYXJyMlsxXTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKHZhciBfdDMgPSAwOyBfdDMgPCBsYXR0ZXJfdG9nZXRoZXIgKyAxOyBfdDMrKykgewogICAgICAgICAgICAgIGluZGl2aWR1YWxfa2V5LnB1c2goa2V5X3RlbXApOwogICAgICAgICAgICAgIGluZGl2aWR1YWxfdmFsdWUucHVzaCh2YWx1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxhdHRlcl90b2dldGhlciA9IGxhdHRlcl90b2dldGhlciArIDE7CiAgICAgICAgICB9CgogICAgICAgICAgbGF0dGVyX3RvZ2V0aGVyID0gbGF0dGVyX3RvZ2V0aGVyIC0gMTsKICAgICAgICB9CgogICAgICAgIGtleV9zZXF1ZW5jZS5wdXNoKGluZGl2aWR1YWxfa2V5KTsKICAgICAgICB2YWx1ZV9zZXF1ZW5jZS5wdXNoKGluZGl2aWR1YWxfdmFsdWUpOwogICAgICB9IC8vIOmcgOimgeWvueavj+S4gOS4quaXtumXtOeCuee7tOaMgeS4gOS4quefqemYteOAjDEtMe+8jDEtMu+8jDEtM++8jC4uLi7jgI3liIbliKvmnInlpJrlsJHkuroKCgogICAgICB2YXIgdGltZV9tYXRyaXggPSB7fTsKCiAgICAgIGZvciAodmFyIF9pMTcgPSAwOyBfaTE3IDwgZGF0YV9zZXF1ZW5jZS5sZW5ndGg7IF9pMTcrKykgewogICAgICAgIGZvciAodmFyIF9qNiA9IDA7IF9qNiA8IGRhdGFfc2VxdWVuY2VbX2kxN10ubGVuZ3RoOyBfajYrKykgewogICAgICAgICAgdmFyIGN1cnJlbnRfc3RhZ2UgPSBkYXRhX3NlcXVlbmNlW19pMTddW19qNl07CiAgICAgICAgICB2YXIgbmV4dF9zdGFnZSA9ICd4JzsKCiAgICAgICAgICBpZiAoX2o2IDwgZGF0YV9zZXF1ZW5jZVtfaTE3XS5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgIG5leHRfc3RhZ2UgPSBkYXRhX3NlcXVlbmNlW19pMTddW19qNiArIDFdOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBrZXlfdHJhbnNpdGlvbiA9IGN1cnJlbnRfc3RhZ2UudG9TdHJpbmcoKSArIG5leHRfc3RhZ2UudG9TdHJpbmcoKTsKCiAgICAgICAgICBpZiAoT2JqZWN0LmtleXModGltZV9tYXRyaXgpLmluY2x1ZGVzKF9qNi50b1N0cmluZygpKSkgewogICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModGltZV9tYXRyaXhbX2o2LnRvU3RyaW5nKCldKS5pbmNsdWRlcyhrZXlfdHJhbnNpdGlvbikpIHsKICAgICAgICAgICAgICB0aW1lX21hdHJpeFtfajYudG9TdHJpbmcoKV1ba2V5X3RyYW5zaXRpb25dID0gdGltZV9tYXRyaXhbX2o2LnRvU3RyaW5nKCldW2tleV90cmFuc2l0aW9uXSArIDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGltZV9tYXRyaXhbX2o2LnRvU3RyaW5nKCldW2tleV90cmFuc2l0aW9uXSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRpbWVfbWF0cml4W19qNi50b1N0cmluZygpXSA9IHt9OwogICAgICAgICAgICB0aW1lX21hdHJpeFtfajYudG9TdHJpbmcoKV1ba2V5X3RyYW5zaXRpb25dID0gMTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBvdmVyYWxsX3NjYWxlID0gNTAwIC8gZGF0YS5sZW5ndGggKiAwLjY7CiAgICAgIHZhciB4X3NjYWxlID0gZDMuc2NhbGVMaW5lYXIoKS5kb21haW4oWzAsIE9iamVjdC5rZXlzKHRpbWVfbWF0cml4KS5sZW5ndGggLSAxXSkucmFuZ2UoWzIwLCA4MzBdKTsKICAgICAgdmFyIHlfc2NhbGUgPSAwLjUgKiBvdmVyYWxsX3NjYWxlOwogICAgICB2YXIgc3ZnX25vZGVfYm91bmRpbmdib3ggPSBzdmcuYXBwZW5kKCdnJykuYXR0cigid2lkdGgiLCAyNTApLmF0dHIoImhlaWdodCIsIDMwMCk7IC8vIOiusOW9leavj+S4quiKgueCueW8gOWni+eahOS9jee9rgoKICAgICAgdmFyIHlfcG9zaXRpb24gPSB7fTsKICAgICAgdmFyIHlfcG9zaXRpb24yID0ge307CiAgICAgIHZhciB5X3Bvc2l0aW9uX2VuZCA9IG5ldyBBcnJheSgpOyAvLyDlhYjnlLvlh7rkuobmnIDlkI7kuIDliJfnmoTlhbbku5bmiYDmnInliJcKCiAgICAgIGZvciAodmFyIF9pMTggPSAwOyBfaTE4IDwgT2JqZWN0LmtleXModGltZV9tYXRyaXgpLmxlbmd0aDsgX2kxOCsrKSB7CiAgICAgICAgdmFyIHlfc3RhcnRfdGVtcCA9IDMwOwoKICAgICAgICBmb3IgKHZhciBfcDMgPSAwOyBfcDMgPCBzdGFnZV9udW1iZXI7IF9wMysrKSB7CiAgICAgICAgICB2YXIga2V5X3R0ID0gX2kxOC50b1N0cmluZygpICsgX3AzLnRvU3RyaW5nKCk7IC8vY29uc29sZS5sb2coa2V5X3R0KQoKCiAgICAgICAgICB5X3Bvc2l0aW9uX2VuZFtrZXlfdHRdID0geV9zdGFydF90ZW1wOyAvL2NvbnNvbGUubG9nKHlfcG9zaXRpb25fZW5kKQoKICAgICAgICAgIGZvciAodmFyIHEgPSAwOyBxIDwgc3RhZ2VfbnVtYmVyOyBxKyspIHsKICAgICAgICAgICAgdmFyIF9rZXlfdCA9IF9wMy50b1N0cmluZygpICsgcS50b1N0cmluZygpOwoKICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRpbWVfbWF0cml4W19pMThdKS5pbmNsdWRlcyhfa2V5X3QpKSB7CiAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHlfcG9zaXRpb24pLmluY2x1ZGVzKF9pMTgudG9TdHJpbmcoKSkpIHsKICAgICAgICAgICAgICAgIHlfcG9zaXRpb25bX2kxOC50b1N0cmluZygpXVtfa2V5X3RdID0geV9zdGFydF90ZW1wOwogICAgICAgICAgICAgICAgeV9wb3NpdGlvbjJbX2kxOC50b1N0cmluZygpXVtfa2V5X3RdID0geV9zdGFydF90ZW1wOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB5X3Bvc2l0aW9uW19pMTgudG9TdHJpbmcoKV0gPSB7fTsKICAgICAgICAgICAgICAgIHlfcG9zaXRpb24yW19pMTgudG9TdHJpbmcoKV0gPSB7fTsKICAgICAgICAgICAgICAgIHlfcG9zaXRpb25bX2kxOC50b1N0cmluZygpXVtfa2V5X3RdID0geV9zdGFydF90ZW1wOwogICAgICAgICAgICAgICAgeV9wb3NpdGlvbjJbX2kxOC50b1N0cmluZygpXVtfa2V5X3RdID0geV9zdGFydF90ZW1wOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgeV9zdGFydF90ZW1wID0geV9zdGFydF90ZW1wICsgeV9zY2FsZSAqIHRpbWVfbWF0cml4W19pMThdW19rZXlfdF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIga2V5X3QgPSBfcDMudG9TdHJpbmcoKSArICd4JzsgLy/ogIPomZHmnIDmnKvlsL7nmoTkvY3nva4KCiAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoeV9wb3NpdGlvbikuaW5jbHVkZXMoX2kxOC50b1N0cmluZygpKSkgewogICAgICAgICAgICB5X3Bvc2l0aW9uW19pMTgudG9TdHJpbmcoKV1ba2V5X3RdID0geV9zdGFydF90ZW1wOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeV9wb3NpdGlvbltfaTE4LnRvU3RyaW5nKCldID0ge307CiAgICAgICAgICAgIHlfcG9zaXRpb25bX2kxOC50b1N0cmluZygpXVtrZXlfdF0gPSB5X3N0YXJ0X3RlbXA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRpbWVfbWF0cml4W19pMThdKS5pbmNsdWRlcyhrZXlfdCkpIHsKICAgICAgICAgICAgeV9zdGFydF90ZW1wID0geV9zdGFydF90ZW1wICsgeV9zY2FsZSAqIHRpbWVfbWF0cml4W19pMThdW2tleV90XTsKICAgICAgICAgIH0KCiAgICAgICAgICB5X3N0YXJ0X3RlbXAgPSB5X3N0YXJ0X3RlbXAgKyAxMDsKICAgICAgICB9CiAgICAgIH0gLy8g55S7bGluawoKCiAgICAgIHZhciBoX3NjYWxlID0gMC41ICogb3ZlcmFsbF9zY2FsZTsKICAgICAgdmFyIHN2Z19saW5rMSA9IHN2Zy5hcHBlbmQoJ2cnKS5hdHRyKCJ3aWR0aCIsIDI1MCkuYXR0cigiaGVpZ2h0IiwgMzAwKS5zdHlsZSgiei1pbmRleCIsIDEpLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoMCwgNSkiKTsKICAgICAgdmFyIHN2Z19saW5rMiA9IHN2Zy5hcHBlbmQoJ2cnKS5hdHRyKCJ3aWR0aCIsIDI1MCkuYXR0cigiaGVpZ2h0IiwgMzAwKS5zdHlsZSgiei1pbmRleCIsIDIpLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoMCwgNSkiKTsKICAgICAgdmFyIGxpbmVHZW5lcmF0b3IgPSBkMy5saW5lKCkueChmdW5jdGlvbiAoZCkgewogICAgICAgIHJldHVybiBkLng7CiAgICAgIH0pLnkoZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4gZC55OwogICAgICB9KS5jdXJ2ZShkMy5jdXJ2ZUNhdG11bGxSb20uYWxwaGEoMC41KSk7CiAgICAgIHZhciB5X3Bvc2l0aW9uX2tleXMgPSBPYmplY3Qua2V5cyh5X3Bvc2l0aW9uKTsKCiAgICAgIGZvciAodmFyIF9pMTkgPSAwOyBfaTE5IDwgeV9wb3NpdGlvbl9rZXlzLmxlbmd0aCAtIDE7IF9pMTkrKykgewogICAgICAgIC8v56ys5Yeg5Liq5pe26Ze0CiAgICAgICAgdmFyIHlfcG9zaXRpb25fa2V5czIgPSBPYmplY3Qua2V5cyh5X3Bvc2l0aW9uW19pMTldKTsgLy/or6Xml7bpl7TnmoRzdGFnZS1zdGFnZQoKICAgICAgICBmb3IgKHZhciBfcDQgPSAwOyBfcDQgPCBzdGFnZV9udW1iZXI7IF9wNCsrKSB7CiAgICAgICAgICBmb3IgKHZhciBfcTQgPSAwOyBfcTQgPCBzdGFnZV9udW1iZXI7IF9xNCsrKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50X3BhaXIgPSBfcDQudG9TdHJpbmcoKSArIF9xNC50b1N0cmluZygpOwoKICAgICAgICAgICAgaWYgKHlfcG9zaXRpb25fa2V5czIuaW5jbHVkZXMoY3VycmVudF9wYWlyKSkgewogICAgICAgICAgICAgIHZhciBjdXJyZW50X3kgPSB5X3Bvc2l0aW9uMlt5X3Bvc2l0aW9uX2tleXNbX2kxOV1dW2N1cnJlbnRfcGFpcl07CgogICAgICAgICAgICAgIHZhciBfbmV4dF9zdGFnZSA9IF9xNC50b1N0cmluZygpOwoKICAgICAgICAgICAgICBpZiAoX25leHRfc3RhZ2UgIT0gJ3gnKSB7CiAgICAgICAgICAgICAgICB2YXIgX2tleV90dCA9IHlfcG9zaXRpb25fa2V5c1tfaTE5XSArIF9uZXh0X3N0YWdlOwoKICAgICAgICAgICAgICAgIHZhciBrZXlfdHRfbmV4dCA9IChwYXJzZUludCh5X3Bvc2l0aW9uX2tleXNbX2kxOV0pICsgMSkudG9TdHJpbmcoKSArIF9uZXh0X3N0YWdlOwoKICAgICAgICAgICAgICAgIHZhciBuZXh0X3kgPSB5X3Bvc2l0aW9uX2VuZFtrZXlfdHRfbmV4dF07CiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0X3RlbXAgPSB0aW1lX21hdHJpeFt5X3Bvc2l0aW9uX2tleXNbX2kxOV1dW2N1cnJlbnRfcGFpcl0gKiBoX3NjYWxlOwogICAgICAgICAgICAgICAgdmFyIGRhdGFfdGVtcCA9IFt7CiAgICAgICAgICAgICAgICAgIHg6IHhfc2NhbGUoX2kxOSkgKyAxNSwKICAgICAgICAgICAgICAgICAgeTogY3VycmVudF95ICsgaGVpZ2h0X3RlbXAgLyAyCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIHg6IHhfc2NhbGUoX2kxOSkgKyAyNSwKICAgICAgICAgICAgICAgICAgeTogY3VycmVudF95ICsgaGVpZ2h0X3RlbXAgLyAyCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIHg6IHhfc2NhbGUoX2kxOSArIDEpIC0gNSwKICAgICAgICAgICAgICAgICAgeTogbmV4dF95ICsgaGVpZ2h0X3RlbXAgLyAyCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIHg6IHhfc2NhbGUoX2kxOSArIDEpICsgMTAsCiAgICAgICAgICAgICAgICAgIHk6IG5leHRfeSArIGhlaWdodF90ZW1wIC8gMgogICAgICAgICAgICAgICAgfV07CgogICAgICAgICAgICAgICAgaWYgKGhlaWdodF90ZW1wID4gMTApIHsKICAgICAgICAgICAgICAgICAgc3ZnX2xpbmsyLmFwcGVuZCgicGF0aCIpLmRhdHVtKGRhdGFfdGVtcCkuYXR0cigiZmlsbCIsICJub25lIikuYXR0cigic3Ryb2tlIiwgX3RoaXMuc2Fua2V5X2xpbmVjb2xvcikuYXR0cigic3Ryb2tlLXdpZHRoIiwgaGVpZ2h0X3RlbXApLmF0dHIoIm9wYWNpdHkiLCAwLjUpLmF0dHIoImQiLCBsaW5lR2VuZXJhdG9yKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHN2Z19saW5rMS5hcHBlbmQoInBhdGgiKS5kYXR1bShkYXRhX3RlbXApLmF0dHIoImZpbGwiLCAibm9uZSIpLmF0dHIoInN0cm9rZSIsIF90aGlzLnNhbmtleV9saW5lY29sb3IpLmF0dHIoInN0cm9rZS13aWR0aCIsIGhlaWdodF90ZW1wKS5hdHRyKCJvcGFjaXR5IiwgMC4yKS5hdHRyKCJkIiwgbGluZUdlbmVyYXRvcik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgeV9wb3NpdGlvbl9lbmRba2V5X3R0X25leHRdID0geV9wb3NpdGlvbl9lbmRba2V5X3R0X25leHRdICsgaGVpZ2h0X3RlbXA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgc3ZnX25vZGUgPSBzdmcuYXBwZW5kKCdnJykuYXR0cigid2lkdGgiLCAyNTApLmF0dHIoImhlaWdodCIsIDMwMCkuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgwLCA1KSIpOwoKICAgICAgZm9yICh2YXIgX2kyMCA9IDA7IF9pMjAgPCBkYXRhX3NlcXVlbmNlLmxlbmd0aDsgX2kyMCsrKSB7CiAgICAgICAgdmFyIHlfbGFzdCA9IDA7CgogICAgICAgIGZvciAodmFyIF9qNyA9IDA7IF9qNyA8IGRhdGFfc2VxdWVuY2VbX2kyMF0ubGVuZ3RoOyBfajcrKykgewogICAgICAgICAgdmFyIF9rZXlfdDIgPSAnJzsKCiAgICAgICAgICBpZiAoX2o3ID09IGRhdGFfc2VxdWVuY2VbX2kyMF0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgICBfa2V5X3QyID0gZGF0YV9zZXF1ZW5jZVtfaTIwXVtfajddLnRvU3RyaW5nKCkgKyAneCc7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfa2V5X3QyID0gZGF0YV9zZXF1ZW5jZVtfaTIwXVtfajddLnRvU3RyaW5nKCkgKyBkYXRhX3NlcXVlbmNlW19pMjBdW19qNyArIDFdLnRvU3RyaW5nKCk7CiAgICAgICAgICB9CgogICAgICAgICAgc3ZnX25vZGUuYXBwZW5kKCdyZWN0JykuYXR0cigneCcsIHhfc2NhbGUoX2o3KSkuYXR0cigneScsIHlfcG9zaXRpb25bX2o3XVtfa2V5X3QyXSkuYXR0cignaGVpZ2h0JywgeV9zY2FsZSkuYXR0cignd2lkdGgnLCAyMCkuYXR0cignZmlsbCcsIGNvbG9yKGRhdGFfc2VxdWVuY2VbX2kyMF1bX2o3XSkpLmF0dHIoJ3N0cm9rZScsIGNvbG9yKGRhdGFfc2VxdWVuY2VbX2kyMF1bX2o3XSkpLmF0dHIoJ2NsYXNzJywgJ25vZGUnICsga2V5X3NlcXVlbmNlW19pMjBdW19qN10pOwogICAgICAgICAgeV9wb3NpdGlvbltfajddW19rZXlfdDJdID0geV9wb3NpdGlvbltfajddW19rZXlfdDJdICsgeV9zY2FsZTsgLy/nlLtsaW5r77yM6Lef5LiK5LiA5Liq54K56L+e6LW35p2l77yM5L2G5piv6L+Z5LiN5pivc2Fua2V555qE55S75rOVCiAgICAgICAgICAvLyBpZiAoaiAhPSAwKXsKICAgICAgICAgIC8vICAgICBzdmdfbm9kZS5hcHBlbmQoJ2xpbmUnKQogICAgICAgICAgLy8gICAgICAgICAuYXR0cigieDEiLCB4X3NjYWxlKGopKQogICAgICAgICAgLy8gICAgICAgICAuYXR0cigieDIiLCB4X3NjYWxlKGotMSkgKyAyMCkKICAgICAgICAgIC8vICAgICAgICAgLmF0dHIoInkxIiwgeV9wb3NpdGlvbltqXVtrZXlfdF0pCiAgICAgICAgICAvLyAgICAgICAgIC5hdHRyKCJ5MiIsIHlfbGFzdCkKICAgICAgICAgIC8vICAgICAgICAgLmF0dHIoInN0cm9rZSIsICJibGFjayIpCiAgICAgICAgICAvLyB9CgogICAgICAgICAgeV9sYXN0ID0geV9wb3NpdGlvbltfajddW19rZXlfdDJdOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGRyYXdldmVudHByb2dyZXNzaW9uOiBmdW5jdGlvbiBkcmF3ZXZlbnRwcm9ncmVzc2lvbihzdGFnZV9udW1iZXIsIGRhdGEsIHlfc3RhcnQpIHsKICAgICAgLy9jb25zb2xlLmxvZygiZXZlbnQgcHJvZ3Jlc3Npb24gdmlldyIsIGRhdGEpCiAgICAgIHZhciB3aWR0aCA9IDgwMDsKICAgICAgdmFyIGhlaWdodCA9IDc1MDsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgdXNlcl9udW1iZXIgPSBkYXRhLmxlbmd0aDsKICAgICAgdmFyIHN2ZyA9IGQzLnNlbGVjdCgiLmV2ZW50cHJvZ3Jlc3Npb24iKS5hcHBlbmQoImciKS5hdHRyKCJjbGFzcyIsICJzdmciKS5hdHRyKCJ3aWR0aCIsIDgwMCkuYXR0cigiaGVpZ2h0IiwgNzUwKS5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKDAsICIgKyAoeV9zdGFydCArIDEwKSArICIpIik7CiAgICAgIHZhciBkYXRhX2RpYyA9IG5ldyBBcnJheSgpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNzsgaSsrKSB7CiAgICAgICAgZGF0YV9kaWNbaV0gPSBuZXcgQXJyYXkoKTsKCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzdGFnZV9udW1iZXI7IGorKykgewogICAgICAgICAgZGF0YV9kaWNbaV1bal0gPSAwOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHN1Ymdyb3VwcyA9IFtdOwoKICAgICAgZm9yICh2YXIgX2o4ID0gMDsgX2o4IDwgc3RhZ2VfbnVtYmVyOyBfajgrKykgewogICAgICAgIHN1Ymdyb3Vwcy5wdXNoKCdzdGFnZScgKyBfajgpOwogICAgICB9CgogICAgICBmb3IgKHZhciBfaTIxID0gMDsgX2kyMSA8IGRhdGEubGVuZ3RoOyBfaTIxKyspIHsKICAgICAgICAvL+esrGnkuKrkuroKICAgICAgICBmb3IgKHZhciBfajkgPSAwOyBfajkgPCBkYXRhW19pMjFdLmxlbmd0aDsgX2o5KyspIHsKICAgICAgICAgIGlmIChfajkgPT0gMjcpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHN0YWdlID0gZGF0YVtfaTIxXVtfajldWzNdOwogICAgICAgICAgZGF0YV9kaWNbX2o5XVtzdGFnZV0gKz0gMTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBkYXRhX3ZpcyA9IFtdOwoKICAgICAgZm9yICh2YXIgX2kyMiA9IDA7IF9pMjIgPCAyNzsgX2kyMisrKSB7CiAgICAgICAgdmFyIHRlbXAgPSBuZXcgQXJyYXkoKTsKICAgICAgICB0ZW1wWyJncm91cCJdID0gX2kyMiArIDE7CgogICAgICAgIGZvciAodmFyIF9qMTAgPSAwOyBfajEwIDwgc3RhZ2VfbnVtYmVyOyBfajEwKyspIHsKICAgICAgICAgIHRlbXBbInN0YWdlIiArIF9qMTBdID0gZGF0YV9kaWNbX2kyMl1bX2oxMF07CiAgICAgICAgfQoKICAgICAgICBkYXRhX3Zpcy5wdXNoKHRlbXApOwogICAgICB9CgogICAgICBkYXRhID0gZGF0YV92aXM7CiAgICAgIHZhciBncm91cHMgPSBkMy5tYXAoZGF0YSwgZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4gZC5ncm91cDsKICAgICAgfSkua2V5cygpOyAvLyBBZGQgWCBheGlzCgogICAgICB2YXIgeCA9IGQzLnNjYWxlQmFuZCgpLmRvbWFpbihncm91cHMpLnJhbmdlKFsyMCwgd2lkdGhdKS5wYWRkaW5nKFswLjJdKTsKICAgICAgc3ZnLmFwcGVuZCgiZyIpLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoMCwiICsgaGVpZ2h0ICsgIikiKS5jYWxsKGQzLmF4aXNCb3R0b20oeCkudGlja1NpemVPdXRlcigwKSk7IC8vIEFkZCBZIGF4aXMKCiAgICAgIHZhciB5ID0gZDMuc2NhbGVMaW5lYXIoKS5kb21haW4oWzAsIHVzZXJfbnVtYmVyXSkucmFuZ2UoW2hlaWdodCwgMjBdKTsKICAgICAgc3ZnLmFwcGVuZCgiZyIpLmNhbGwoZDMuYXhpc0xlZnQoeSkpLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoMjcsIDApIik7IC8vIGNvbG9yIHBhbGV0dGUgPSBvbmUgY29sb3IgcGVyIHN1Ymdyb3VwCgogICAgICB2YXIgY29sb3IgPSBkMy5zY2FsZU9yZGluYWwoKS5kb21haW4oc3ViZ3JvdXBzKS5yYW5nZShkMy5zY2hlbWVUYWJsZWF1MTApOyAvLyDmiormr4/kuKpzdGFnZeWvueW6lOeahOminOiJsuaJk+WNsOWHuuadpQoKICAgICAgaWYgKHlfc3RhcnQgPT0gMCkgewogICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgc3ViZ3JvdXBzLmxlbmd0aDsgYysrKSB7CiAgICAgICAgICBzdmcuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsIDEwICsgYyAqIDYwKS5hdHRyKCJ5IiwgMykuYXR0cigiZmlsbCIsIGNvbG9yKHN1Ymdyb3Vwc1tjXSkpLmF0dHIoIndpZHRoIiwgMTApLmF0dHIoImhlaWdodCIsIDEwKTsKICAgICAgICAgIHN2Zy5hcHBlbmQoInRleHQiKS5hdHRyKCJ4IiwgMTAgKyBjICogNjAgKyAxNSkuYXR0cigieSIsIDEwKS5hdHRyKCJmb250LXNpemUiLCA3KS50ZXh0KHN1Ymdyb3Vwc1tjXSk7CiAgICAgICAgfQogICAgICB9IC8vc3RhY2sgdGhlIGRhdGE/IC0tPiBzdGFjayBwZXIgc3ViZ3JvdXAKCgogICAgICB2YXIgc3RhY2tlZERhdGEgPSBkMy5zdGFjaygpLmtleXMoc3ViZ3JvdXBzKShkYXRhKTsgLy9jb25zb2xlLmxvZyhzdGFja2VkRGF0YSkKCiAgICAgIHN2Zy5hcHBlbmQoImciKS5zZWxlY3RBbGwoImciKSAvLyBFbnRlciBpbiB0aGUgc3RhY2sgZGF0YSA9IGxvb3Aga2V5IHBlciBrZXkgPSBncm91cCBwZXIgZ3JvdXAKICAgICAgLmRhdGEoc3RhY2tlZERhdGEpLmpvaW4oImciKS5hdHRyKCJmaWxsIiwgZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4gY29sb3IoZC5rZXkpOwogICAgICB9KS5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgcmV0dXJuICJteVJlY3QgIiArIGQua2V5OwogICAgICB9KSAvLyBBZGQgYSBjbGFzcyB0byBlYWNoIHN1Ymdyb3VwOiB0aGVpciBuYW1lCiAgICAgIC5zZWxlY3RBbGwoInJlY3QiKSAvLyBlbnRlciBhIHNlY29uZCB0aW1lID0gbG9vcCBzdWJncm91cCBwZXIgc3ViZ3JvdXAgdG8gYWRkIGFsbCByZWN0YW5nbGVzCiAgICAgIC5kYXRhKGZ1bmN0aW9uIChkKSB7CiAgICAgICAgcmV0dXJuIGQ7CiAgICAgIH0pLmpvaW4oInJlY3QiKS5hdHRyKCJ4IiwgZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4geChkLmRhdGEuZ3JvdXApOwogICAgICB9KS5hdHRyKCJ5IiwgZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4geShkWzFdKTsKICAgICAgfSkuYXR0cigiaGVpZ2h0IiwgZnVuY3Rpb24gKGQpIHsKICAgICAgICByZXR1cm4geShkWzBdKSAtIHkoZFsxXSk7CiAgICAgIH0pLmF0dHIoIndpZHRoIiwgeC5iYW5kd2lkdGgoKSkuYXR0cigic3Ryb2tlIiwgIiM1YjViNWIiKS5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24gKGV2ZW50LCBkKSB7CiAgICAgICAgLy8gV2hhdCBoYXBwZW5zIHdoZW4gdXNlciBob3ZlciBhIGJhcgogICAgICAgIC8vIHdoYXQgc3ViZ3JvdXAgYXJlIHdlIGhvdmVyaW5nCiAgICAgICAgdmFyIHN1Ykdyb3VwTmFtZSA9IGQzLnNlbGVjdCh0aGlzLnBhcmVudE5vZGUpLmRhdHVtKCkua2V5OyAvLyBSZWR1Y2Ugb3BhY2l0eSBvZiBhbGwgcmVjdCB0byAwLjIKCiAgICAgICAgZDMuc2VsZWN0QWxsKCIubXlSZWN0Iikuc3R5bGUoIm9wYWNpdHkiLCAwLjIpOyAvLyBIaWdobGlnaHQgYWxsIHJlY3RzIG9mIHRoaXMgc3ViZ3JvdXAgd2l0aCBvcGFjaXR5IDEuIEl0IGlzIHBvc3NpYmxlIHRvIHNlbGVjdCB0aGVtIHNpbmNlIHRoZXkgaGF2ZSBhIHNwZWNpZmljIGNsYXNzID0gdGhlaXIgbmFtZS4KCiAgICAgICAgZDMuc2VsZWN0QWxsKCIuIiArIHN1Ykdyb3VwTmFtZSkuc3R5bGUoIm9wYWNpdHkiLCAxKTsKICAgICAgfSkub24oIm1vdXNlbGVhdmUiLCBmdW5jdGlvbiAoZXZlbnQsIGQpIHsKICAgICAgICAvLyBXaGVuIHVzZXIgZG8gbm90IGhvdmVyIGFueW1vcmUKICAgICAgICBkMy5zZWxlY3RBbGwoIi5teVJlY3QiKS5zdHlsZSgib3BhY2l0eSIsIDEpOwogICAgICB9KTsKICAgIH0KICB9Cn07"},{"version":3,"sources":["/Users/shengrui/Desktop/system_framework-main/frontend/src/components/EventprogressionView/EventprogressionView.js"],"names":["dataService","pipeService","d3","$","data","Sankey","sliderBottom","sliderLeft","formatPrefix","path","schemeGnBu","symbolDiamond2","name","components","props","computed","color_back","color_back_individual","opacity_back","line_color","sankey_linecolor","background_color","hover_color","pattern_data","Array","segment_data","start_flag","better_color","worse_color","angle_color","color_list","all_nodes","divide_line","overall","y_position","y_position_binary","transition_map","extracted_sequence","width_bar","y_scale_h","clickpath","watch","_this","draweventprogressionSankey","remove","attr","emitPatternNone","mounted","drawLegendSelect","onPattern","dicMap","listMap","onSegment","console","log","t","i","length","j","stageMap","p","onClickPath","drawKeyPath","svg","select","append","svg_bound","methods","number2literalMap","stage","drawStageCopy","key","key_list","split","map","Number","targetSVG","style","sourceG1","sourceG2","targetG1","targetG2","html","lst","result","temp_t","temp_n","parseInt","toString","push","dic","keys","Object","k_t","k_n","g_legend","on","text","drawLegend","stage_number","domain_x","color","scaleOrdinal","domain","range","c","splitString","S","P","segment","startsWith","slice","judgeSubString","parentString","subString","flag","flag_temp","findSubstringPositions","str","substr","positions","pos","indexOf","path_data","data_sequence","data_string","temp_individual","temp_string","data_extracted","path_latter","path_former","f_temp","substring","l_temp","f_temp_segment","l_temp_segment","tree_former","createTreeFromSequences","tree_latter","lineGenerator","line","x","d","y","curve","curveCatmullRom","alpha","width","height","frequency_center","svg_center","y_start_bar","x_start_temp","svg_center_hover","degree","Math","abs","toFixed","path_transition_former","path_transition_latter","type","obtainSubPath","svg_temp","sortArray","t_sum","tt","y_start_temp","path_temp","drawPath","unshift","former_flow","calculateFlow","latter_flow","drawLink","flow","num","y_d","source_x","source_x2","source_y_better","source_y_worse","source_y_better2","source_y_worse2","data_temp","k","datum","lower","path_sequence","n","key1","key2","x_start","y_start","y_scale","class_name","y_end","drawSubPath","color_stroke","obtainAllPath","calculateRatio","sequence","key_degree_map","difference","key_p","Set","ij","add","includes","sequences_temp","path_transition_temp","data_final_t","data_final","temp_p","q","emitClickPath","temp_result","y_start_i","parseFloat","svg_temp2","node","depth","currentDepth","value","count","childNodes","values","forEach","childNode","calculateTemp","arr","sum","calculateTemp2","tree","seq","item","sortTree","tree_keys","better_list","worse_list","number","draw_glyph","pathpattern","pathtransition","height_path","good","bad","calculate_node","result_n1","result_n2","maxnObtain","traverseTree","transition","s1","sequences","root","currentNode","drawIndividualSequence","user_number","x_scale","scaleLinear","latter_together","latter_num","value_arr","key_temp","deepClone","initalObj","finalObj","obj","prop","constructor","arguments","callee","stages","individual_sequence","key_sequence","value_sequence","individual_key","individual_value","time_matrix","current_stage","next_stage","key_transition","overall_scale","svg_node_boundingbox","y_position2","y_position_end","key_tt","key_t","h_scale","svg_link1","svg_link2","y_position_keys","y_position_keys2","current_pair","current_y","key_tt_next","next_y","height_temp","svg_node","y_last","draweventprogression","data_dic","subgroups","data_vis","temp","groups","group","scaleBand","padding","call","axisBottom","tickSizeOuter","axisLeft","schemeTableau10","stackedData","stack","selectAll","join","bandwidth","event","subGroupName","parentNode"],"mappings":";;;;;;;;;;;;;;AAAA,OAAOA,WAAP;AACA,OAAOC,WAAP;AACA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;AACA,OAAOC,CAAP,IAAYC,IAAZ,QAAwB,QAAxB;AACA,OAAO,KAAKC,MAAZ;AACA,SAASC,YAAT,EAAuBC,UAAvB,QAAyC,kBAAzC;AACA,SAASC,YAAT,EAAuBC,IAAvB,EAA6BC,UAA7B,EAAyCC,cAAzC,QAA+D,IAA/D;AAEA,eAAe;AACXC,EAAAA,IAAI,EAAE,sBADK;AAEXC,EAAAA,UAAU,EAAE,EAFD;AAIXC,EAAAA,KAAK,EAAE,EAJI;AAMXC,EAAAA,QAAQ,EAAE,EANC;AAQXX,EAAAA,IARW,kBAQJ;AACH,WAAO;AACHY,MAAAA,UAAU,EAAE,SADT;AACoB;AACvBC,MAAAA,qBAAqB,EAAE,SAFpB;AAE+B;AAClCC,MAAAA,YAAY,EAAE,GAHX;AAIHC,MAAAA,UAAU,EAAE,SAJT;AAKHC,MAAAA,gBAAgB,EAAE,SALf;AAMHC,MAAAA,gBAAgB,EAAE,OANf;AAOHC,MAAAA,WAAW,EAAE,SAPV;AAQHC,MAAAA,YAAY,EAAE,IAAIC,KAAJ,EARX;AASHC,MAAAA,YAAY,EAAE,IAAID,KAAJ,EATX;AAUHE,MAAAA,UAAU,EAAE,CAVT;AAWHC,MAAAA,YAAY,EAAE,SAXX;AAYHC,MAAAA,WAAW,EAAE,SAZV;AAaHC,MAAAA,WAAW,EAAE,SAbV;AAaqB;AACxBC,MAAAA,UAAU,EAAE,CAAC,SAAD,EAAY,SAAZ,EAAuB,SAAvB,EAAkC,SAAlC,EAA6C,SAA7C,EAAwD,SAAxD,CAdT;AAeH;AACA;AACA;AACA;AACAC,MAAAA,SAAS,EAAE,EAnBR;AAoBHC,MAAAA,WAAW,EAAE,SApBV;AAqBHC,MAAAA,OAAO,EAAE,CArBN;AAqBS;AACZC,MAAAA,UAAU,EAAE,EAtBT;AAuBHC,MAAAA,iBAAiB,EAAE,EAvBhB;AAwBHC,MAAAA,cAAc,EAAE,EAxBb;AAyBHC,MAAAA,kBAAkB,EAAE,EAzBjB;AAyBqB;AACxBC,MAAAA,SAAS,EAAE,EA1BR;AA2BHC,MAAAA,SAAS,EAAE,CA3BR;AA4BHC,MAAAA,SAAS,EAAE;AA5BR,KAAP;AA8BH,GAvCU;AAwCXC,EAAAA,KAAK,EAAE;AACHf,IAAAA,UAAU,EAAE,sBAAY;AACpB,UAAMgB,KAAK,GAAG,IAAd;;AACA,UAAIA,KAAK,CAAChB,UAAN,IAAoB,CAAxB,EAA2B;AACvBgB,QAAAA,KAAK,CAACC,0BAAN,CAAiCD,KAAK,CAACjB,YAAN,CAAmB,CAAnB,CAAjC,EAAwDiB,KAAK,CAACjB,YAAN,CAAmB,CAAnB,EAAsB,CAAtB,CAAxD,EAAkFiB,KAAK,CAACnB,YAAxF;;AACAmB,QAAAA,KAAK,CAAChB,UAAN,GAAmB,CAAnB;AACH;AACJ,KAPE;AAQHO,IAAAA,OAAO,EAAE,mBAAY;AACjB,UAAMS,KAAK,GAAG,IAAd;;AACAvC,MAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0ByC,MAA1B;AACAzC,MAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB0C,IAArB,CAA0B,MAA1B,EAAkCH,KAAK,CAACrB,gBAAxC;AACAlB,MAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoB0C,IAApB,CAAyB,MAAzB,EAAiCH,KAAK,CAACrB,gBAAvC;;AACA,UAAIqB,KAAK,CAACT,OAAN,IAAiB,CAAjB,IAAsBS,KAAK,CAACT,OAAN,IAAiB,CAA3C,EAA8C;AAC1ChC,QAAAA,WAAW,CAAC6C,eAAZ,CAA4B,MAA5B;AACH;;AACD,UAAIJ,KAAK,CAACT,OAAN,IAAiB,CAArB,EAAwB;AACpB9B,QAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0ByC,MAA1B;AACAzC,QAAAA,CAAC,CAAC,iBAAD,CAAD,CAAqB0C,IAArB,CAA0B,MAA1B,EAAkCH,KAAK,CAACf,YAAxC;;AACAe,QAAAA,KAAK,CAACC,0BAAN,CAAiCD,KAAK,CAACjB,YAAN,CAAmB,CAAnB,CAAjC,EAAwDiB,KAAK,CAACjB,YAAN,CAAmB,CAAnB,EAAsB,CAAtB,CAAxD,EAAkFiB,KAAK,CAACnB,YAAxF;AACH;;AACD,UAAImB,KAAK,CAACT,OAAN,IAAiB,CAArB,EAAwB;AACpB9B,QAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0ByC,MAA1B;AACAzC,QAAAA,CAAC,CAAC,gBAAD,CAAD,CAAoB0C,IAApB,CAAyB,MAAzB,EAAiCH,KAAK,CAACd,WAAvC;;AACAc,QAAAA,KAAK,CAACC,0BAAN,CAAiCD,KAAK,CAACjB,YAAN,CAAmB,CAAnB,CAAjC,EAAwDiB,KAAK,CAACjB,YAAN,CAAmB,CAAnB,EAAsB,CAAtB,CAAxD,EAAkFiB,KAAK,CAACnB,YAAxF;AACH;AACJ;AA1BE,GAxCI;AAoEXwB,EAAAA,OAAO,EAAE,mBAAY;AACjB,QAAML,KAAK,GAAG,IAAd;;AACAA,IAAAA,KAAK,CAACM,gBAAN;;AACA/C,IAAAA,WAAW,CAACgD,SAAZ,CAAsB,UAAU1B,YAAV,EAAwB;AAC1C;AACAmB,MAAAA,KAAK,CAACnB,YAAN,CAAmB,CAAnB,IAAwBmB,KAAK,CAACQ,MAAN,CAAa3B,YAAY,CAAC,CAAD,CAAzB,CAAxB;AACAmB,MAAAA,KAAK,CAACnB,YAAN,CAAmB,CAAnB,IAAwBmB,KAAK,CAACS,OAAN,CAAc5B,YAAY,CAAC,CAAD,CAA1B,CAAxB;AACAmB,MAAAA,KAAK,CAAChB,UAAN,GAAmBgB,KAAK,CAAChB,UAAN,GAAmB,CAAtC;AACH,KALD;AAMAzB,IAAAA,WAAW,CAACmD,SAAZ,CAAsB,UAAUhD,IAAV,EAAgB;AAClCiD,MAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqClD,IAArC,EADkC,CAElC;;AACA,WAAK,IAAImD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxB,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpD,IAAI,CAAC,CAAD,CAAJ,CAAQmD,CAAR,EAAWE,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,eAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtD,IAAI,CAAC,CAAD,CAAJ,CAAQmD,CAAR,EAAWC,CAAX,EAAcC,MAAlC,EAA0CC,CAAC,EAA3C,EAA+C;AAC3CtD,YAAAA,IAAI,CAAC,CAAD,CAAJ,CAAQmD,CAAR,EAAWC,CAAX,EAAcE,CAAd,EAAiB,CAAjB,IAAsBhB,KAAK,CAACiB,QAAN,CAAevD,IAAI,CAAC,CAAD,CAAJ,CAAQmD,CAAR,EAAWC,CAAX,EAAcE,CAAd,EAAiB,CAAjB,CAAf,CAAtB;AACH;AACJ;AACJ;;AACD,WAAK,IAAIH,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG,CAApB,EAAuBA,EAAC,EAAxB,EAA4B;AACxB,aAAK,IAAIC,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGpD,IAAI,CAAC,CAAD,CAAJ,CAAQmD,EAAR,EAAWE,MAA/B,EAAuCD,EAAC,EAAxC,EAA4C;AACxC,eAAK,IAAIE,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGtD,IAAI,CAAC,CAAD,CAAJ,CAAQmD,EAAR,EAAWC,EAAX,EAAcC,MAAlC,EAA0CC,EAAC,EAA3C,EAA+C;AAC3C,iBAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGxD,IAAI,CAAC,CAAD,CAAJ,CAAQmD,EAAR,EAAWC,EAAX,EAAcE,EAAd,EAAiBD,MAArC,EAA6CG,CAAC,EAA9C,EAAkD;AAC9CxD,cAAAA,IAAI,CAAC,CAAD,CAAJ,CAAQmD,EAAR,EAAWC,EAAX,EAAcE,EAAd,EAAiBE,CAAjB,EAAoB,CAApB,IAAyBlB,KAAK,CAACiB,QAAN,CAAevD,IAAI,CAAC,CAAD,CAAJ,CAAQmD,EAAR,EAAWC,EAAX,EAAcE,EAAd,EAAiBE,CAAjB,EAAoB,CAApB,CAAf,CAAzB;AACH;AACJ;AACJ;AACJ;;AACDlB,MAAAA,KAAK,CAACjB,YAAN,GAAqBrB,IAArB;AACAsC,MAAAA,KAAK,CAAChB,UAAN,GAAmBgB,KAAK,CAAChB,UAAN,GAAmB,CAAtC;AACH,KArBD;AAuBAzB,IAAAA,WAAW,CAAC4D,WAAZ,CAAwB,UAAUzD,IAAV,EAAgB;AACpCsC,MAAAA,KAAK,CAACT,OAAN,GAAgB,CAAC,CAAjB;;AACA,UAAI7B,IAAI,CAAC,CAAD,CAAJ,IAAW,CAAC,CAAhB,EAAmB;AACfsC,QAAAA,KAAK,CAACN,cAAN,GAAuBhC,IAAI,CAAC,CAAD,CAA3B;AACAD,QAAAA,CAAC,CAAC,sBAAD,CAAD,CAA0ByC,MAA1B;AACAF,QAAAA,KAAK,CAACF,SAAN,GAAkBpC,IAAI,CAAC,CAAD,CAAtB;;AACAsC,QAAAA,KAAK,CAACoB,WAAN,CAAkBpB,KAAK,CAACjB,YAAN,CAAmB,CAAnB,CAAlB,EAAyCiB,KAAK,CAACjB,YAAN,CAAmB,CAAnB,CAAzC,EAAgEiB,KAAK,CAACnB,YAAtE,EAAoFnB,IAAI,CAAC,CAAD,CAAxF,EAA6FA,IAAI,CAAC,CAAD,CAAjG;AACH;AACJ,KARD,EAhCiB,CA0CjB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAM2D,GAAG,GAAG7D,EAAE,CAAC8D,MAAH,CAAU,2BAAV,EACPC,MADO,CACA,KADA,EAEPpB,IAFO,CAEF,OAFE,EAEO,GAFP,EAGPA,IAHO,CAGF,QAHE,EAGQ,GAHR,EAIPA,IAJO,CAIF,OAJE,EAIO,kBAJP,CAAZ;AAMA,QAAMqB,SAAS,GAAGH,GAAG,CAACE,MAAJ,CAAW,GAAX,EACbpB,IADa,CACR,OADQ,EACC,GADD,EAEbA,IAFa,CAER,QAFQ,EAEE,GAFF,EAGbA,IAHa,CAGR,WAHQ,EAGK,mBAHL,CAAlB;AAKH,GAjIU;AAkIXsB,EAAAA,OAAO,EAAE;AACLC,IAAAA,iBADK,6BACaC,KADb,EACmB;AACpB,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,GAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,GAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,GAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,GAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,GAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,GAAP;AACH;AACJ,KApBI;AAqBLC,IAAAA,aArBK,yBAqBSC,GArBT,EAqBc;AACf,UAAM7B,KAAK,GAAG,IAAd;;AACA,UAAM8B,QAAQ,GAAGD,GAAG,CAACE,KAAJ,CAAU,EAAV,EAAcC,GAAd,CAAkBC,MAAlB,CAAjB,CAFe,CAE6B;;AAC5CtB,MAAAA,OAAO,CAACC,GAAR,CAAYkB,QAAZ;AACAtE,MAAAA,EAAE,CAAC8D,MAAH,CAAU,eAAV,EAA2BpB,MAA3B;AACA,UAAMgC,SAAS,GAAG1E,EAAE,CAAC8D,MAAH,CAAU,mBAAV,EACbC,MADa,CACN,GADM,EAEbpB,IAFa,CAER,OAFQ,EAEC,GAFD,EAGbA,IAHa,CAGR,QAHQ,EAGE,GAHF,EAIbA,IAJa,CAIR,OAJQ,EAIC,cAJD,EAKbgC,KALa,CAKP,SALO,EAKI,CALJ,EAMbhC,IANa,CAMR,WANQ,EAMK,qBANL,CAAlB;AAQA+B,MAAAA,SAAS,CAACX,MAAV,CAAiB,MAAjB,EACKpB,IADL,CACU,GADV,EACe,CADf,EAEKA,IAFL,CAEU,GAFV,EAEe,CAFf,EAGKA,IAHL,CAGU,OAHV,EAGmB,GAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,GAJpB,EAKKA,IALL,CAKU,MALV,EAKkB,OALlB,EAMKA,IANL,CAMU,QANV,EAMoBH,KAAK,CAACtB,gBAN1B;;AAbe,iCAqBNoC,CArBM;AAsBX,YAAIsB,QAAQ,GAAG5E,EAAE,CAAC8D,MAAH,CAAU,kBAAkBQ,QAAQ,CAAChB,CAAD,CAApC,CAAf;AACA,YAAIuB,QAAQ,GAAG7E,EAAE,CAAC8D,MAAH,CAAU,uBAAuBQ,QAAQ,CAAChB,CAAD,CAAzC,CAAf,CAvBW,CAwBX;;AACAoB,QAAAA,SAAS,CAAC/B,IAAV,CAAe,OAAf,EAAwBiC,QAAQ,CAACjC,IAAT,CAAc,OAAd,CAAxB,EACKA,IADL,CACU,QADV,EACoBiC,QAAQ,CAACjC,IAAT,CAAc,QAAd,CADpB,EAzBW,CA4BX;;AACA,YAAImC,QAAQ,GAAGJ,SAAS,CAACX,MAAV,CAAiB,GAAjB,CAAf;AACA,YAAIgB,QAAQ,GAAGL,SAAS,CAACX,MAAV,CAAiB,GAAjB,CAAf;AAEAe,QAAAA,QAAQ,CAACE,IAAT,CAAcJ,QAAQ,CAACI,IAAT,EAAd,EACKrC,IADL,CACU,WADV,EACuB,YAAY;AAC3B,cAAI0B,GAAG,CAACd,MAAJ,IAAc,CAAlB,EAAqB;AACjB,mBAAO,2BAA2B,KAAKD,CAAC,GAAG,GAApC,IAA2C,MAAlD;AACH,WAFD,MAEO,IAAIe,GAAG,CAACd,MAAJ,IAAc,CAAlB,EAAqB;AACxB,mBAAO,2BAA2B,KAAKD,CAAC,GAAG,GAApC,IAA2C,MAAlD;AACH,WAFM,MAEA;AACH,mBAAO,8BAAP;AACH;AACJ,SATL;AAWAyB,QAAAA,QAAQ,CAACC,IAAT,CAAcH,QAAQ,CAACG,IAAT,EAAd,EACKrC,IADL,CACU,WADV,EACuB,YAAY;AAC3B,cAAI0B,GAAG,CAACd,MAAJ,IAAc,CAAlB,EAAqB;AACjB,mBAAO,2BAA2B,KAAKD,CAAC,GAAG,GAApC,IAA2C,MAAlD;AACH,WAFD,MAEO,IAAIe,GAAG,CAACd,MAAJ,IAAc,CAAlB,EAAqB;AACxB,mBAAO,2BAA2B,KAAKD,CAAC,GAAG,GAApC,IAA2C,MAAlD;AACH,WAFM,MAEA;AACH,mBAAO,8BAAP;AACH;AACJ,SATL;AA3CW;;AAqBf,WAAK,IAAIA,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGe,GAAG,CAACd,MAAxB,EAAgCD,CAAC,EAAjC,EAAqC;AAAA,cAA5BA,CAA4B;AAgCpC;AACJ,KA3EI;AA4ELL,IAAAA,OA5EK,mBA4EGgC,GA5EH,EA4EQ;AACT,UAAMzC,KAAK,GAAG,IAAd;;AACA,UAAI0C,MAAM,GAAG,EAAb;;AACA,WAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2B,GAAG,CAAC1B,MAAxB,EAAgCD,CAAC,EAAjC,EAAqC;AACjC,YAAI6B,MAAM,GAAGF,GAAG,CAAC3B,CAAD,CAAhB;AACA,YAAI8B,MAAM,GAAG,EAAb;;AACA,aAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2B,MAAM,CAAC5B,MAA3B,EAAmCC,CAAC,EAApC,EAAwC;AACpC4B,UAAAA,MAAM,IAAI5C,KAAK,CAACiB,QAAN,CAAe4B,QAAQ,CAACF,MAAM,CAAC3B,CAAD,CAAP,CAAvB,EAAoC8B,QAApC,EAAV;AACH;;AACDJ,QAAAA,MAAM,CAACK,IAAP,CAAYH,MAAZ;AACH;;AACD,aAAOF,MAAP;AACH,KAxFI;AAyFLlC,IAAAA,MAzFK,kBAyFEwC,GAzFF,EAyFO;AACR,UAAMhD,KAAK,GAAG,IAAd;;AACA,UAAIiD,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYD,GAAZ,CAAX;AACA,UAAMN,MAAM,GAAG,EAAf;;AACA,WAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmC,IAAI,CAAClC,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;AAClC,YAAIqC,GAAG,GAAGF,IAAI,CAACnC,CAAD,CAAd;AACA,YAAIsC,GAAG,GAAG,EAAV;;AACA,aAAK,IAAIpC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmC,GAAG,CAACpC,MAAxB,EAAgCC,CAAC,EAAjC,EAAqC;AACjCoC,UAAAA,GAAG,IAAIpD,KAAK,CAACiB,QAAN,CAAe4B,QAAQ,CAACM,GAAG,CAACnC,CAAD,CAAJ,CAAvB,EAAiC8B,QAAjC,EAAP;AACH;;AACDJ,QAAAA,MAAM,CAACU,GAAD,CAAN,GAAcJ,GAAG,CAACG,GAAD,CAAjB;AACH;;AACD,aAAOT,MAAP;AACH,KAtGI;AAuGLzB,IAAAA,QAvGK,oBAuGIU,KAvGJ,EAuGW;AACZ,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,CAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,CAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,CAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,CAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,CAAP;AACH;;AACD,UAAIA,KAAK,IAAI,CAAb,EAAgB;AACZ,eAAO,CAAP;AACH;AACJ,KA1HI;AA2HLrB,IAAAA,gBA3HK,8BA2Hc;AACf,UAAMN,KAAK,GAAG,IAAd;;AACA,UAAMqB,GAAG,GAAG7D,EAAE,CAAC8D,MAAH,CAAU,wBAAV,EACPC,MADO,CACA,KADA,EAEPpB,IAFO,CAEF,OAFE,EAEO,GAFP,EAGPA,IAHO,CAGF,QAHE,EAGQ,EAHR,CAAZ;AAKA,UAAIkD,QAAQ,GAAGhC,GAAG,CAACE,MAAJ,CAAW,GAAX,CAAf;AAEA8B,MAAAA,QAAQ,CAAC9B,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACe,EADf,EAEKA,IAFL,CAEU,GAFV,EAEe,CAFf,EAGKA,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,EAJpB,EAKKA,IALL,CAKU,MALV,EAKkBH,KAAK,CAACf,YALxB,EAMKkB,IANL,CAMU,QANV,EAMoB,OANpB,EAOKmD,EAPL,CAOQ,OAPR,EAOiB,YAAY;AACrBtD,QAAAA,KAAK,CAACT,OAAN,GAAgB,CAAhB;AACH,OATL,EAUKY,IAVL,CAUU,OAVV,EAUmB,gBAVnB;AAYAkD,MAAAA,QAAQ,CAAC9B,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACe,EADf,EAEKA,IAFL,CAEU,GAFV,EAEe,EAFf,EAGKA,IAHL,CAGU,WAHV,EAGuB,EAHvB,EAIKoD,IAJL,CAIU,QAJV;AAMAF,MAAAA,QAAQ,CAAC9B,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACe,EADf,EAEKA,IAFL,CAEU,GAFV,EAEe,CAFf,EAGKA,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,EAJpB,EAKKA,IALL,CAKU,MALV,EAKkBH,KAAK,CAACrB,gBALxB,EAMKwB,IANL,CAMU,QANV,EAMoB,OANpB,EAOKmD,EAPL,CAOQ,OAPR,EAOiB,YAAY;AACrBtD,QAAAA,KAAK,CAACT,OAAN,GAAgB,CAAhB;AACH,OATL,EAUKY,IAVL,CAUU,OAVV,EAUmB,eAVnB;AAYAkD,MAAAA,QAAQ,CAAC9B,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACe,EADf,EAEKA,IAFL,CAEU,GAFV,EAEe,EAFf,EAGKA,IAHL,CAGU,WAHV,EAGuB,EAHvB,EAIKoD,IAJL,CAIU,QAJV;AAMAF,MAAAA,QAAQ,CAAC9B,MAAT,CAAgB,QAAhB,EACKpB,IADL,CACU,IADV,EACgB,GADhB,EAEKA,IAFL,CAEU,IAFV,EAEgB,CAFhB,EAGKA,IAHL,CAGU,GAHV,EAGe,CAHf,EAIKA,IAJL,CAIU,MAJV,EAIkB,OAJlB,EAKKA,IALL,CAKU,QALV,EAKoB,KALpB;AAOAkD,MAAAA,QAAQ,CAAC9B,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACe,GADf,EAEKA,IAFL,CAEU,GAFV,EAEe,EAFf,EAGKA,IAHL,CAGU,WAHV,EAGuB,CAHvB,EAIKoD,IAJL,CAIU,GAJV,EAKKpD,IALL,CAKU,MALV,EAKkB,SALlB;AAMH,KArLI;AAsLLqD,IAAAA,UAtLK,sBAsLMC,YAtLN,EAsLoB;AACrB,UAAMzD,KAAK,GAAG,IAAd;;AACA,UAAMqB,GAAG,GAAG7D,EAAE,CAAC8D,MAAH,CAAU,wBAAV,EACPC,MADO,CACA,KADA,EAEPpB,IAFO,CAEF,OAFE,EAEO,GAFP,EAGPA,IAHO,CAGF,QAHE,EAGQ,EAHR,CAAZ;AAKA,UAAMuD,QAAQ,GAAG,EAAjB;;AACA,WAAK,IAAI5C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2C,YAApB,EAAkC3C,CAAC,EAAnC,EAAuC;AACnC4C,QAAAA,QAAQ,CAACX,IAAT,CAAcjC,CAAd;AACH;;AAED,UAAM6C,KAAK,GAAGnG,EAAE,CAACoG,YAAH,GACTC,MADS,CACFH,QADE,EAETI,KAFS,CAEH9D,KAAK,CAACZ,UAFH,CAAd;AAIA,UAAIiE,QAAQ,GAAGhC,GAAG,CAACE,MAAJ,CAAW,GAAX,CAAf;;AACA,WAAK,IAAIwC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,YAApB,EAAkCM,CAAC,EAAnC,EAAuC;AACnC1C,QAAAA,GAAG,CAACE,MAAJ,CAAW,QAAX,EACKpB,IADL,CACU,IADV,EACgB,KAAK4D,CAAC,GAAG,EADzB,EAEK5D,IAFL,CAEU,IAFV,EAEgB,EAFhB,EAGKA,IAHL,CAGU,GAHV,EAGe,CAHf,EAIKA,IAJL,CAIU,MAJV,EAIkBwD,KAAK,CAACI,CAAD,CAJvB,EAKK5D,IALL,CAKU,QALV,EAKoB,SALpB;AAOAkB,QAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,KAAK4D,CAAC,GAAG,EADxB,EAEK5D,IAFL,CAEU,GAFV,EAEe,EAFf,EAGKA,IAHL,CAGU,WAHV,EAGuB,EAHvB,EAIKoD,IAJL,CAIU,YAAYQ,CAAC,GAAG,CAAhB,CAJV;AAKH;AACJ,KArNI;AAsNLC,IAAAA,WAtNK,uBAsNOC,CAtNP,EAsNUC,CAtNV,EAsNa;AACd,UAAIxB,MAAM,GAAG,EAAb;;AAEA,aAAOuB,CAAC,CAAClD,MAAF,GAAW,CAAlB,EAAqB;AACjB,YAAIoD,OAAO,GAAG,EAAd;;AACA,aAAK,IAAIrD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoD,CAAC,CAACnD,MAAtB,EAA8BD,CAAC,EAA/B,EAAmC;AAC/B,cAAImD,CAAC,CAACG,UAAF,CAAaF,CAAC,CAACpD,CAAD,CAAd,CAAJ,EAAwB;AACpB,gBAAIoD,CAAC,CAACpD,CAAD,CAAD,CAAKC,MAAL,GAAcoD,OAAO,CAACpD,MAA1B,EAAkC;AAC9BoD,cAAAA,OAAO,GAAGD,CAAC,CAACpD,CAAD,CAAX;AACH;AACJ;AACJ;;AAED,YAAIqD,OAAO,KAAK,EAAhB,EAAoB;AAChB;AACA,iBAAO,IAAP;AACH;;AAEDzB,QAAAA,MAAM,CAACK,IAAP,CAAYoB,OAAZ;AACAF,QAAAA,CAAC,GAAGA,CAAC,CAACI,KAAF,CAAQF,OAAO,CAACpD,MAAhB,CAAJ;AACH;;AAED,aAAO2B,MAAP;AACH,KA7OI;AA8OL4B,IAAAA,cA9OK,0BA8OUC,YA9OV,EA8OwBC,SA9OxB,EA8OmC;AACpC,UAAIC,IAAI,GAAG,CAAX;;AACA,WAAK,IAAI3D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyD,YAAY,CAACxD,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;AAC1C,YAAIyD,YAAY,CAACzD,CAAD,CAAZ,IAAmB0D,SAAS,CAAC,CAAD,CAAhC,EAAqC;AACjC,cAAIE,SAAS,GAAG,CAAhB;;AACA,eAAK,IAAI1D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwD,SAAS,CAACzD,MAA9B,EAAsCC,CAAC,EAAvC,EAA2C;AACvC,gBAAIuD,YAAY,CAACzD,CAAC,GAAGE,CAAL,CAAZ,IAAuBwD,SAAS,CAACxD,CAAD,CAApC,EAAyC;AACrC0D,cAAAA,SAAS,GAAG,CAAZ;AACA;AACH;AACJ;;AACDD,UAAAA,IAAI,GAAGC,SAAP;;AACA,cAAID,IAAI,IAAI,CAAZ,EAAe;AACX,mBAAO,IAAP;AACH;AACJ;AACJ;;AACD,aAAO,KAAP;AACH,KAhQI;AAiQLE,IAAAA,sBAjQK,kCAiQkBC,GAjQlB,EAiQuBC,MAjQvB,EAiQ+B;AAChC,UAAMC,SAAS,GAAG,EAAlB;AACA,UAAIC,GAAG,GAAGH,GAAG,CAACI,OAAJ,CAAYH,MAAZ,CAAV;;AACA,aAAOE,GAAG,KAAK,CAAC,CAAhB,EAAmB;AACfD,QAAAA,SAAS,CAAC/B,IAAV,CAAegC,GAAf;AACAA,QAAAA,GAAG,GAAGH,GAAG,CAACI,OAAJ,CAAYH,MAAZ,EAAoBE,GAAG,GAAG,CAA1B,CAAN;AACH;;AACD,aAAOD,SAAP;AACH,KAzQI;AA0QL1D,IAAAA,WA1QK,uBA0QOqC,YA1QP,EA0QqB1E,YA1QrB,EA0QmCF,YA1QnC,EA0QiDiB,SA1QjD,EA0Q4DmF,SA1Q5D,EA0QuE;AACxE,UAAMjF,KAAK,GAAG,IAAd;;AACA,UAAMqB,GAAG,GAAG7D,EAAE,CAAC8D,MAAH,CAAU,mBAAV,EAA+BC,MAA/B,CAAsC,GAAtC,EACPpB,IADO,CACF,OADE,EACO,KADP,EAEPA,IAFO,CAEF,OAFE,EAEO,GAFP,EAGPA,IAHO,CAGF,QAHE,EAGQ,GAHR,EAIPA,IAJO,CAIF,OAJE,EAIO,qBAJP,EAKPA,IALO,CAKF,WALE,EAKW,iBALX,CAAZ,CAFwE,CASxE;;AACA,UAAM+E,aAAa,GAAG,EAAtB;AACA,UAAMC,WAAW,GAAG,EAApB;;AACA,WAAK,IAAIrE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG/B,YAAY,CAAC,CAAD,CAAZ,CAAgBgC,MAApC,EAA4CD,CAAC,EAA7C,EAAiD;AAC7C,YAAIsE,eAAe,GAAG,EAAtB;AACA,YAAIC,WAAW,GAAG,EAAlB;;AACA,aAAK,IAAIrE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGjC,YAAY,CAAC,CAAD,CAAZ,CAAgB+B,CAAhB,EAAmBC,MAAvC,EAA+CC,CAAC,EAAhD,EAAoD;AAChDoE,UAAAA,eAAe,CAACrC,IAAhB,CAAqBF,QAAQ,CAAC9D,YAAY,CAAC,CAAD,CAAZ,CAAgB+B,CAAhB,EAAmBE,CAAnB,EAAsB,CAAtB,CAAD,CAA7B;AACAqE,UAAAA,WAAW,GAAGA,WAAW,GAAGtG,YAAY,CAAC,CAAD,CAAZ,CAAgB+B,CAAhB,EAAmBE,CAAnB,EAAsB,CAAtB,CAA5B;AACH;;AACDkE,QAAAA,aAAa,CAACnC,IAAd,CAAmBqC,eAAnB;AACAD,QAAAA,WAAW,CAACpC,IAAZ,CAAiBsC,WAAjB;AACH;;AACD,WAAK,IAAIvE,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG/B,YAAY,CAAC,CAAD,CAAZ,CAAgBgC,MAApC,EAA4CD,GAAC,EAA7C,EAAiD;AAC7C,YAAIsE,gBAAe,GAAG,EAAtB;AACA,YAAIC,YAAW,GAAG,EAAlB;;AACA,aAAK,IAAIrE,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGjC,YAAY,CAAC,CAAD,CAAZ,CAAgB+B,GAAhB,EAAmBC,MAAvC,EAA+CC,GAAC,EAAhD,EAAoD;AAChDoE,UAAAA,gBAAe,CAACrC,IAAhB,CAAqBF,QAAQ,CAAC9D,YAAY,CAAC,CAAD,CAAZ,CAAgB+B,GAAhB,EAAmBE,GAAnB,EAAsB,CAAtB,CAAD,CAA7B;;AACAqE,UAAAA,YAAW,GAAGA,YAAW,GAAGtG,YAAY,CAAC,CAAD,CAAZ,CAAgB+B,GAAhB,EAAmBE,GAAnB,EAAsB,CAAtB,CAA5B;AACH;;AACDkE,QAAAA,aAAa,CAACnC,IAAd,CAAmBqC,gBAAnB;AACAD,QAAAA,WAAW,CAACpC,IAAZ,CAAiBsC,YAAjB;AACH,OA/BuE,CAgCxE;;;AACA,UAAMC,cAAc,GAAG,EAAvB;;AACA,WAAK,IAAIxE,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGqE,WAAW,CAACpE,MAAhC,EAAwCD,GAAC,EAAzC,EAA6C;AACzC,YAAId,KAAK,CAACsE,cAAN,CAAqBa,WAAW,CAACrE,GAAD,CAAhC,EAAqChB,SAArC,CAAJ,EAAqD;AACjDwF,UAAAA,cAAc,CAACvC,IAAf,CAAoBoC,WAAW,CAACrE,GAAD,CAA/B;AACH;AACJ;;AACD,UAAMyE,WAAW,GAAG,EAApB;AACA,UAAMC,WAAW,GAAG,EAApB;AACA,UAAM7F,kBAAkB,GAAG,EAA3B;;AACA,WAAK,IAAImB,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGwE,cAAc,CAACvE,MAAnC,EAA2CD,GAAC,EAA5C,EAAgD;AAC5C;AACA,YAAIgE,SAAS,GAAG9E,KAAK,CAAC2E,sBAAN,CAA6BW,cAAc,CAACxE,GAAD,CAA3C,EAAgDhB,SAAhD,CAAhB;;AACA,aAAK,IAAIkB,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG8D,SAAS,CAAC/D,MAA9B,EAAsCC,GAAC,EAAvC,EAA2C;AACvC,cAAI8D,SAAS,CAAC9D,GAAD,CAAT,IAAgB,CAAhB,IAAqB8D,SAAS,CAAC9D,GAAD,CAAT,GAAelB,SAAS,CAACiB,MAAzB,IAAmCuE,cAAc,CAACxE,GAAD,CAAd,CAAkBC,MAA9E,EAAsF;AAClF;AACH,WAFD,MAEO;AACH;AACA,gBAAI0E,MAAM,GAAGH,cAAc,CAACxE,GAAD,CAAd,CAAkB4E,SAAlB,CAA4B,CAA5B,EAA+BZ,SAAS,CAAC9D,GAAD,CAAxC,CAAb;;AACA,gBAAI2E,MAAM,GAAGL,cAAc,CAACxE,GAAD,CAAd,CAAkB4E,SAAlB,CAA4BZ,SAAS,CAAC9D,GAAD,CAAT,GAAelB,SAAS,CAACiB,MAArD,EAA6DuE,cAAc,CAACxE,GAAD,CAAd,CAAkBC,MAA/E,CAAb;;AACA,gBAAI6E,cAAc,GAAG5F,KAAK,CAACgE,WAAN,CAAkByB,MAAlB,EAA0B5G,YAAY,CAAC,CAAD,CAAtC,CAArB;;AACA,gBAAIgH,cAAc,GAAG7F,KAAK,CAACgE,WAAN,CAAkB2B,MAAlB,EAA0B9G,YAAY,CAAC,CAAD,CAAtC,CAArB;;AACA2G,YAAAA,WAAW,CAACzC,IAAZ,CAAiB6C,cAAjB;AACAL,YAAAA,WAAW,CAACxC,IAAZ,CAAiB8C,cAAjB;AACAlG,YAAAA,kBAAkB,CAACoD,IAAnB,CAAwB,CAAC/C,KAAK,CAACgE,WAAN,CAAkByB,MAAlB,EAA0B5G,YAAY,CAAC,CAAD,CAAtC,CAAD,EAA6CmB,KAAK,CAACgE,WAAN,CAAkB2B,MAAlB,EAA0B9G,YAAY,CAAC,CAAD,CAAtC,CAA7C,CAAxB;AACH;AACJ;AACJ;;AAED,UAAMiH,WAAW,GAAG9F,KAAK,CAAC+F,uBAAN,CAA8BP,WAA9B,CAApB;;AACA,UAAMQ,WAAW,GAAGhG,KAAK,CAAC+F,uBAAN,CAA8BR,WAA9B,CAApB;;AACA,UAAM7B,QAAQ,GAAG,EAAjB;;AACA,WAAK,IAAI5C,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG2C,YAApB,EAAkC3C,GAAC,EAAnC,EAAuC;AACnC4C,QAAAA,QAAQ,CAACX,IAAT,CAAcjC,GAAd;AACH;;AAED,UAAM6C,KAAK,GAAGnG,EAAE,CAACoG,YAAH,GACTC,MADS,CACFH,QADE,EAETI,KAFS,CAEH9D,KAAK,CAACZ,UAFH,CAAd;AAIA,UAAM6G,aAAa,GAAGzI,EAAE,CAAC0I,IAAH,GACjBC,CADiB,CACf,UAAUC,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACD,CAAT;AAAa,OADb,EAEjBE,CAFiB,CAEf,UAAUD,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACC,CAAT;AAAa,OAFb,EAGjBC,KAHiB,CAGX9I,EAAE,CAAC+I,eAAH,CAAmBC,KAAnB,CAAyB,GAAzB,CAHW,CAAtB,CAxEwE,CA6ExE;;AACA,UAAMC,KAAK,GAAG,GAAd;AACA,UAAMC,MAAM,GAAG,MAAM,GAArB;AACA,UAAM9G,SAAS,GAAG,EAAlB;AACA,UAAI+G,gBAAgB,GAAGnB,WAAW,CAACzE,MAAnC;AACA,UAAMlB,SAAS,GAAG6G,MAAM,GAAGC,gBAA3B;AACA3G,MAAAA,KAAK,CAACH,SAAN,GAAkBA,SAAlB;AACA,UAAI+G,UAAU,GAAGvF,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBpB,IAAhB,CAAqB,OAArB,EAA8B,QAA9B,CAAjB;AACAyG,MAAAA,UAAU,CAACrF,MAAX,CAAkB,MAAlB,EACKpB,IADL,CACU,GADV,EACesG,KAAK,GAAG,CAAR,GAAY,CAD3B,EAEKtG,IAFL,CAEU,GAFV,EAEe,EAFf,EAGKA,IAHL,CAGU,OAHV,EAGmBP,SAAS,GAAG,CAAZ,GAAgB,EAHnC,EAIKO,IAJL,CAIU,QAJV,EAIoBuG,MAAM,GAAG,EAJ7B,EAKKvG,IALL,CAKU,MALV,EAKkB,MALlB,EAMKA,IANL,CAMU,QANV,EAMoBH,KAAK,CAAC1B,UAN1B,EAOK6B,IAPL,CAOU,SAPV,EAOqBH,KAAK,CAACxB,YAP3B;AASA,UAAIqI,WAAW,GAAG,EAAlB;;AAEA,WAAK,IAAI/F,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGhB,SAAS,CAACiB,MAA9B,EAAsCD,GAAC,EAAvC,EAA2C;AACvC,YAAIgG,YAAY,GAAGL,KAAK,GAAG,CAAR,GAAY3F,GAAC,GAAGlB,SAAJ,GAAgB,CAAhB,GAAoBE,SAAS,CAACiB,MAA7D;;AACA,YAAIjB,SAAS,CAACiB,MAAV,IAAoB,CAAxB,EAA2B;AACvB+F,UAAAA,YAAY,GAAGL,KAAK,GAAG,CAAR,GAAY3F,GAAC,GAAGlB,SAAhB,GAA4B,CAA3C;AACH;;AACDgH,QAAAA,UAAU,CAACrF,MAAX,CAAkB,MAAlB,EACKpB,IADL,CACU,GADV,EACe2G,YADf,EAEK3G,IAFL,CAEU,GAFV,EAEe0G,WAFf,EAGK1G,IAHL,CAGU,OAHV,EAGmB,YAAY;AACvB,cAAIL,SAAS,CAACiB,MAAV,GAAmB,CAAvB,EAA0B;AACtB,mBAAOnB,SAAP;AACH,WAFD,MAEO;AACH,mBAAO,IAAIE,SAAS,CAACiB,MAAd,GAAuBnB,SAA9B;AACH;AACJ,SATL,EAUKO,IAVL,CAUU,QAVV,EAUoBN,SAAS,GAAG8G,gBAVhC,EAWKxG,IAXL,CAWU,MAXV,EAWkBwD,KAAK,CAACd,QAAQ,CAAC/C,SAAS,CAACgB,GAAD,CAAV,CAAT,CAXvB,EAYKX,IAZL,CAYU,QAZV,EAYoB,OAZpB,EAaKA,IAbL,CAaU,OAbV,EAamB,YAbnB,EAcKmD,EAdL,CAcQ,YAdR,EAcsB,YAAY;AAC1B7F,UAAAA,CAAC,CAAC,aAAD,CAAD,CAAiB0C,IAAjB,CAAsB,QAAtB,EAAgCH,KAAK,CAACpB,WAAtC,EAAmDuB,IAAnD,CAAwD,cAAxD,EAAwE,CAAxE;AACA1C,UAAAA,CAAC,CAAC,eAAD,CAAD,CAAmB0C,IAAnB,CAAwB,YAAxB,EAAsC,SAAtC,EAF0B,CAG1B;;AACAH,UAAAA,KAAK,CAAC4B,aAAN,CAAoB9B,SAApB;AACH,SAnBL,EAoBKwD,EApBL,CAoBQ,YApBR,EAoBsB,YAAY;AAC1B7F,UAAAA,CAAC,CAAC,aAAD,CAAD,CAAiB0C,IAAjB,CAAsB,QAAtB,EAAgC,OAAhC,EAAyCA,IAAzC,CAA8C,cAA9C,EAA8D,GAA9D;AACA1C,UAAAA,CAAC,CAAC,eAAD,CAAD,CAAmB0C,IAAnB,CAAwB,YAAxB,EAAsC,QAAtC;AACA3C,UAAAA,EAAE,CAAC8D,MAAH,CAAU,eAAV,EAA2BpB,MAA3B;AACH,SAxBL;AAyBH,OA9HuE,CAgIxE;;;AACA,UAAI6G,gBAAgB,GAAGH,UAAU,CAACrF,MAAX,CAAkB,GAAlB,EAAuBpB,IAAvB,CAA4B,OAA5B,EAAqC,cAArC,EAAqDA,IAArD,CAA0D,YAA1D,EAAwE,QAAxE,CAAvB;AACA4G,MAAAA,gBAAgB,CAACxF,MAAjB,CAAwB,MAAxB,EACKpB,IADL,CACU,GADV,EACesG,KAAK,GAAG,CAAR,GAAY7G,SAAS,GAAG,CADvC,EAEKO,IAFL,CAEU,GAFV,EAEeuG,MAAM,GAAG,CAFxB,EAGKvG,IAHL,CAGU,OAHV,EAGmB,GAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,EAJpB,EAKKA,IALL,CAKU,MALV,EAKkB,OALlB,EAMKA,IANL,CAMU,QANV,EAMoB,SANpB,EAOKA,IAPL,CAOU,cAPV,EAO0B,GAP1B;AASA,UAAI6G,MAAM,GAAGhH,KAAK,CAACnB,YAAN,CAAmB,CAAnB,EAAsBiB,SAAtB,CAAb;AAEAiH,MAAAA,gBAAgB,CAACxF,MAAjB,CAAwB,MAAxB,EACKpB,IADL,CACU,GADV,EACesG,KAAK,GAAG,CADvB,EAEKtG,IAFL,CAEU,GAFV,EAEeuG,MAAM,GAAG,CAAT,GAAa,CAF5B,EAGKvG,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,EAJpB,EAKKA,IALL,CAKU,QALV,EAKoB,YAAY;AACxB,YAAI6G,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAtB,EAA2B;AACvB,iBAAOhH,KAAK,CAACf,YAAb;AACH,SAFD,MAEO;AACH,iBAAOe,KAAK,CAACd,WAAb;AACH;AACJ,OAXL,EAYKiB,IAZL,CAYU,MAZV,EAYkB,MAZlB;AAcA4G,MAAAA,gBAAgB,CAACxF,MAAjB,CAAwB,MAAxB,EACKpB,IADL,CACU,GADV,EACesG,KAAK,GAAG,CAAR,GAAY,CAD3B,EAEKtG,IAFL,CAEU,GAFV,EAEeuG,MAAM,GAAG,CAAT,GAAa,EAF5B,EAGKvG,IAHL,CAGU,WAHV,EAGuB,EAHvB,EAIKoD,IAJL,CAIU,YAAY;AACd,eAAO0D,IAAI,CAACC,GAAL,CAAS,CAACF,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAnB,IAA0B,GAAnC,EAAwCG,OAAxC,CAAgD,CAAhD,CAAP;AACH,OANL,EAOKhH,IAPL,CAOU,MAPV,EAOkB,YAAY;AACtB,YAAI6G,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAtB,EAA2B;AACvB,iBAAOhH,KAAK,CAACf,YAAb;AACH,SAFD,MAEO;AACH,iBAAOe,KAAK,CAACd,WAAb;AACH;AACJ,OAbL;AAeA,UAAIkI,sBAAsB,GAAGpH,KAAK,CAACN,cAAN,CAAqBI,SAArB,EAAgC,CAAhC,CAA7B;AACA,UAAIuH,sBAAsB,GAAGrH,KAAK,CAACN,cAAN,CAAqBI,SAArB,EAAgC,CAAhC,CAA7B;AAEAiH,MAAAA,gBAAgB,CAACxF,MAAjB,CAAwB,MAAxB,EACKpB,IADL,CACU,GADV,EACesG,KAAK,GAAG,CAAR,GAAY,EAD3B,EAEKtG,IAFL,CAEU,GAFV,EAEeuG,MAAM,GAAG,CAAT,GAAa,CAF5B,EAGKvG,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,KAAKiH,sBAAsB,CAAC,CAAD,CAJ/C,EAKKjH,IALL,CAKU,QALV,EAKoB,MALpB,EAMKA,IANL,CAMU,MANV,EAMkBH,KAAK,CAACf,YANxB;AAQA8H,MAAAA,gBAAgB,CAACxF,MAAjB,CAAwB,MAAxB,EACKpB,IADL,CACU,GADV,EACesG,KAAK,GAAG,CAAR,GAAY,EAD3B,EAEKtG,IAFL,CAEU,GAFV,EAEeuG,MAAM,GAAG,CAAT,GAAa,CAAb,GAAiB,KAAKU,sBAAsB,CAAC,CAAD,CAF3D,EAGKjH,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,KAAKiH,sBAAsB,CAAC,CAAD,CAJ/C,EAKKjH,IALL,CAKU,QALV,EAKoB,MALpB,EAMKA,IANL,CAMU,MANV,EAMkBH,KAAK,CAACd,WANxB;AAQA6H,MAAAA,gBAAgB,CAACxF,MAAjB,CAAwB,MAAxB,EACKpB,IADL,CACU,GADV,EACesG,KAAK,GAAG,CAAR,GAAY,EAD3B,EAEKtG,IAFL,CAEU,GAFV,EAEeuG,MAAM,GAAG,CAAT,GAAa,CAF5B,EAGKvG,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,KAAKkH,sBAAsB,CAAC,CAAD,CAJ/C,EAKKlH,IALL,CAKU,QALV,EAKoB,MALpB,EAMKA,IANL,CAMU,MANV,EAMkBH,KAAK,CAACf,YANxB;AAQA8H,MAAAA,gBAAgB,CAACxF,MAAjB,CAAwB,MAAxB,EACKpB,IADL,CACU,GADV,EACesG,KAAK,GAAG,CAAR,GAAY,EAD3B,EAEKtG,IAFL,CAEU,GAFV,EAEeuG,MAAM,GAAG,CAAT,GAAa,CAAb,GAAiB,KAAKW,sBAAsB,CAAC,CAAD,CAF3D,EAGKlH,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,KAAKkH,sBAAsB,CAAC,CAAD,CAJ/C,EAKKlH,IALL,CAKU,QALV,EAKoB,MALpB,EAMKA,IANL,CAMU,MANV,EAMkBH,KAAK,CAACd,WANxB,EArMwE,CA6MxE;;AACA,WAAK,IAAI4B,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG,CAApB,EAAuBA,GAAC,EAAxB,EAA4B;AACxB,aAAK,IAAIE,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG,CAApB,EAAuBA,GAAC,EAAxB,EAA4B;AACxB,cAAIsG,IAAI,GAAG,EAAX;AACAtH,UAAAA,KAAK,CAACX,SAAN,GAAkB,EAAlB;AACA,cAAIyH,aAAY,GAAG,CAAnB;;AACA,cAAI9F,GAAC,IAAI,CAAT,EAAY;AACRsG,YAAAA,IAAI,GAAG,QAAP;;AACAtH,YAAAA,KAAK,CAACuH,aAAN,CAAoBvB,WAApB,EAAiClF,GAAjC;;AACAgG,YAAAA,aAAY,GAAGL,KAAK,GAAG,CAAR,GAAY3F,GAAC,GAAGlB,SAAJ,GAAgB,GAA3C;AACH,WAJD,MAIO;AACH0H,YAAAA,IAAI,GAAG,QAAP;;AACAtH,YAAAA,KAAK,CAACuH,aAAN,CAAoBzB,WAApB,EAAiChF,GAAjC;;AACAgG,YAAAA,aAAY,GAAGL,KAAK,GAAG,CAAR,GAAY3F,GAAC,GAAGlB,SAAJ,GAAgB,GAA3C;AACH,WAZuB,CAaxB;;;AACA,cAAI4H,QAAQ,GAAGnG,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBpB,IAAhB,CAAqB,OAArB,EAA8BmH,IAAI,GAAGxG,GAArC,CAAf;;AACA,cAAI/C,KAAI,GAAGiC,KAAK,CAACyH,SAAN,CAAgBzH,KAAK,CAACX,SAAtB,EAAiCR,YAAjC,CAAX;;AACA,cAAI6I,KAAK,GAAG,CAAZ;;AACA,eAAK,IAAIC,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAG3H,KAAK,CAACX,SAAN,CAAgB0B,MAAtC,EAA8C4G,EAAE,EAAhD,EAAoD;AAChDD,YAAAA,KAAK,IAAI1H,KAAK,CAACX,SAAN,CAAgBsI,EAAhB,EAAoB,CAApB,CAAT;AACH;;AACD,cAAIC,YAAY,GAAG,EAAnB;AACA,cAAIC,SAAS,GAAGrC,WAAhB;;AACA,cAAI8B,IAAI,IAAI,QAAZ,EAAsB;AAClBO,YAAAA,SAAS,GAAGtC,WAAZ;AACH;;AACDvF,UAAAA,KAAK,CAAC8H,QAAN,CAAe/J,KAAf,EAAqByJ,QAArB,EAA+BV,aAA/B,EAA6Cc,YAA7C,EAA2DnE,YAA3D,EAAyE5D,SAAzE,EAAoF8D,KAApF,EAA2F8C,KAA3F,EAAkG7G,SAAlG,EAA6G0H,IAAI,GAAGxG,GAApH,EAAuH+G,SAAvH,EAAkIlI,kBAAlI;AACH;AACJ,OA1OuE,CA2OxE;;;AACA,WAAK,IAAImB,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG0E,WAAW,CAACzE,MAAhC,EAAwCD,GAAC,EAAzC,EAA6C;AACzC0E,QAAAA,WAAW,CAAC1E,GAAD,CAAX,CAAeiH,OAAf,CAAuBjI,SAAvB;AACH;;AACD,WAAK,IAAIgB,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGyE,WAAW,CAACxE,MAAhC,EAAwCD,GAAC,EAAzC,EAA6C;AACzCyE,QAAAA,WAAW,CAACzE,GAAD,CAAX,CAAeiH,OAAf,CAAuBjI,SAAvB;AACH;;AAEDE,MAAAA,KAAK,CAACP,iBAAN,CAAwB,WAAW,CAAX,GAAe,SAAvC,IAAoD,CAACgH,KAAK,GAAG,CAAR,GAAY,CAAb,EAAgBI,WAAhB,CAApD;AACA7G,MAAAA,KAAK,CAACP,iBAAN,CAAwB,WAAW,CAAX,GAAe,SAAvC,IAAoD,CAACgH,KAAK,GAAG,CAAR,GAAY,CAAb,EAAgBI,WAAhB,CAApD;AACA7G,MAAAA,KAAK,CAACP,iBAAN,CAAwB,WAAW,CAAX,GAAe,QAAvC,IAAmD,CAACgH,KAAK,GAAG,CAAR,GAAY,CAAb,EAAgBI,WAAhB,CAAnD;AACA7G,MAAAA,KAAK,CAACP,iBAAN,CAAwB,WAAW,CAAX,GAAe,QAAvC,IAAmD,CAACgH,KAAK,GAAG,CAAR,GAAY,CAAb,EAAgBI,WAAhB,CAAnD;;AAEA,WAAK,IAAI/F,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAG,CAApB,EAAuBA,IAAC,EAAxB,EAA4B;AACxB,YAAIkH,WAAW,GAAGhI,KAAK,CAACiI,aAAN,CAAoBzC,WAApB,EAAiC1E,IAAjC,EAAoCjC,YAApC,CAAlB;;AACA,YAAIqJ,WAAW,GAAGlI,KAAK,CAACiI,aAAN,CAAoB1C,WAApB,EAAiCzE,IAAjC,EAAoCjC,YAApC,CAAlB,CAFwB,CAGxB;;;AACAmB,QAAAA,KAAK,CAACmI,QAAN,CAAe,QAAf,EAAyBD,WAAzB,EAAsC7G,GAAtC,EAA2CzB,SAA3C,EAAsDkB,IAAtD,EAAyDjB,SAAzD,EAAoE,GAApE,EAAyE,CAAzE;;AACAG,QAAAA,KAAK,CAACmI,QAAN,CAAe,QAAf,EAAyBH,WAAzB,EAAsC3G,GAAtC,EAA2CzB,SAA3C,EAAsDkB,IAAtD,EAAyDjB,SAAzD,EAAoE,GAApE,EAAyE,CAAzE;AACH;AAEJ,KA1gBI;AA2gBLsI,IAAAA,QA3gBK,oBA2gBIb,IA3gBJ,EA2gBUc,IA3gBV,EA2gBgB/G,GA3gBhB,EA2gBqBzB,SA3gBrB,EA2gBgCyI,GA3gBhC,EA2gBqCxI,SA3gBrC,EA2gBgD4E,IA3gBhD,EA2gBsD6D,GA3gBtD,EA2gB2D;AAC5D,UAAMtI,KAAK,GAAG,IAAd;;AACA,UAAIuI,QAAQ,GAAG,CAAf;AACA,UAAIC,SAAS,GAAG,CAAhB;AACA,UAAI3H,CAAC,GAAG,CAAR;;AACA,UAAIyG,IAAI,IAAI,QAAZ,EAAsB;AAClBiB,QAAAA,QAAQ,GAAGvI,KAAK,CAACP,iBAAN,CAAwB6H,IAAI,GAAGe,GAAP,GAAa,SAArC,EAAgD,CAAhD,IAAqD,IAAIzI,SAAzD,GAAqE,EAAhF;AACA4I,QAAAA,SAAS,GAAGxI,KAAK,CAACP,iBAAN,CAAwB6H,IAAI,IAAIe,GAAG,GAAG,CAAV,CAAJ,GAAmB,SAA3C,EAAsD,CAAtD,CAAZ;AACH,OAHD,MAGO;AACHE,QAAAA,QAAQ,GAAGvI,KAAK,CAACP,iBAAN,CAAwB6H,IAAI,GAAGe,GAAP,GAAa,SAArC,EAAgD,CAAhD,CAAX;AACAG,QAAAA,SAAS,GAAGxI,KAAK,CAACP,iBAAN,CAAwB6H,IAAI,IAAIe,GAAG,GAAG,CAAV,CAAJ,GAAmB,SAA3C,EAAsD,CAAtD,IAA2D,IAAIzI,SAA/D,GAA2E,EAAvF;AACAiB,QAAAA,CAAC,GAAG,CAAC,CAAL;AACH;;AACD,UAAI4H,eAAe,GAAGzI,KAAK,CAACP,iBAAN,CAAwB6H,IAAI,GAAGe,GAAP,GAAa,SAArC,EAAgD,CAAhD,CAAtB;AACA,UAAIK,cAAc,GAAG1I,KAAK,CAACP,iBAAN,CAAwB6H,IAAI,GAAGe,GAAP,GAAa,QAArC,EAA+C,CAA/C,CAArB;AACA,UAAIM,gBAAgB,GAAG3I,KAAK,CAACP,iBAAN,CAAwB6H,IAAI,IAAIe,GAAG,GAAG,CAAV,CAAJ,GAAmB,SAA3C,EAAsD,CAAtD,CAAvB;AACA,UAAIO,eAAe,GAAG5I,KAAK,CAACP,iBAAN,CAAwB6H,IAAI,IAAIe,GAAG,GAAG,CAAV,CAAJ,GAAmB,QAA3C,EAAqD,CAArD,CAAtB;;AACA,UAAIC,GAAG,GAAG,CAAV,EAAa;AACTG,QAAAA,eAAe,GAAG,CAACH,GAAnB;AACAI,QAAAA,cAAc,GAAG,CAACJ,GAAlB;AACH;;AACD,UAAIA,GAAG,GAAG,CAAV,EAAa;AACTK,QAAAA,gBAAgB,GAAGL,GAAnB;AACAM,QAAAA,eAAe,GAAGN,GAAlB;AACH;;AACD,UAAMrC,aAAa,GAAGzI,EAAE,CAAC0I,IAAH,GACjBC,CADiB,CACf,UAAUC,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACD,CAAT;AAAa,OADb,EAEjBE,CAFiB,CAEf,UAAUD,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACC,CAAT;AAAa,OAFb,EAGjBC,KAHiB,CAGX9I,EAAE,CAAC+I,eAAH,CAAmBC,KAAnB,CAAyB,GAAzB,CAHW,CAAtB;;AAIA,WAAK,IAAI1F,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxBsH,QAAAA,IAAI,CAACtH,CAAD,CAAJ,IAAWjB,SAAX;AACA,YAAIgJ,SAAS,GAAG,EAAhB;;AACA,YAAI/H,CAAC,IAAI,CAAT,EAAY;AACR+H,UAAAA,SAAS,GAAG,CACR;AAAE1C,YAAAA,CAAC,EAAEoC,QAAL;AAAelC,YAAAA,CAAC,EAAEoC;AAAlB,WADQ,EAER;AAAEtC,YAAAA,CAAC,EAAEoC,QAAQ,GAAG1H,CAAhB;AAAmBwF,YAAAA,CAAC,EAAEoC;AAAtB,WAFQ,EAGR;AAAEtC,YAAAA,CAAC,EAAEqC,SAAS,GAAG3H,CAAjB;AAAoBwF,YAAAA,CAAC,EAAEsC;AAAvB,WAHQ,EAIR;AAAExC,YAAAA,CAAC,EAAEqC,SAAL;AAAgBnC,YAAAA,CAAC,EAAEsC;AAAnB,WAJQ,CAAZ;AAMAF,UAAAA,eAAe,IAAIL,IAAI,CAACtH,CAAD,CAAvB;AACA6H,UAAAA,gBAAgB,IAAIP,IAAI,CAACtH,CAAD,CAAxB;AACH,SATD,MASO,IAAIA,CAAC,IAAI,CAAT,EAAY;AACf+H,UAAAA,SAAS,GAAG,CACR;AAAE1C,YAAAA,CAAC,EAAEoC,QAAL;AAAelC,YAAAA,CAAC,EAAEoC;AAAlB,WADQ,EAER;AAAEtC,YAAAA,CAAC,EAAEoC,QAAQ,GAAG1H,CAAhB;AAAmBwF,YAAAA,CAAC,EAAEoC;AAAtB,WAFQ,EAGR;AAAEtC,YAAAA,CAAC,EAAEqC,SAAS,GAAG3H,CAAjB;AAAoBwF,YAAAA,CAAC,EAAEuC;AAAvB,WAHQ,EAIR;AAAEzC,YAAAA,CAAC,EAAEqC,SAAL;AAAgBnC,YAAAA,CAAC,EAAEuC;AAAnB,WAJQ,CAAZ;AAMAH,UAAAA,eAAe,IAAIL,IAAI,CAACtH,CAAD,CAAvB;AACA8H,UAAAA,eAAe,IAAIR,IAAI,CAACtH,CAAD,CAAvB;AACH,SATM,MASA,IAAIA,CAAC,IAAI,CAAT,EAAY;AACf+H,UAAAA,SAAS,GAAG,CACR;AAAE1C,YAAAA,CAAC,EAAEoC,QAAL;AAAelC,YAAAA,CAAC,EAAEqC;AAAlB,WADQ,EAER;AAAEvC,YAAAA,CAAC,EAAEoC,QAAQ,GAAG1H,CAAhB;AAAmBwF,YAAAA,CAAC,EAAEqC;AAAtB,WAFQ,EAGR;AAAEvC,YAAAA,CAAC,EAAEqC,SAAS,GAAG3H,CAAjB;AAAoBwF,YAAAA,CAAC,EAAEsC;AAAvB,WAHQ,EAIR;AAAExC,YAAAA,CAAC,EAAEqC,SAAL;AAAgBnC,YAAAA,CAAC,EAAEsC;AAAnB,WAJQ,CAAZ;AAMAA,UAAAA,gBAAgB,IAAIP,IAAI,CAACtH,CAAD,CAAxB;AACA4H,UAAAA,cAAc,IAAIN,IAAI,CAACtH,CAAD,CAAtB;AACH,SATM,MASA;AACH+H,UAAAA,SAAS,GAAG,CACR;AAAE1C,YAAAA,CAAC,EAAEoC,QAAL;AAAelC,YAAAA,CAAC,EAAEqC;AAAlB,WADQ,EAER;AAAEvC,YAAAA,CAAC,EAAEoC,QAAQ,GAAG1H,CAAhB;AAAmBwF,YAAAA,CAAC,EAAEqC;AAAtB,WAFQ,EAGR;AAAEvC,YAAAA,CAAC,EAAEqC,SAAS,GAAG3H,CAAjB;AAAoBwF,YAAAA,CAAC,EAAEuC;AAAvB,WAHQ,EAIR;AAAEzC,YAAAA,CAAC,EAAEqC,SAAL;AAAgBnC,YAAAA,CAAC,EAAEuC;AAAnB,WAJQ,CAAZ;AAMAA,UAAAA,eAAe,IAAIR,IAAI,CAACtH,CAAD,CAAvB;AACA4H,UAAAA,cAAc,IAAIN,IAAI,CAACtH,CAAD,CAAtB;AACH;;AAED,aAAK,IAAIgI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGV,IAAI,CAACtH,CAAD,CAAxB,EAA6BgI,CAAC,EAA9B,EAAkC;AAC9B,eAAK,IAAI5H,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxB2H,YAAAA,SAAS,CAAC3H,CAAD,CAAT,CAAamF,CAAb,IAAkB,CAAlB;AACH;;AACDhF,UAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKwH,KADL,CACWF,SADX,EAEK1I,IAFL,CAEU,MAFV,EAEkB,MAFlB,EAGKA,IAHL,CAGU,QAHV,EAGoB,YAAY;AACxB,gBAAIsE,IAAI,IAAI,GAAZ,EAAiB;AACb,qBAAOzE,KAAK,CAAC1B,UAAb;AACH,aAFD,MAEO;AACH,qBAAO0B,KAAK,CAACzB,qBAAb;AACH;AACJ,WATL,EAUK4B,IAVL,CAUU,cAVV,EAU0B,CAV1B,EAWKA,IAXL,CAWU,SAXV,EAWqBH,KAAK,CAACxB,YAX3B,EAYK2B,IAZL,CAYU,GAZV,EAYe8F,aAZf,EAaK+C,KAbL;AAcH;AACJ;AACJ,KArmBI;AAsmBLf,IAAAA,aAtmBK,yBAsmBSgB,aAtmBT,EAsmBwBC,CAtmBxB,EAsmB2BrK,YAtmB3B,EAsmByC;AAC1C;AACA,UAAI6D,MAAM,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAb,CAF0C,CAEhB;;AAC1B,WAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmI,aAAa,CAAClI,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,YAAIoI,CAAC,GAAGD,aAAa,CAACnI,CAAD,CAAb,CAAiBC,MAAjB,GAA0B,CAAlC,EAAqC;AACjC;AACH;;AACD,YAAIoI,IAAI,GAAGF,aAAa,CAACnI,CAAD,CAAb,CAAiBoI,CAAjB,CAAX;AACA,YAAIE,IAAI,GAAGH,aAAa,CAACnI,CAAD,CAAb,CAAiBoI,CAAC,GAAG,CAArB,CAAX;;AACA,YAAIrK,YAAY,CAAC,CAAD,CAAZ,CAAgBsK,IAAhB,EAAsB,CAAtB,IAA2BtK,YAAY,CAAC,CAAD,CAAZ,CAAgBsK,IAAhB,EAAsB,CAAtB,CAA/B,EAAyD;AACrD;AACA,cAAItK,YAAY,CAAC,CAAD,CAAZ,CAAgBuK,IAAhB,EAAsB,CAAtB,IAA2BvK,YAAY,CAAC,CAAD,CAAZ,CAAgBuK,IAAhB,EAAsB,CAAtB,CAA/B,EAAyD;AACrD;AACA1G,YAAAA,MAAM,CAAC,CAAD,CAAN,IAAa,CAAb;AACH,WAHD,MAGO;AACH;AACAA,YAAAA,MAAM,CAAC,CAAD,CAAN,IAAa,CAAb;AACH;AACJ,SATD,MASO;AACH,cAAI7D,YAAY,CAAC,CAAD,CAAZ,CAAgBuK,IAAhB,EAAsB,CAAtB,IAA2BvK,YAAY,CAAC,CAAD,CAAZ,CAAgBuK,IAAhB,EAAsB,CAAtB,CAA/B,EAAyD;AACrD;AACA1G,YAAAA,MAAM,CAAC,CAAD,CAAN,IAAa,CAAb;AACH,WAHD,MAGO;AACH;AACAA,YAAAA,MAAM,CAAC,CAAD,CAAN,IAAa,CAAb;AACH;AACJ;AACJ;;AACD,aAAOA,MAAP;AACH,KAnoBI;AAooBLoF,IAAAA,QApoBK,oBAooBI/J,IApoBJ,EAooBUsD,GApoBV,EAooBegI,OApoBf,EAooBwBC,OApoBxB,EAooBiC7F,YApoBjC,EAooB+C8F,OApoB/C,EAooBwD5F,KApoBxD,EAooB+D8C,KApoB/D,EAooBsE7G,SApoBtE,EAooBiF4J,UApoBjF,EAooB6FP,aApoB7F,EAooB4GtJ,kBApoB5G,EAooBgI;AACjI,UAAMK,KAAK,GAAG,IAAd;;AACAA,MAAAA,KAAK,CAACP,iBAAN,CAAwB+J,UAAU,GAAG,SAArC,IAAkD,CAACH,OAAO,GAAG,CAAX,EAAcC,OAAd,CAAlD;;AACA,UAAIG,KAAK,GAAGzJ,KAAK,CAAC0J,WAAN,CAAkB3L,IAAI,CAAC,CAAD,CAAtB,EAA2BsD,GAA3B,EAAgCgI,OAAhC,EAAyCC,OAAzC,EAAkD7F,YAAlD,EAAgE8F,OAAhE,EAAyE5F,KAAzE,EAAgF8C,KAAhF,EAAuF7G,SAAvF,EAAkG4J,UAAlG,EAA8GP,aAA9G,EAA6HtJ,kBAA7H,CAAZ,CAHiI,CAIjI;;;AACA,UAAI6H,QAAQ,GAAGnG,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgByH,KAAhB,EAAf;AACA,UAAMW,YAAY,GAAG3J,KAAK,CAAC1B,UAA3B;AAEAkJ,MAAAA,QAAQ,CAACjG,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACekJ,OAAO,GAAG,CADzB,EAEKlJ,IAFL,CAEU,GAFV,EAEemJ,OAAO,GAAG,CAFzB,EAGKnJ,IAHL,CAGU,OAHV,EAGmBP,SAAS,GAAG,CAAZ,GAAgB,EAHnC,EAIKO,IAJL,CAIU,QAJV,EAIoBsJ,KAAK,GAAGH,OAAR,GAAkB,EAJtC,EAKKnJ,IALL,CAKU,MALV,EAKkB,MALlB,EAMKA,IANL,CAMU,SANV,EAMqBH,KAAK,CAACxB,YAN3B,EAOK2B,IAPL,CAOU,QAPV,EAOoBwJ,YAPpB,EARiI,CAgBjI;;AACAF,MAAAA,KAAK,IAAI,EAAT;AACAH,MAAAA,OAAO,GAAGG,KAAV;AACAzJ,MAAAA,KAAK,CAACP,iBAAN,CAAwB+J,UAAU,GAAG,QAArC,IAAiD,CAACH,OAAO,GAAG,EAAX,EAAeC,OAAO,GAAG,CAAzB,CAAjD;AACA9B,MAAAA,QAAQ,CAACjG,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,IADV,EACgBkJ,OAAO,GAAG,IAAIzJ,SAAd,GAA0B,EAD1C,EAEKO,IAFL,CAEU,IAFV,EAEgBkJ,OAAO,GAAG,EAF1B,EAGKlJ,IAHL,CAGU,IAHV,EAGgBsJ,KAHhB,EAIKtJ,IAJL,CAIU,IAJV,EAIgBsJ,KAJhB,EAKKtJ,IALL,CAKU,cALV,EAK0B,CAL1B,EAMKA,IANL,CAMU,QANV,EAMoBH,KAAK,CAACV,WAN1B;AAOAmK,MAAAA,KAAK,GAAGzJ,KAAK,CAAC0J,WAAN,CAAkB3L,IAAI,CAAC,CAAD,CAAtB,EAA2BsD,GAA3B,EAAgCgI,OAAhC,EAAyCI,KAAK,GAAG,EAAjD,EAAqDhG,YAArD,EAAmE8F,OAAnE,EAA4E5F,KAA5E,EAAmF8C,KAAnF,EAA0F7G,SAA1F,EAAqG4J,UAArG,EAAiHP,aAAjH,EAAgItJ,kBAAhI,CAAR,CA3BiI,CA4BjI;;AACA6H,MAAAA,QAAQ,CAACjG,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACekJ,OAAO,GAAG,CADzB,EAEKlJ,IAFL,CAEU,GAFV,EAEemJ,OAAO,GAAG,EAFzB,EAGKnJ,IAHL,CAGU,OAHV,EAGmBP,SAAS,GAAG,CAAZ,GAAgB,EAHnC,EAIKO,IAJL,CAIU,QAJV,EAIoBsJ,KAAK,GAAGH,OAAR,GAAkB,CAJtC,EAKKnJ,IALL,CAKU,MALV,EAKkB,MALlB,EAMKA,IANL,CAMU,SANV,EAMqBH,KAAK,CAACxB,YAN3B,EAOK2B,IAPL,CAOU,QAPV,EAOoBwJ,YAPpB;AAQH,KAzqBI;AA0qBLC,IAAAA,aA1qBK,yBA0qBSvB,GA1qBT,EA0qBcxG,GA1qBd,EA0qBmBoH,aA1qBnB,EA0qBkC;AACnC,UAAIvG,MAAM,GAAG,EAAb;;AACA,WAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmI,aAAa,CAAClI,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,YAAImI,aAAa,CAACnI,CAAD,CAAb,CAAiBC,MAAjB,GAA0BsH,GAA1B,IAAiCY,aAAa,CAACnI,CAAD,CAAb,CAAiBuH,GAAjB,KAAyBxG,GAA9D,EAAmE;AAC/D,eAAK,IAAIb,CAAC,GAAGqH,GAAG,GAAG,CAAnB,EAAsBrH,CAAC,GAAGiI,aAAa,CAACnI,CAAD,CAAb,CAAiBC,MAA3C,EAAmDC,CAAC,EAApD,EAAwD;AACpD0B,YAAAA,MAAM,CAACK,IAAP,CAAYkG,aAAa,CAACnI,CAAD,CAAb,CAAiBE,CAAjB,CAAZ;AACH;AACJ;AACJ;;AACD,aAAO0B,MAAP;AACH,KAprBI;AAqrBLmH,IAAAA,cArrBK,0BAqrBUC,QArrBV,EAqrBoBC,cArrBpB,EAqrBoC;AACrC,UAAIrH,MAAM,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAb;;AACA,WAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgJ,QAAQ,CAAC/I,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACtC,YAAIkJ,UAAU,GAAGD,cAAc,CAACD,QAAQ,CAAChJ,CAAD,CAAT,CAAd,CAA4B,CAA5B,IAAiCiJ,cAAc,CAACD,QAAQ,CAAChJ,CAAD,CAAT,CAAd,CAA4B,CAA5B,CAAlD;;AACA,YAAIkJ,UAAU,GAAG,CAAjB,EAAoB;AAChBtH,UAAAA,MAAM,CAAC,CAAD,CAAN,IAAasH,UAAb;AACH,SAFD,MAEO;AACHtH,UAAAA,MAAM,CAAC,CAAD,CAAN,IAAauE,IAAI,CAACC,GAAL,CAAS8C,UAAT,CAAb;AACH;AACJ;;AACD,UAAItH,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAlB,IAAyB,CAA7B,EAAgC;AAC5B,eAAOA,MAAP;AACH,OAFD,MAEO;AACH,eAAO,CAACA,MAAM,CAAC,CAAD,CAAN,IAAaA,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAA/B,CAAD,EAAsCA,MAAM,CAAC,CAAD,CAAN,IAAaA,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAA/B,CAAtC,CAAP;AACH;AACJ,KApsBI;AAqsBLgH,IAAAA,WArsBK,uBAqsBOhM,IArsBP,EAqsBa2D,GArsBb,EAqsBkBgI,OArsBlB,EAqsB2BC,OArsB3B,EAqsBoC7F,YArsBpC,EAqsBkD8F,OArsBlD,EAqsB2D5F,KArsB3D,EAqsBkE8C,KArsBlE,EAqsByE7G,SArsBzE,EAqsBoF4J,UArsBpF,EAqsBgGP,aArsBhG,EAqsB+GtJ,kBArsB/G,EAqsBmI;AACpI;AACA,UAAMK,KAAK,GAAG,IAAd;;AACA,UAAIiD,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYvF,IAAZ,CAAX;AACA,UAAI8J,QAAQ,GAAGnG,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgByH,KAAhB,EAAf,CAJoI,CAKpI;;AACA,UAAIe,cAAc,GAAG/J,KAAK,CAACnB,YAAN,CAAmB,CAAnB,CAArB,CANoI,CAM1F;;AAC1C,UAAIoL,KAAK,GAAG,IAAIC,GAAJ,EAAZ;;AACA,WAAK,IAAIpJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2C,YAApB,EAAkC3C,CAAC,EAAnC,EAAuC;AACnC,aAAK,IAAIE,CAAC,GAAG,CAAC,CAAd,EAAiBA,CAAC,GAAGyC,YAArB,EAAmCzC,CAAC,EAApC,EAAwC;AACpC,eAAK,IAAImJ,EAAE,GAAG,CAAC,CAAf,EAAkBA,EAAE,GAAG1G,YAAvB,EAAqC0G,EAAE,EAAvC,EAA2C;AACvC,gBAAInJ,CAAC,IAAI,CAAC,CAAV,EAAa;AACTiJ,cAAAA,KAAK,CAACG,GAAN,CAAUtJ,CAAC,CAACgC,QAAF,EAAV;AACH,aAFD,MAEO;AACH,kBAAIqH,EAAE,IAAI,CAAC,CAAX,EAAc;AACVF,gBAAAA,KAAK,CAACG,GAAN,CAAUtJ,CAAC,CAACgC,QAAF,KAAe9B,CAAC,CAAC8B,QAAF,EAAzB;AACH,eAFD,MAEO;AACHmH,gBAAAA,KAAK,CAACG,GAAN,CAAUtJ,CAAC,CAACgC,QAAF,KAAe9B,CAAC,CAAC8B,QAAF,EAAf,GAA8BqH,EAAE,CAACrH,QAAH,EAAxC;AACH;AACJ;AACJ;AACJ;AACJ;;AAtBmI;AAAA;AAAA;;AAAA;AAAA;AAAA,cAuB3HjB,GAvB2H;;AAwBhI,cAAIoB,IAAI,CAACoH,QAAL,CAAcxI,GAAd,CAAJ,EAAwB;AAAA;AACpB;AACA,kBAAIyI,cAAc,GAAGtK,KAAK,CAAC4J,aAAN,CAAoB/G,QAAQ,CAAC2G,UAAU,CAACA,UAAU,CAACzI,MAAX,GAAoB,CAArB,CAAX,CAAR,GAA8C,CAAlE,EAAqEc,GAArE,EAA0EoH,aAA1E,CAArB,CAFoB,CAGpB;;;AACA,kBAAIsB,oBAAoB,GAAGvK,KAAK,CAAC6J,cAAN,CAAqBS,cAArB,EAAqCP,cAArC,CAA3B;;AACA,kBAAI/C,MAAM,GAAG+C,cAAc,CAAClI,GAAD,CAA3B,CALoB,CAMpB;;AACA7B,cAAAA,KAAK,CAACR,UAAN,CAAiBgK,UAAU,GAAG,GAAb,GAAmB3H,GAApC,IAA2CyH,OAA3C;AACA,kBAAIkB,YAAY,GAAG,EAAnB;;AACA,mBAAK,IAAItJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGvB,kBAAkB,CAACoB,MAAvC,EAA+CG,CAAC,EAAhD,EAAoD;AAChD,oBAAIsI,UAAU,CAAC,CAAD,CAAV,IAAiB,GAArB,EAA0B;AACtB,sBAAI7J,kBAAkB,CAACuB,CAAD,CAAlB,CAAsB,CAAtB,EAAyB2B,QAAQ,CAAC2G,UAAU,CAACA,UAAU,CAACzI,MAAX,GAAoB,CAArB,CAAX,CAAR,GAA8C,CAAvE,KAA6Ec,GAAjF,EAAsF;AAClF;AACA2I,oBAAAA,YAAY,CAACzH,IAAb,CAAkBpD,kBAAkB,CAACuB,CAAD,CAApC;AACH;AACJ;;AACD,oBAAIsI,UAAU,CAAC,CAAD,CAAV,IAAiB,GAArB,EAA0B;AACtB,sBAAI7J,kBAAkB,CAACuB,CAAD,CAAlB,CAAsB,CAAtB,EAAyB2B,QAAQ,CAAC2G,UAAU,CAACA,UAAU,CAACzI,MAAX,GAAoB,CAArB,CAAX,CAAR,GAA8C,CAAvE,KAA6Ec,GAAjF,EAAsF;AAClF2I,oBAAAA,YAAY,CAACzH,IAAb,CAAkBpD,kBAAkB,CAACuB,CAAD,CAApC;AACH;AACJ;AACJ,eArBmB,CAsBpB;;;AACA,kBAAIuJ,UAAU,GAAG,EAAjB;;AACA,mBAAK,IAAI5J,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2J,YAAY,CAACzJ,MAAjC,EAAyCF,CAAC,EAA1C,EAA8C;AAC1C,oBAAI6J,MAAM,GAAG,EAAb;;AACA,qBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI,CAArB,EAAwBA,CAAC,EAAzB,EAA6B;AACzB,sBAAIH,YAAY,CAAC3J,CAAD,CAAZ,CAAgB,CAAhB,EAAmBE,MAAnB,GAA4B4J,CAAhC,EAAmC;AAC/B,wBAAI3K,KAAK,CAACnB,YAAN,CAAmB,CAAnB,EAAsB2L,YAAY,CAAC3J,CAAD,CAAZ,CAAgB,CAAhB,EAAmB8J,CAAnB,CAAtB,EAA6C,CAA7C,IAAkD3K,KAAK,CAACnB,YAAN,CAAmB,CAAnB,EAAsB2L,YAAY,CAAC3J,CAAD,CAAZ,CAAgB,CAAhB,EAAmB8J,CAAnB,CAAtB,EAA6C,CAA7C,CAAtD,EAAuG;AACnGD,sBAAAA,MAAM,CAAC3H,IAAP,CAAY,CAAZ;AACH,qBAFD,MAEO;AACH2H,sBAAAA,MAAM,CAAC3H,IAAP,CAAY,CAAC,CAAb;AACH;AACJ,mBAND,MAMO;AACH2H,oBAAAA,MAAM,CAAC3H,IAAP,CAAY,CAAZ;AACH;AACJ;;AACD,oBAAI/C,KAAK,CAACnB,YAAN,CAAmB,CAAnB,EAAsBmB,KAAK,CAACF,SAA5B,EAAuC,CAAvC,IAA4CE,KAAK,CAACnB,YAAN,CAAmB,CAAnB,EAAsBmB,KAAK,CAACF,SAA5B,EAAuC,CAAvC,CAAhD,EAA2F;AACvF4K,kBAAAA,MAAM,CAAC3H,IAAP,CAAY,CAAZ;AACH,iBAFD,MAEO;AACH2H,kBAAAA,MAAM,CAAC3H,IAAP,CAAY,CAAC,CAAb;AACH;;AACD,qBAAK,IAAI4H,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG,CAApB,EAAuBA,EAAC,EAAxB,EAA4B;AACxB,sBAAIH,YAAY,CAAC3J,CAAD,CAAZ,CAAgB,CAAhB,EAAmBE,MAAnB,GAA4B4J,EAAhC,EAAmC;AAC/B,wBAAI3K,KAAK,CAACnB,YAAN,CAAmB,CAAnB,EAAsB2L,YAAY,CAAC3J,CAAD,CAAZ,CAAgB,CAAhB,EAAmB8J,EAAnB,CAAtB,EAA6C,CAA7C,IAAkD3K,KAAK,CAACnB,YAAN,CAAmB,CAAnB,EAAsB2L,YAAY,CAAC3J,CAAD,CAAZ,CAAgB,CAAhB,EAAmB8J,EAAnB,CAAtB,EAA6C,CAA7C,CAAtD,EAAuG;AACnGD,sBAAAA,MAAM,CAAC3H,IAAP,CAAY,CAAZ;AACH,qBAFD,MAEO;AACH2H,sBAAAA,MAAM,CAAC3H,IAAP,CAAY,CAAC,CAAb;AACH;AACJ,mBAND,MAMO;AACH2H,oBAAAA,MAAM,CAAC3H,IAAP,CAAY,CAAZ;AACH;AACJ;;AACD0H,gBAAAA,UAAU,CAAC1H,IAAX,CAAgB2H,MAAhB;AACH;;AAtDmB,2CAuDX7J,GAvDW;AAwDhB2G,gBAAAA,QAAQ,CAACjG,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACe,YAAY;AACnB,sBAAI0B,GAAG,CAACd,MAAJ,GAAa,CAAjB,EAAoB;AAChB,2BAAOsI,OAAO,GAAGxI,GAAC,GAAG,CAAJ,GAAQgB,GAAG,CAACd,MAAZ,GAAqBnB,SAAtC;AACH,mBAFD,MAEO;AACH,2BAAOyJ,OAAO,GAAGxI,GAAC,GAAG,CAAJ,GAAQgB,GAAG,CAACd,MAAZ,GAAqBnB,SAAtC;AACH;AACJ,iBAPL,EAQKO,IARL,CAQU,GARV,EAQemJ,OARf,EASKnJ,IATL,CASU,OATV,EASmB,YAAY;AACvB,sBAAI0B,GAAG,CAACd,MAAJ,GAAa,CAAjB,EAAoB;AAChB,2BAAOnB,SAAP;AACH,mBAFD,MAEO;AACH,2BAAO,IAAIiC,GAAG,CAACd,MAAR,GAAiBnB,SAAxB;AACH;AACJ,iBAfL,EAgBKO,IAhBL,CAgBU,QAhBV,EAgBoBoJ,OAAO,GAAG7L,IAAI,CAACmE,GAAD,CAhBlC,EAiBK1B,IAjBL,CAiBU,MAjBV,EAiBkBwD,KAAK,CAACd,QAAQ,CAAChB,GAAG,CAAChB,GAAD,CAAJ,CAAT,CAjBvB,EAkBKV,IAlBL,CAkBU,QAlBV,EAkBoB,OAlBpB,EAmBKA,IAnBL,CAmBU,cAnBV,EAmB0B,IAnB1B,EAoBKA,IApBL,CAoBU,OApBV,EAoBmBqJ,UAAU,GAAG3H,GApBhC,EAqBK1B,IArBL,CAqBU,IArBV,EAqBgBmJ,OArBhB,EAsBKnH,KAtBL,CAsBW,SAtBX,EAsBsB,CAtBtB,EAuBKmB,EAvBL,CAuBQ,OAvBR,EAuBiB,YAAY;AACrB/F,kBAAAA,WAAW,CAACqN,aAAZ,CAA0B,CAAC/I,GAAD,EAAM,CAAC,CAAP,CAA1B;AACH,iBAzBL,EA0BKyB,EA1BL,CA0BQ,YA1BR,EA0BsB,YAAY;AAC1B7F,kBAAAA,CAAC,CAAC,MAAM+L,UAAN,GAAmB3H,GAApB,CAAD,CAA0B1B,IAA1B,CAA+B,QAA/B,EAAyCH,KAAK,CAACpB,WAA/C,EACKuB,IADL,CACU,cADV,EAC0B,CAD1B;AAEA1C,kBAAAA,CAAC,CAAC,MAAM+L,UAAN,GAAmB,SAAnB,GAA+B3H,GAAhC,CAAD,CAAsC1B,IAAtC,CAA2C,YAA3C,EAAyD,SAAzD,EAH0B,CAI1B;;AACAH,kBAAAA,KAAK,CAAC4B,aAAN,CAAoBC,GAApB,EAL0B,CAM1B;AACA;AACA;;;AACA,uBAAK,IAAIX,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGuJ,UAAU,CAAC,CAAD,CAAV,CAAc1J,MAAd,GAAuB,CAA3C,EAA8CG,EAAC,EAA/C,EAAmD;AAC/C,wBAAI2J,WAAW,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAlB;;AACA,yBAAK,IAAIF,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGF,UAAU,CAAC1J,MAA/B,EAAuC4J,GAAC,EAAxC,EAA4C;AACxC,0BAAIF,UAAU,CAACE,GAAD,CAAV,CAAczJ,EAAd,KAAoB,CAAxB,EAA2B;AACvB,4BAAIuJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,EAAC,GAAG,CAAlB,KAAwB,CAA5B,EAA+B;AAC3B2J,0BAAAA,WAAW,CAAC,CAAD,CAAX,IAAkB,CAAlB;AACH;;AACD,4BAAIJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,EAAC,GAAG,CAAlB,KAAwB,CAAC,CAA7B,EAAgC;AAC5B2J,0BAAAA,WAAW,CAAC,CAAD,CAAX,IAAkB,CAAlB;AACH;AACJ;;AACD,0BAAIJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,EAAd,KAAoB,CAAC,CAAzB,EAA4B;AACxB,4BAAIuJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,EAAC,GAAG,CAAlB,KAAwB,CAA5B,EAA+B;AAC3B2J,0BAAAA,WAAW,CAAC,CAAD,CAAX,IAAkB,CAAlB;AACH;;AACD,4BAAIJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,EAAC,GAAG,CAAlB,KAAwB,CAAC,CAA7B,EAAgC;AAC5B2J,0BAAAA,WAAW,CAAC,CAAD,CAAX,IAAkB,CAAlB;AACH;AACJ;AACJ;;AACD,wBAAIC,SAAS,GAAG,CAAhB;;AACA,wBAAI5J,EAAC,GAAG,CAAJ,IAAS2B,QAAQ,CAAC2G,UAAU,CAAC,CAAD,CAAX,CAAjB,IAAoCA,UAAU,CAAC,CAAD,CAAV,IAAiB,GAAzD,EAA8D;AAC1DsB,sBAAAA,SAAS,GAAGC,UAAU,CAACtN,CAAC,CAAC,MAAM+L,UAAN,GAAmB3H,GAApB,CAAD,CAA0B1B,IAA1B,CAA+B,IAA/B,CAAD,CAAV,GAAmD,CAA/D;AACH;;AACD,wBAAIe,EAAC,GAAG,CAAJ,IAAS2B,QAAQ,CAAC2G,UAAU,CAAC,CAAD,CAAX,CAAjB,IAAoCA,UAAU,CAAC,CAAD,CAAV,IAAiB,GAAzD,EAA8D;AAC1DsB,sBAAAA,SAAS,GAAG,CAACC,UAAU,CAACtN,CAAC,CAAC,MAAM+L,UAAN,GAAmB3H,GAApB,CAAD,CAA0B1B,IAA1B,CAA+B,IAA/B,CAAD,CAAX,GAAoD,CAAhE;AACH;;AACDH,oBAAAA,KAAK,CAACmI,QAAN,CAAe,QAAf,EAAyB0C,WAAzB,EAAsCG,SAAtC,EAAiDhL,KAAK,CAACJ,SAAvD,EAAkEsB,EAAC,GAAG,CAAtE,EAAyElB,KAAK,CAACH,SAA/E,EAA0F,GAA1F,EAA+FiL,SAA/F;AACH;;AACD,uBAAK,IAAI5J,GAAC,GAAG,CAAb,EAAgBA,GAAC,IAAI,CAArB,EAAwBA,GAAC,EAAzB,EAA6B;AACzB,wBAAI2J,YAAW,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAlB;;AACA,yBAAK,IAAIF,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGF,UAAU,CAAC1J,MAA/B,EAAuC4J,GAAC,EAAxC,EAA4C;AACxC,0BAAIF,UAAU,CAACE,GAAD,CAAV,CAAczJ,GAAd,KAAoB,CAAxB,EAA2B;AACvB,4BAAIuJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,GAAC,GAAG,CAAlB,KAAwB,CAA5B,EAA+B;AAC3B2J,0BAAAA,YAAW,CAAC,CAAD,CAAX,IAAkB,CAAlB;AACH;;AACD,4BAAIJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,GAAC,GAAG,CAAlB,KAAwB,CAAC,CAA7B,EAAgC;AAC5B2J,0BAAAA,YAAW,CAAC,CAAD,CAAX,IAAkB,CAAlB;AACH;AACJ;;AACD,0BAAIJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,GAAd,KAAoB,CAAC,CAAzB,EAA4B;AACxB,4BAAIuJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,GAAC,GAAG,CAAlB,KAAwB,CAA5B,EAA+B;AAC3B2J,0BAAAA,YAAW,CAAC,CAAD,CAAX,IAAkB,CAAlB;AACH;;AACD,4BAAIJ,UAAU,CAACE,GAAD,CAAV,CAAczJ,GAAC,GAAG,CAAlB,KAAwB,CAAC,CAA7B,EAAgC;AAC5B2J,0BAAAA,YAAW,CAAC,CAAD,CAAX,IAAkB,CAAlB;AACH;AACJ;AACJ;;AACD,wBAAIC,UAAS,GAAG,CAAhB;;AACA,wBAAI,IAAI5J,GAAJ,IAAS2B,QAAQ,CAAC2G,UAAU,CAAC,CAAD,CAAX,CAAjB,IAAoCA,UAAU,CAAC,CAAD,CAAV,IAAiB,GAAzD,EAA8D;AAC1DsB,sBAAAA,UAAS,GAAGC,UAAU,CAACtN,CAAC,CAAC,MAAM+L,UAAN,GAAmB3H,GAApB,CAAD,CAA0B1B,IAA1B,CAA+B,IAA/B,CAAD,CAAV,GAAmD,CAA/D;AACH;;AACD,wBAAI,IAAIe,GAAJ,IAAS2B,QAAQ,CAAC2G,UAAU,CAAC,CAAD,CAAX,CAAjB,IAAoCA,UAAU,CAAC,CAAD,CAAV,IAAiB,GAAzD,EAA8D;AAC1DsB,sBAAAA,UAAS,GAAG,CAACC,UAAU,CAACtN,CAAC,CAAC,MAAM+L,UAAN,GAAmB3H,GAApB,CAAD,CAA0B1B,IAA1B,CAA+B,IAA/B,CAAD,CAAX,GAAoD,CAAhE;AACH;;AACDH,oBAAAA,KAAK,CAACmI,QAAN,CAAe,QAAf,EAAyB0C,YAAzB,EAAsCG,SAAtC,EAAiDhL,KAAK,CAACJ,SAAvD,EAAkE,IAAIsB,GAAtE,EAAyElB,KAAK,CAACH,SAA/E,EAA0F,GAA1F,EAA+FiL,UAA/F;AACH;AACJ,iBA7FL,EA8FKxH,EA9FL,CA8FQ,YA9FR,EA8FsB,YAAY;AAC1B7F,kBAAAA,CAAC,CAAC,MAAM+L,UAAN,GAAmB3H,GAApB,CAAD,CAA0B1B,IAA1B,CAA+B,QAA/B,EAAyC,OAAzC,EACKA,IADL,CACU,cADV,EAC0B,GAD1B;AAEA1C,kBAAAA,CAAC,CAAC,MAAM+L,UAAN,GAAmB,SAAnB,GAA+B3H,GAAhC,CAAD,CAAsC1B,IAAtC,CAA2C,YAA3C,EAAyD,QAAzD;AACA3C,kBAAAA,EAAE,CAAC8D,MAAH,CAAU,eAAV,EAA2BpB,MAA3B;AACH,iBAnGL;AAxDgB;;AAuDpB,mBAAK,IAAIW,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGgB,GAAG,CAACd,MAAxB,EAAgCF,GAAC,EAAjC,EAAqC;AAAA,uBAA5BA,GAA4B;AAqGpC;;AACD,kBAAIgB,GAAG,CAACd,MAAJ,GAAa,CAAjB,EAAoB;AAChB;AACAyG,gBAAAA,QAAQ,CAACjG,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACekJ,OAAO,GAAGzJ,SADzB,EAEKO,IAFL,CAEU,GAFV,EAEemJ,OAFf,EAGKnJ,IAHL,CAGU,OAHV,EAGmBP,SAHnB,EAIKO,IAJL,CAIU,QAJV,EAIoBoJ,OAAO,GAAG7L,IAAI,CAACmE,GAAD,CAJlC,EAKK1B,IALL,CAKU,MALV,EAKkB,OALlB,EAMKA,IANL,CAMU,QANV,EAMoB,SANpB,EAOKA,IAPL,CAOU,cAPV,EAO0B,GAP1B,EAQKA,IARL,CAQU,OARV,EAQmBqJ,UAAU,GAAG3H,GARhC,EASKM,KATL,CASW,SATX,EASsB,CATtB,EAUKmB,EAVL,CAUQ,OAVR,EAUiB,YAAY;AACrB/F,kBAAAA,WAAW,CAACqN,aAAZ,CAA0B,CAAC/I,GAAD,EAAM,CAAC,CAAP,CAA1B;AACH,iBAZL,EAaKyB,EAbL,CAaQ,YAbR,EAasB,YAAY;AAC1B7F,kBAAAA,CAAC,CAAC,MAAM+L,UAAN,GAAmB3H,GAApB,CAAD,CAA0B1B,IAA1B,CAA+B,QAA/B,EAAyCH,KAAK,CAACpB,WAA/C,EACKuB,IADL,CACU,cADV,EAC0B,CAD1B;AAEA1C,kBAAAA,CAAC,CAAC,MAAM+L,UAAN,GAAmB,SAAnB,GAA+B3H,GAAhC,CAAD,CAAsC1B,IAAtC,CAA2C,YAA3C,EAAyD,SAAzD,EAH0B,CAI1B;;AACAH,kBAAAA,KAAK,CAAC4B,aAAN,CAAoBC,GAApB;AACH,iBAnBL,EAoBKyB,EApBL,CAoBQ,YApBR,EAoBsB,YAAY;AAC1B7F,kBAAAA,CAAC,CAAC,MAAM+L,UAAN,GAAmB3H,GAApB,CAAD,CAA0B1B,IAA1B,CAA+B,QAA/B,EAAyC,OAAzC,EACKA,IADL,CACU,cADV,EAC0B,GAD1B;AAEA1C,kBAAAA,CAAC,CAAC,MAAM+L,UAAN,GAAmB,SAAnB,GAA+B3H,GAAhC,CAAD,CAAsC1B,IAAtC,CAA2C,YAA3C,EAAyD,QAAzD;AACA3C,kBAAAA,EAAE,CAAC8D,MAAH,CAAU,eAAV,EAA2BpB,MAA3B;AACH,iBAzBL;AA0BH;;AACD,kBAAI8K,SAAS,GAAG3J,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBpB,IAAhB,CAAqB,OAArB,EAA8BqJ,UAAU,GAAG,SAAb,GAAyB3H,GAAvD,EAA4D1B,IAA5D,CAAiE,YAAjE,EAA+E,QAA/E,EAAyFA,IAAzF,CAA8F,WAA9F,EAA2G,iBAA3G,CAAhB,CA1LoB,CA2LpB;;AACA6K,cAAAA,SAAS,CAACzJ,MAAV,CAAiB,MAAjB,EACKpB,IADL,CACU,GADV,EACekJ,OADf,EAEKlJ,IAFL,CAEU,GAFV,EAEemJ,OAAO,GAAGC,OAAO,GAAG7L,IAAI,CAACmE,GAAD,CAAd,GAAsB,CAF/C,EAGK1B,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,EAJpB,EAKKA,IALL,CAKU,MALV,EAKkB,OALlB,EAMKA,IANL,CAMU,QANV,EAMoB,SANpB,EAOKA,IAPL,CAOU,cAPV,EAO0B,GAP1B;AASA6K,cAAAA,SAAS,CAACzJ,MAAV,CAAiB,MAAjB,EACKpB,IADL,CACU,GADV,EACe,YAAY;AACnB,oBAAIqJ,UAAU,CAAC,CAAD,CAAV,IAAiB,GAArB,EAA0B;AACtB,yBAAOH,OAAO,GAAG,EAAjB;AACH,iBAFD,MAEO;AACH,yBAAOA,OAAO,GAAG,CAAjB;AACH;AACJ,eAPL,EAQKlJ,IARL,CAQU,GARV,EAQemJ,OAAO,GAAGC,OAAO,GAAG7L,IAAI,CAACmE,GAAD,CAAd,GAAsB,CAAhC,GAAoC,CARnD,EASK1B,IATL,CASU,OATV,EASmB,EATnB,EAUKA,IAVL,CAUU,QAVV,EAUoB,EAVpB,EAWKA,IAXL,CAWU,QAXV,EAWoB,YAAY;AACxB,oBAAI6G,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAtB,EAA2B;AACvB,yBAAOhH,KAAK,CAACf,YAAb;AACH,iBAFD,MAEO;AACH,yBAAOe,KAAK,CAACd,WAAb;AACH;AACJ,eAjBL,EAkBKiB,IAlBL,CAkBU,MAlBV,EAkBkB,MAlBlB;AAoBA6K,cAAAA,SAAS,CAACzJ,MAAV,CAAiB,MAAjB,EACKpB,IADL,CACU,GADV,EACe,YAAY;AACnB,oBAAIqJ,UAAU,CAAC,CAAD,CAAV,IAAiB,GAArB,EAA0B;AACtB,yBAAOH,OAAO,GAAG,EAAjB;AACH,iBAFD,MAEO;AACH,yBAAOA,OAAO,GAAG,CAAjB;AACH;AACJ,eAPL,EAQKlJ,IARL,CAQU,GARV,EAQemJ,OAAO,GAAGC,OAAO,GAAG7L,IAAI,CAACmE,GAAD,CAAd,GAAsB,CAAhC,GAAoC,EARnD,EASK1B,IATL,CASU,WATV,EASuB,EATvB,EAUKoD,IAVL,CAUU,YAAY;AACd,uBAAO0D,IAAI,CAACC,GAAL,CAAS,CAACF,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAnB,IAA0B,GAAnC,EAAwCG,OAAxC,CAAgD,CAAhD,CAAP;AACH,eAZL,EAaKhH,IAbL,CAaU,MAbV,EAakB,YAAY;AACtB,oBAAI6G,MAAM,CAAC,CAAD,CAAN,GAAYA,MAAM,CAAC,CAAD,CAAtB,EAA2B;AACvB,yBAAOhH,KAAK,CAACf,YAAb;AACH,iBAFD,MAEO;AACH,yBAAOe,KAAK,CAACd,WAAb;AACH;AACJ,eAnBL;AAqBA8L,cAAAA,SAAS,CAACzJ,MAAV,CAAiB,MAAjB,EACKpB,IADL,CACU,GADV,EACe,YAAY;AACnB,oBAAIqJ,UAAU,CAAC,CAAD,CAAV,IAAiB,GAArB,EAA0B;AACtB,yBAAOH,OAAO,GAAG,EAAjB;AACH,iBAFD,MAEO;AACH,yBAAOA,OAAO,GAAG,CAAjB;AACH;AACJ,eAPL,EAQKlJ,IARL,CAQU,GARV,EAQemJ,OAAO,GAAGC,OAAO,GAAG7L,IAAI,CAACmE,GAAD,CAAd,GAAsB,CAAhC,GAAoC,CARnD,EASK1B,IATL,CASU,OATV,EASmB,EATnB,EAUKA,IAVL,CAUU,QAVV,EAUoB,KAAKoK,oBAAoB,CAAC,CAAD,CAV7C,EAWKpK,IAXL,CAWU,QAXV,EAWoB,MAXpB,EAYKA,IAZL,CAYU,MAZV,EAYkBH,KAAK,CAACf,YAZxB;AAcA+L,cAAAA,SAAS,CAACzJ,MAAV,CAAiB,MAAjB,EACKpB,IADL,CACU,GADV,EACe,YAAY;AACnB,oBAAIqJ,UAAU,CAAC,CAAD,CAAV,IAAiB,GAArB,EAA0B;AACtB,yBAAOH,OAAO,GAAG,EAAjB;AACH,iBAFD,MAEO;AACH,yBAAOA,OAAO,GAAG,CAAjB;AACH;AACJ,eAPL,EAQKlJ,IARL,CAQU,GARV,EAQemJ,OAAO,GAAGC,OAAO,GAAG7L,IAAI,CAACmE,GAAD,CAAd,GAAsB,CAAhC,GAAoC,CAApC,GAAwC,KAAK0I,oBAAoB,CAAC,CAAD,CARhF,EASKpK,IATL,CASU,OATV,EASmB,EATnB,EAUKA,IAVL,CAUU,QAVV,EAUoB,KAAKoK,oBAAoB,CAAC,CAAD,CAV7C,EAWKpK,IAXL,CAWU,QAXV,EAWoB,MAXpB,EAYKA,IAZL,CAYU,MAZV,EAYkBH,KAAK,CAACd,WAZxB;AAcAoK,cAAAA,OAAO,IAAIC,OAAO,GAAG7L,IAAI,CAACmE,GAAD,CAAd,GAAsB,GAAjC;AA1QoB;AA2QvB;AAnS+H;;AAuBpI,6BAAgBoI,KAAhB,8HAAuB;AAAA;AA6QtB;AApSmI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAsSpI,aAAOX,OAAP;AACH,KA5+BI;AA6+BL/B,IAAAA,aA7+BK,yBA6+BS0D,IA7+BT,EA6+BeC,KA7+Bf,EA6+BwC;AAAA,UAAlBC,YAAkB,uEAAH,CAAG;;AACzC,UAAMnL,KAAK,GAAG,IAAd;;AACA,UAAI,QAAOiL,IAAP,MAAgB,QAApB,EAA8B;AAC1B,YAAIE,YAAY,KAAKD,KAArB,EAA4B;AACxBlL,UAAAA,KAAK,CAACX,SAAN,CAAgB0D,IAAhB,CAAqB,CAACkI,IAAI,CAACG,KAAN,EAAaH,IAAI,CAACI,KAAlB,CAArB;AACH,SAFD,MAEO;AACH,cAAMC,UAAU,GAAGpI,MAAM,CAACqI,MAAP,CAAcN,IAAd,CAAnB;AACAK,UAAAA,UAAU,CAACE,OAAX,CAAmB,UAACC,SAAD,EAAe;AAC9B,gBAAI,QAAOA,SAAP,MAAqB,QAAzB,EAAmC;AAC/BzL,cAAAA,KAAK,CAACuH,aAAN,CAAoBkE,SAApB,EAA+BP,KAA/B,EAAsCC,YAAY,GAAG,CAArD;AACH;AACJ,WAJD;AAKH;AACJ;AACJ,KA3/BI;AA4/BLO,IAAAA,aA5/BK,yBA4/BSC,GA5/BT,EA4/Bc;AACf,UAAIC,GAAG,GAAG,CAAV;;AACA,WAAK,IAAI9K,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6K,GAAG,CAAC5K,MAAxB,EAAgCD,CAAC,EAAjC,EAAqC;AACjC8K,QAAAA,GAAG,IAAID,GAAG,CAAC7K,CAAD,CAAH,CAAO,CAAP,CAAP;AACH;;AACD,aAAO8K,GAAP;AACH,KAlgCI;AAmgCLC,IAAAA,cAngCK,0BAmgCUC,IAngCV,EAmgCgB;AACjB,UAAIF,GAAG,GAAG,CAAV;AACA,UAAI3I,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAY6I,IAAZ,CAAX;;AACA,WAAK,IAAIhL,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmC,IAAI,CAAClC,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;AAClC8K,QAAAA,GAAG,IAAIE,IAAI,CAAC7I,IAAI,CAACnC,CAAD,CAAL,CAAX;AACH;;AACD,aAAO8K,GAAP;AACH,KA1gCI;AA2gCLnE,IAAAA,SA3gCK,qBA2gCKsE,GA3gCL,EA2gCUlN,YA3gCV,EA2gCwB;AACzB,UAAMmB,KAAK,GAAG,IAAd;;AACA,UAAI8L,IAAI,GAAG,EAAX;;AACA,WAAK,IAAIhL,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiL,GAAG,CAAChL,MAAxB,EAAgCD,CAAC,EAAjC,EAAqC;AACjC,YAAIkL,IAAI,GAAGD,GAAG,CAACjL,CAAD,CAAd;;AACA,YAAIoC,MAAM,CAACD,IAAP,CAAY6I,IAAZ,EAAkBzB,QAAlB,CAA2B2B,IAAI,CAAC,CAAD,CAA/B,CAAJ,EAAyC;AACrCF,UAAAA,IAAI,CAACE,IAAI,CAAC,CAAD,CAAL,CAAJ,IAAiBA,IAAI,CAAC,CAAD,CAArB;AACH,SAFD,MAEO;AACHF,UAAAA,IAAI,CAACE,IAAI,CAAC,CAAD,CAAL,CAAJ,GAAgBA,IAAI,CAAC,CAAD,CAApB;AACH;AACJ;;AACD,aAAOhM,KAAK,CAACiM,QAAN,CAAeH,IAAf,EAAqBjN,YAArB,CAAP;AACH,KAvhCI;AAwhCLoN,IAAAA,QAxhCK,oBAwhCIH,IAxhCJ,EAwhCUjN,YAxhCV,EAwhCwB;AACzB;AACA,UAAMmB,KAAK,GAAG,IAAd;;AACA,UAAIkM,SAAS,GAAGhJ,MAAM,CAACD,IAAP,CAAY6I,IAAZ,CAAhB;AACA,UAAIK,WAAW,GAAG,EAAlB;AACA,UAAIC,UAAU,GAAG,EAAjB;;AACA,WAAK,IAAItL,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoL,SAAS,CAACnL,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;AACvC,YAAIe,GAAG,GAAGqK,SAAS,CAACpL,CAAD,CAAnB;AACA,YAAIuL,MAAM,GAAGP,IAAI,CAACI,SAAS,CAACpL,CAAD,CAAV,CAAjB;;AACA,YAAIjC,YAAY,CAAC,CAAD,CAAZ,CAAgBgD,GAAhB,EAAqB,CAArB,IAA0BhD,YAAY,CAAC,CAAD,CAAZ,CAAgBgD,GAAhB,EAAqB,CAArB,CAA9B,EAAuD;AACnDsK,UAAAA,WAAW,CAACtK,GAAD,CAAX,GAAmBwK,MAAnB;AACH,SAFD,MAEO;AACHD,UAAAA,UAAU,CAACvK,GAAD,CAAV,GAAkBwK,MAAlB;AACH;AACJ;;AACD,aAAO,CAACF,WAAD,EAAcC,UAAd,CAAP;AACH,KAxiCI;AAyiCLE,IAAAA,UAziCK,sBAyiCMjL,GAziCN,EAyiCWkL,WAziCX,EAyiCwBC,cAziCxB,EAyiCwC7I,KAziCxC,EAyiC+Cc,IAziC/C,EAyiCqD;AACtD,UAAMzE,KAAK,GAAG,IAAd;;AACAqB,MAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,GADf,EAEKA,IAFL,CAEU,GAFV,EAEe,GAFf,EAGKA,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,EAJpB,EAKKA,IALL,CAKU,MALV,EAKkB,SALlB,EAMKA,IANL,CAMU,QANV,EAMoB,SANpB,EAOKA,IAPL,CAOU,SAPV,EAOqB,GAPrB;AASAkB,MAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,GADf,EAEKA,IAFL,CAEU,GAFV,EAEe,GAFf,EAGKA,IAHL,CAGU,OAHV,EAGmB,EAHnB,EAIKA,IAJL,CAIU,QAJV,EAIoB,EAJpB,EAKKA,IALL,CAKU,MALV,EAKkB,MALlB,EAMKA,IANL,CAMU,QANV,EAMoB,SANpB,EAOKA,IAPL,CAOU,SAPV,EAOqB,GAPrB;;AAQA,WAAK,IAAIW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyL,WAAW,CAACxL,MAAhC,EAAwCD,CAAC,EAAzC,EAA6C;AACzC,YAAIA,CAAC,GAAGyL,WAAW,CAACxL,MAAZ,GAAqB,CAA7B,EAAgC;AAC5BM,UAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,IADV,EACgB,MAAMW,CAAC,GAAG,EAD1B,EAEKX,IAFL,CAEU,IAFV,EAEgB,MAAM,CAACW,CAAC,GAAG,CAAL,IAAU,EAFhC,EAGKX,IAHL,CAGU,IAHV,EAGgB,GAHhB,EAIKA,IAJL,CAIU,IAJV,EAIgB,GAJhB,EAKKA,IALL,CAKU,QALV,EAKoB,OALpB;AAMH;;AACDkB,QAAAA,GAAG,CAACE,MAAJ,CAAW,QAAX,EACKpB,IADL,CACU,IADV,EACgB,MAAMW,CAAC,GAAG,EAD1B,EAEKX,IAFL,CAEU,IAFV,EAEgB,GAFhB,EAGKA,IAHL,CAGU,GAHV,EAGe,CAHf,EAIKA,IAJL,CAIU,MAJV,EAIkBwD,KAAK,CAACd,QAAQ,CAAC0J,WAAW,CAACzL,CAAD,CAAZ,CAAT,CAJvB,EAKKX,IALL,CAKU,QALV,EAKoB,SALpB;AAMH;;AACD,UAAMsM,WAAW,GAAG,EAApB;AACA,UAAIC,IAAI,GAAGF,cAAc,CAAC,CAAD,CAAzB;AACA,UAAIG,GAAG,GAAGH,cAAc,CAAC,CAAD,CAAxB,CArCsD,CAsCtD;;AACA,UAAI/H,IAAI,IAAI,GAAZ,EAAiB;AACbpD,QAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,GADf,EAEKA,IAFL,CAEU,GAFV,EAEe,GAFf,EAGKA,IAHL,CAGU,MAHV,EAGkBH,KAAK,CAACf,YAHxB,EAIKkB,IAJL,CAIU,OAJV,EAImB,EAJnB,EAKKA,IALL,CAKU,QALV,EAKoBsM,WAAW,GAAGC,IALlC,EAMKvM,IANL,CAMU,SANV,EAMqB,GANrB;AAQAkB,QAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,GADf,EAEKA,IAFL,CAEU,GAFV,EAEe,MAAMsM,WAAW,GAAGC,IAFnC,EAGKvM,IAHL,CAGU,MAHV,EAGkBH,KAAK,CAACd,WAHxB,EAIKiB,IAJL,CAIU,OAJV,EAImB,EAJnB,EAKKA,IALL,CAKU,QALV,EAKoBsM,WAAW,GAAGE,GALlC,EAMKxM,IANL,CAMU,SANV,EAMqB,GANrB;AAOH,OAhBD,MAgBO;AACHkB,QAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,GADf,EAEKA,IAFL,CAEU,GAFV,EAEe,GAFf,EAGKA,IAHL,CAGU,MAHV,EAGkBH,KAAK,CAACf,YAHxB,EAIKkB,IAJL,CAIU,OAJV,EAImB,EAJnB,EAKKA,IALL,CAKU,QALV,EAKoBsM,WAAW,GAAGC,IALlC,EAMKvM,IANL,CAMU,SANV,EAMqB,GANrB;AAQAkB,QAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,GADf,EAEKA,IAFL,CAEU,GAFV,EAEe,MAAMsM,WAAW,GAAGC,IAFnC,EAGKvM,IAHL,CAGU,MAHV,EAGkBH,KAAK,CAACd,WAHxB,EAIKiB,IAJL,CAIU,OAJV,EAImB,EAJnB,EAKKA,IALL,CAKU,QALV,EAKoBsM,WAAW,GAAGE,GALlC,EAMKxM,IANL,CAMU,SANV,EAMqB,GANrB;AAOH;AACJ,KAjnCI;AAknCLyM,IAAAA,cAlnCK,0BAknCUd,IAlnCV,EAknCgBjN,YAlnChB,EAknC8B;AAC/B,UAAMmB,KAAK,GAAG,IAAd;;AACA,UAAI6M,SAAS,GAAG,EAAhB;AACA,UAAIC,SAAS,GAAG,EAAhB,CAH+B,CAI/B;;AACA,UAAIZ,SAAS,GAAGhJ,MAAM,CAACD,IAAP,CAAY6I,IAAZ,CAAhB;AACA,UAAIpO,IAAI,GAAG,EAAX;;AACA,WAAK,IAAIoD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoL,SAAS,CAACnL,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;AACvCpD,QAAAA,IAAI,CAACwO,SAAS,CAACpL,CAAD,CAAV,CAAJ,GAAqBgL,IAAI,CAACI,SAAS,CAACpL,CAAD,CAAV,CAAJ,CAAmB,OAAnB,CAArB;AACH;;AACD,UAAI4B,MAAM,GAAG1C,KAAK,CAAC+M,UAAN,CAAiBrP,IAAjB,EAAuB,CAAvB,CAAb,CAV+B,CAW/B;;;AACA,WAAK,IAAIoD,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAG4B,MAAM,CAAC3B,MAA3B,EAAmCD,IAAC,EAApC,EAAwC;AACpCd,QAAAA,KAAK,CAACX,SAAN,GAAkB,EAAlB;;AACAW,QAAAA,KAAK,CAACgN,YAAN,CAAmBlB,IAAI,CAACpJ,MAAM,CAAC5B,IAAD,CAAN,CAAU,CAAV,CAAD,CAAvB;;AACA,YAAId,KAAK,CAACX,SAAN,CAAgB0B,MAAhB,IAA0B,CAA9B,EAAiC;AAC7B8L,UAAAA,SAAS,CAAC9J,IAAV,CAAeL,MAAM,CAAC5B,IAAD,CAAN,CAAU,CAAV,CAAf;AACAgM,UAAAA,SAAS,CAAC/J,IAAV,CAAe,KAAf;AACA;AACH;;AACD,YAAIkK,UAAU,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAjB,CARoC,CAQZ;;AACxB,aAAK,IAAInM,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGd,KAAK,CAACX,SAAN,CAAgB0B,MAApC,EAA4CD,IAAC,EAA7C,EAAiD;AAC7CmM,UAAAA,UAAU,CAAC,CAAD,CAAV,IAAiBpO,YAAY,CAAC,CAAD,CAAZ,CAAgBmB,KAAK,CAACX,SAAN,CAAgByB,IAAhB,EAAmB,CAAnB,CAAhB,EAAuC,CAAvC,IAA4Cd,KAAK,CAACX,SAAN,CAAgByB,IAAhB,EAAmB,CAAnB,CAA7D;AACAmM,UAAAA,UAAU,CAAC,CAAD,CAAV,IAAiBpO,YAAY,CAAC,CAAD,CAAZ,CAAgBmB,KAAK,CAACX,SAAN,CAAgByB,IAAhB,EAAmB,CAAnB,CAAhB,EAAuC,CAAvC,IAA4Cd,KAAK,CAACX,SAAN,CAAgByB,IAAhB,EAAmB,CAAnB,CAA7D;AACH;;AACD,YAAIoM,EAAE,GAAGD,UAAU,CAAC,CAAD,CAAV,GAAgBA,UAAU,CAAC,CAAD,CAAnC;AACAA,QAAAA,UAAU,CAAC,CAAD,CAAV,IAAiBC,EAAjB;AACAD,QAAAA,UAAU,CAAC,CAAD,CAAV,IAAiBC,EAAjB;AACAL,QAAAA,SAAS,CAAC9J,IAAV,CAAeL,MAAM,CAAC5B,IAAD,CAArB;AACAgM,QAAAA,SAAS,CAAC/J,IAAV,CAAekK,UAAf;AACH;;AACD,aAAO,CAACJ,SAAD,EAAYC,SAAZ,CAAP;AACH,KAlpCI;AAmpCL/G,IAAAA,uBAnpCK,mCAmpCmBoH,SAnpCnB,EAmpC8B;AAC/B,UAAMC,IAAI,GAAG,EAAb;AACAD,MAAAA,SAAS,CAAC3B,OAAV,CAAkB,UAAC1B,QAAD,EAAc;AAC5B,YAAIuD,WAAW,GAAGD,IAAlB;AACAtD,QAAAA,QAAQ,CAAC0B,OAAT,CAAiB,UAACJ,KAAD,EAAW;AACxB,cAAI,CAACiC,WAAW,CAACjC,KAAD,CAAhB,EAAyB;AACrBiC,YAAAA,WAAW,CAACjC,KAAD,CAAX,GAAqB;AACjBA,cAAAA,KAAK,EAALA,KADiB;AAEjBC,cAAAA,KAAK,EAAE;AAFU,aAArB;AAIH;;AACDgC,UAAAA,WAAW,CAACjC,KAAD,CAAX,CAAmBC,KAAnB;AACAgC,UAAAA,WAAW,GAAGA,WAAW,CAACjC,KAAD,CAAzB;AACH,SATD;AAUH,OAZD;AAaA,aAAOgC,IAAP;AACH,KAnqCI;AAoqCLJ,IAAAA,YApqCK,wBAoqCQ/B,IApqCR,EAoqCc;AACf,UAAMjL,KAAK,GAAG,IAAd;;AACA,UAAI,QAAOiL,IAAP,MAAgB,QAApB,EAA8B;AAC1BjL,QAAAA,KAAK,CAACX,SAAN,CAAgB0D,IAAhB,CAAqB,CAACkI,IAAI,CAACG,KAAN,EAAaH,IAAI,CAACI,KAAlB,CAArB;;AACA,YAAMC,UAAU,GAAGpI,MAAM,CAACqI,MAAP,CAAcN,IAAd,CAAnB;AACAK,QAAAA,UAAU,CAACE,OAAX,CAAmB,UAACC,SAAD,EAAe;AAC9B,cAAI,QAAOA,SAAP,MAAqB,QAAzB,EAAmC;AAC/BzL,YAAAA,KAAK,CAACgN,YAAN,CAAmBvB,SAAnB;AACH;AACJ,SAJD;AAKH;AACJ,KA/qCI;AAgrCL6B,IAAAA,sBAhrCK,kCAgrCkB7J,YAhrClB,EAgrCgC/F,IAhrChC,EAgrCsC2L,OAhrCtC,EAgrC+CC,OAhrC/C,EAgrCwDzK,YAhrCxD,EAgrCsE;AACvE,UAAMwC,GAAG,GAAG7D,EAAE,CAAC8D,MAAH,CAAU,mBAAV,EAA+BC,MAA/B,CAAsC,GAAtC,EACPpB,IADO,CACF,OADE,EACO,KADP,EAEPA,IAFO,CAEF,OAFE,EAEO,GAFP,EAGPA,IAHO,CAGF,QAHE,EAGQ,GAHR,EAIPA,IAJO,CAIF,WAJE,EAIW,mBAAmBmJ,OAAO,GAAG,EAA7B,IAAmC,GAJ9C,CAAZ;AAKA,UAAM7C,KAAK,GAAG,GAAd;AACA,UAAMC,MAAM,GAAG,GAAf;;AACA,UAAM1G,KAAK,GAAG,IAAd;;AACA,UAAMuN,WAAW,GAAG7P,IAAI,CAACqD,MAAzB;AAEA,UAAM2C,QAAQ,GAAG,EAAjB;;AACA,WAAK,IAAI5C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2C,YAApB,EAAkC3C,CAAC,EAAnC,EAAuC;AACnC4C,QAAAA,QAAQ,CAACX,IAAT,CAAcjC,CAAd;AACH;;AACD,UAAM6C,KAAK,GAAGnG,EAAE,CAACoG,YAAH,GACTC,MADS,CACFH,QADE,EAETI,KAFS,CAEH9D,KAAK,CAACZ,UAFH,CAAd;AAIA,UAAMoO,OAAO,GAAGhQ,EAAE,CAACiQ,WAAH,GACX3J,KADW,CACL,CAACuF,OAAO,GAAG,EAAX,EAAeA,OAAO,GAAG,GAAzB,CADK,EAEXxF,MAFW,CAEJ,CAAC,CAAD,EAAI,CAAJ,CAFI,CAAhB;AAIA,UAAM0F,OAAO,GAAG/L,EAAE,CAACiQ,WAAH,GACX3J,KADW,CACL,CAACwF,OAAO,GAAG,EAAX,EAAeA,OAAO,GAAG,EAAV,GAAe5C,MAA9B,CADK,EAEX7C,MAFW,CAEJ,CAAC,CAAD,EAAI,EAAJ,CAFI,CAAhB;;AAIA,WAAK,IAAI/C,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAG,EAApB,EAAwBA,IAAC,EAAzB,EAA6B;AACzB,YAAI4M,eAAe,GAAG,CAAtB;;AACA,aAAK,IAAI1M,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtD,IAAI,CAACoD,IAAD,CAAJ,CAAQC,MAA5B,EAAoCC,CAAC,EAArC,EAAyC;AACrC,cAAI0M,eAAe,IAAI,CAAvB,EAA0B;AACtB;AACA,gBAAIC,UAAU,GAAGjQ,IAAI,CAACoD,IAAD,CAAJ,CAAQC,MAAR,GAAiBC,CAAjB,GAAqB,CAAtC;AACA,gBAAIoK,KAAK,GAAG,CAAZ,CAHsB,CAItB;;AACA,gBAAIuC,UAAU,GAAG,CAAjB,EAAoB;AAChBA,cAAAA,UAAU,GAAG,CAAb;AACH;;AACD,gBAAIA,UAAU,IAAI,CAAlB,EAAqB;AACjB,kBAAIC,SAAS,GAAG/O,YAAY,CAAC,CAAD,CAAZ,CAAgBnB,IAAI,CAACoD,IAAD,CAAJ,CAAQE,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiB8B,QAAjB,EAAhB,CAAhB;;AACAsI,cAAAA,KAAK,GAAGwC,SAAS,CAAC,CAAD,CAAT,GAAeA,SAAS,CAAC,CAAD,CAAhC;AACH,aAHD,MAGO;AACH,mBAAK,IAAI/M,CAAC,GAAG8M,UAAb,EAAyB9M,CAAC,IAAI,CAA9B,EAAiCA,CAAC,EAAlC,EAAsC;AAClC;AACA,oBAAIgN,QAAQ,GAAGnQ,IAAI,CAACoD,IAAD,CAAJ,CAAQE,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiB8B,QAAjB,EAAf;;AACA,qBAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIL,CAArB,EAAwBK,CAAC,EAAzB,EAA6B;AACzB2M,kBAAAA,QAAQ,GAAGA,QAAQ,GAAGnQ,IAAI,CAACoD,IAAD,CAAJ,CAAQE,CAAC,GAAGE,CAAZ,EAAe,CAAf,EAAkB,CAAlB,EAAqB4B,QAArB,EAAtB;AACH;;AACD,oBAAIjE,YAAY,CAAC,CAAD,CAAZ,CAAgBwL,QAAhB,CAAyBwD,QAAzB,CAAJ,EAAwC;AACpCH,kBAAAA,eAAe,GAAG7M,CAAlB;AACA,sBAAI+M,UAAS,GAAG/O,YAAY,CAAC,CAAD,CAAZ,CAAgBgP,QAAhB,CAAhB;AACAzC,kBAAAA,KAAK,GAAGwC,UAAS,CAAC,CAAD,CAAT,GAAeA,UAAS,CAAC,CAAD,CAAhC;AACA;AACH;AACJ;AACJ;;AACDvM,YAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACeqN,OAAO,CAACxM,CAAD,CAAP,GAAa,CAD5B,EAEKb,IAFL,CAEU,GAFV,EAEeoJ,OAAO,CAACzI,IAAD,CAAP,GAAa,CAF5B,EAGKX,IAHL,CAGU,OAHV,EAGmBqN,OAAO,CAACxM,CAAC,GAAG0M,eAAL,CAAP,GAA+BF,OAAO,CAACxM,CAAD,CAAtC,GAA4C,EAH/D,EAIKb,IAJL,CAIU,QAJV,EAIoB,EAJpB,EAKKA,IALL,CAKU,MALV,EAKkB,YAAY;AACtB,kBAAIiL,KAAK,GAAG,CAAZ,EAAe;AACX,uBAAOpL,KAAK,CAACf,YAAb;AACH,eAFD,MAEO;AACH,uBAAOe,KAAK,CAACd,WAAb;AACH;AACJ,aAXL,EAYKiB,IAZL,CAYU,SAZV,EAYqB,YAAY;AACzB;AACA,kBAAIiL,KAAK,GAAG,CAAZ,EAAe;AACX,uBAAO,MAAO,CAACA,KAAf;AACH,eAFD,MAEO;AACH,uBAAO,MAAOA,KAAd;AACH;AACJ,aAnBL;AAoBAsC,YAAAA,eAAe,GAAGA,eAAe,GAAG,CAApC;AACH;;AACDrM,UAAAA,GAAG,CAACE,MAAJ,CAAW,QAAX,EACKpB,IADL,CACU,IADV,EACgBqN,OAAO,CAACxM,CAAD,CADvB,EAEKb,IAFL,CAEU,IAFV,EAEgBoJ,OAAO,CAACzI,IAAD,CAFvB,EAGKX,IAHL,CAGU,GAHV,EAGe,CAHf,EAIKA,IAJL,CAIU,QAJV,EAIoB,SAJpB,EAKKA,IALL,CAKU,MALV,EAKkBwD,KAAK,CAACjG,IAAI,CAACoD,IAAD,CAAJ,CAAQE,CAAR,EAAW,CAAX,EAAc,CAAd,CAAD,CALvB;AAMA0M,UAAAA,eAAe,GAAGA,eAAe,GAAG,CAApC;AACH;AACJ;AACJ,KAvwCI;AAwwCLI,IAAAA,SAxwCK,qBAwwCKC,SAxwCL,EAwwCgBC,QAxwChB,EAwwC0B;AAC3B,UAAIC,GAAG,GAAGD,QAAQ,IAAI,EAAtB;;AACA,WAAK,IAAIlN,CAAT,IAAciN,SAAd,EAAyB;AACrB,YAAIG,IAAI,GAAGH,SAAS,CAACjN,CAAD,CAApB,CADqB,CACW;;AAChC,YAAIoN,IAAI,KAAKD,GAAb,EAAkB;AACd;AACH;;AACD,YAAI,QAAOC,IAAP,MAAgB,QAApB,EAA8B;AAC1BD,UAAAA,GAAG,CAACnN,CAAD,CAAH,GAAUoN,IAAI,CAACC,WAAL,KAAqBrP,KAAtB,GAA+B,EAA/B,GAAoC,EAA7C;AACAsP,UAAAA,SAAS,CAACC,MAAV,CAAiBH,IAAjB,EAAuBD,GAAG,CAACnN,CAAD,CAA1B;AACH,SAHD,MAGO;AACHmN,UAAAA,GAAG,CAACnN,CAAD,CAAH,GAASoN,IAAT;AACH;AACJ;;AACD,aAAOD,GAAP;AACH,KAvxCI;AAwxCLhO,IAAAA,0BAxxCK,sCAwxCsBwD,YAxxCtB,EAwxCoC/F,IAxxCpC,EAwxC0CmB,YAxxC1C,EAwxCwD;AACzD,UAAMyK,OAAO,GAAG,CAAhB;AACA,UAAM5F,QAAQ,GAAG,EAAjB;;AACA,UAAM1D,KAAK,GAAG,IAAd;;AACA,WAAK,IAAIc,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2C,YAApB,EAAkC3C,CAAC,EAAnC,EAAuC;AACnC4C,QAAAA,QAAQ,CAACX,IAAT,CAAcjC,CAAd;AACH;;AACD,UAAM6C,KAAK,GAAGnG,EAAE,CAACoG,YAAH,GACTC,MADS,CACFH,QADE,EAETI,KAFS,CAEH9D,KAAK,CAACZ,UAFH,CAAd;AAGA,UAAMqH,KAAK,GAAG,GAAd;AACA,UAAMC,MAAM,GAAG,GAAf;AACA,UAAM6G,WAAW,GAAG7P,IAAI,CAACqD,MAAzB;AACA,UAAMM,GAAG,GAAG7D,EAAE,CAAC8D,MAAH,CAAU,mBAAV,EAA+BC,MAA/B,CAAsC,GAAtC,EACPpB,IADO,CACF,OADE,EACO,qBADP,EAEPA,IAFO,CAEF,OAFE,EAEO,GAFP,EAGPA,IAHO,CAGF,QAHE,EAGQ,GAHR,EAIPA,IAJO,CAIF,WAJE,EAIW,kBAJX,CAAZ;AAMA,UAAImO,MAAM,GAAG,EAAb;;AACA,WAAK,IAAIxN,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAG2C,YAApB,EAAkC3C,IAAC,EAAnC,EAAuC;AACnCwN,QAAAA,MAAM,CAACvL,IAAP,CAAYjC,IAAZ;AACH;;AAED,UAAIoE,aAAa,GAAG,EAApB;;AACA,WAAK,IAAIpE,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGyM,WAApB,EAAiCzM,IAAC,EAAlC,EAAsC;AAAC;AACnC,YAAIyN,mBAAmB,GAAG,EAA1B;;AACA,aAAK,IAAIvN,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtD,IAAI,CAACoD,IAAD,CAAJ,CAAQC,MAAR,GAAiB,CAArC,EAAwCC,CAAC,EAAzC,EAA6C;AAAC;AAC1CuN,UAAAA,mBAAmB,CAACxL,IAApB,CAAyBrF,IAAI,CAACoD,IAAD,CAAJ,CAAQE,CAAR,EAAW,CAAX,EAAc,CAAd,CAAzB;AACH;;AACDkE,QAAAA,aAAa,CAACnC,IAAd,CAAmBwL,mBAAnB;AACH;;AAED,UAAIC,YAAY,GAAG,EAAnB;AACA,UAAIC,cAAc,GAAG,EAArB,CAlCyD,CAmCzD;;AACA,WAAK,IAAI3N,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGoE,aAAa,CAACnE,MAAlC,EAA0CD,IAAC,EAA3C,EAA+C;AAC3C,YAAI4M,eAAe,GAAG,CAAtB;AACA,YAAIgB,cAAc,GAAG,EAArB;AACA,YAAIC,gBAAgB,GAAG,EAAvB;;AACA,aAAK,IAAI3N,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGkE,aAAa,CAACpE,IAAD,CAAb,CAAiBC,MAArC,EAA6CC,GAAC,EAA9C,EAAkD;AAC9C,cAAI0M,eAAe,IAAI,CAAvB,EAA0B;AACtB;AACA,gBAAIC,UAAU,GAAGzI,aAAa,CAACpE,IAAD,CAAb,CAAiBC,MAAjB,GAA0BC,GAA1B,GAA8B,CAA/C;AACA,gBAAIoK,KAAK,GAAG,CAAZ;AACA,gBAAIyC,QAAQ,GAAG,EAAf,CAJsB,CAKtB;;AACA,gBAAIF,UAAU,GAAG,CAAjB,EAAoB;AAChBA,cAAAA,UAAU,GAAG,CAAb;AACH;;AACD,gBAAIA,UAAU,IAAI,CAAlB,EAAqB;AACjB,kBAAIC,SAAS,GAAG/O,YAAY,CAAC,CAAD,CAAZ,CAAgBqG,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAjB,EAAoB8B,QAApB,EAAhB,CAAhB;;AACAsI,cAAAA,KAAK,GAAGwC,SAAS,CAAC,CAAD,CAAT,GAAeA,SAAS,CAAC,CAAD,CAAhC;AACAC,cAAAA,QAAQ,GAAG3I,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAjB,EAAoB8B,QAApB,EAAX;AACH,aAJD,MAIO;AACH,mBAAK,IAAIjC,CAAC,GAAG8M,UAAb,EAAyB9M,CAAC,IAAI,CAA9B,EAAiCA,CAAC,EAAlC,EAAsC;AAClC;AACAgN,gBAAAA,QAAQ,GAAG3I,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAjB,EAAoB8B,QAApB,EAAX;;AACA,qBAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIL,CAArB,EAAwBK,CAAC,EAAzB,EAA6B;AACzB2M,kBAAAA,QAAQ,GAAGA,QAAQ,GAAG3I,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAC,GAAGE,CAArB,EAAwB4B,QAAxB,EAAtB;AACH;;AACD,oBAAIjE,YAAY,CAAC,CAAD,CAAZ,CAAgBwL,QAAhB,CAAyBwD,QAAzB,CAAJ,EAAwC;AACpCH,kBAAAA,eAAe,GAAG7M,CAAlB;AACA,sBAAI+M,WAAS,GAAG/O,YAAY,CAAC,CAAD,CAAZ,CAAgBgP,QAAhB,CAAhB;AACAzC,kBAAAA,KAAK,GAAGwC,WAAS,CAAC,CAAD,CAAT,GAAeA,WAAS,CAAC,CAAD,CAAhC;AACA;AACH;AACJ;AACJ;;AACD,iBAAK,IAAI/M,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG6M,eAAe,GAAG,CAAtC,EAAyC7M,GAAC,EAA1C,EAA8C;AAC1C6N,cAAAA,cAAc,CAAC3L,IAAf,CAAoB8K,QAApB;AACAc,cAAAA,gBAAgB,CAAC5L,IAAjB,CAAsBqI,KAAtB;AACH;;AACDsC,YAAAA,eAAe,GAAGA,eAAe,GAAG,CAApC;AACH;;AACDA,UAAAA,eAAe,GAAGA,eAAe,GAAG,CAApC;AACH;;AACDc,QAAAA,YAAY,CAACzL,IAAb,CAAkB2L,cAAlB;AACAD,QAAAA,cAAc,CAAC1L,IAAf,CAAoB4L,gBAApB;AACH,OA/EwD,CAiFzD;;;AACA,UAAIC,WAAW,GAAG,EAAlB;;AACA,WAAK,IAAI9N,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGoE,aAAa,CAACnE,MAAlC,EAA0CD,IAAC,EAA3C,EAA+C;AAC3C,aAAK,IAAIE,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGkE,aAAa,CAACpE,IAAD,CAAb,CAAiBC,MAArC,EAA6CC,GAAC,EAA9C,EAAkD;AAC9C,cAAI6N,aAAa,GAAG3J,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAjB,CAApB;AACA,cAAI8N,UAAU,GAAG,GAAjB;;AACA,cAAI9N,GAAC,GAAGkE,aAAa,CAACpE,IAAD,CAAb,CAAiBC,MAAjB,GAA0B,CAAlC,EAAqC;AACjC+N,YAAAA,UAAU,GAAG5J,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAC,GAAG,CAArB,CAAb;AACH;;AACD,cAAI+N,cAAc,GAAGF,aAAa,CAAC/L,QAAd,KAA2BgM,UAAU,CAAChM,QAAX,EAAhD;;AACA,cAAII,MAAM,CAACD,IAAP,CAAY2L,WAAZ,EAAyBvE,QAAzB,CAAkCrJ,GAAC,CAAC8B,QAAF,EAAlC,CAAJ,EAAqD;AACjD,gBAAII,MAAM,CAACD,IAAP,CAAY2L,WAAW,CAAC5N,GAAC,CAAC8B,QAAF,EAAD,CAAvB,EAAuCuH,QAAvC,CAAgD0E,cAAhD,CAAJ,EAAqE;AACjEH,cAAAA,WAAW,CAAC5N,GAAC,CAAC8B,QAAF,EAAD,CAAX,CAA0BiM,cAA1B,IAA4CH,WAAW,CAAC5N,GAAC,CAAC8B,QAAF,EAAD,CAAX,CAA0BiM,cAA1B,IAA4C,CAAxF;AACH,aAFD,MAEO;AACHH,cAAAA,WAAW,CAAC5N,GAAC,CAAC8B,QAAF,EAAD,CAAX,CAA0BiM,cAA1B,IAA4C,CAA5C;AACH;AACJ,WAND,MAMO;AACHH,YAAAA,WAAW,CAAC5N,GAAC,CAAC8B,QAAF,EAAD,CAAX,GAA4B,EAA5B;AACA8L,YAAAA,WAAW,CAAC5N,GAAC,CAAC8B,QAAF,EAAD,CAAX,CAA0BiM,cAA1B,IAA4C,CAA5C;AACH;AACJ;AACJ;;AACD,UAAMC,aAAa,GAAG,MAAMtR,IAAI,CAACqD,MAAX,GAAoB,GAA1C;AACA,UAAMyM,OAAO,GAAGhQ,EAAE,CAACiQ,WAAH,GACX5J,MADW,CACJ,CAAC,CAAD,EAAIX,MAAM,CAACD,IAAP,CAAY2L,WAAZ,EAAyB7N,MAAzB,GAAkC,CAAtC,CADI,EAEX+C,KAFW,CAEL,CAAC,EAAD,EAAK,GAAL,CAFK,CAAhB;AAGA,UAAMyF,OAAO,GAAG,MAAMyF,aAAtB;AACA,UAAMC,oBAAoB,GAAG5N,GAAG,CAACE,MAAJ,CAAW,GAAX,EACxBpB,IADwB,CACnB,OADmB,EACV,GADU,EAExBA,IAFwB,CAEnB,QAFmB,EAET,GAFS,CAA7B,CA5GyD,CA+GzD;;AACA,UAAIX,UAAU,GAAG,EAAjB;AACA,UAAI0P,WAAW,GAAG,EAAlB;AACA,UAAIC,cAAc,GAAG,IAAIrQ,KAAJ,EAArB,CAlHyD,CAmHzD;;AACA,WAAK,IAAIgC,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGoC,MAAM,CAACD,IAAP,CAAY2L,WAAZ,EAAyB7N,MAA7C,EAAqDD,IAAC,EAAtD,EAA0D;AACtD,YAAI8G,YAAY,GAAG,EAAnB;;AACA,aAAK,IAAI1G,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGuC,YAApB,EAAkCvC,GAAC,EAAnC,EAAuC;AACnC,cAAIkO,MAAM,GAAGtO,IAAC,CAACgC,QAAF,KAAe5B,GAAC,CAAC4B,QAAF,EAA5B,CADmC,CAEnC;;;AACAqM,UAAAA,cAAc,CAACC,MAAD,CAAd,GAAyBxH,YAAzB,CAHmC,CAInC;;AACA,eAAK,IAAI+C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlH,YAApB,EAAkCkH,CAAC,EAAnC,EAAuC;AACnC,gBAAI0E,MAAK,GAAGnO,GAAC,CAAC4B,QAAF,KAAe6H,CAAC,CAAC7H,QAAF,EAA3B;;AACA,gBAAII,MAAM,CAACD,IAAP,CAAY2L,WAAW,CAAC9N,IAAD,CAAvB,EAA4BuJ,QAA5B,CAAqCgF,MAArC,CAAJ,EAAiD;AAC7C,kBAAInM,MAAM,CAACD,IAAP,CAAYzD,UAAZ,EAAwB6K,QAAxB,CAAiCvJ,IAAC,CAACgC,QAAF,EAAjC,CAAJ,EAAoD;AAChDtD,gBAAAA,UAAU,CAACsB,IAAC,CAACgC,QAAF,EAAD,CAAV,CAAyBuM,MAAzB,IAAkCzH,YAAlC;AACAsH,gBAAAA,WAAW,CAACpO,IAAC,CAACgC,QAAF,EAAD,CAAX,CAA0BuM,MAA1B,IAAmCzH,YAAnC;AACH,eAHD,MAGO;AACHpI,gBAAAA,UAAU,CAACsB,IAAC,CAACgC,QAAF,EAAD,CAAV,GAA2B,EAA3B;AACAoM,gBAAAA,WAAW,CAACpO,IAAC,CAACgC,QAAF,EAAD,CAAX,GAA4B,EAA5B;AACAtD,gBAAAA,UAAU,CAACsB,IAAC,CAACgC,QAAF,EAAD,CAAV,CAAyBuM,MAAzB,IAAkCzH,YAAlC;AACAsH,gBAAAA,WAAW,CAACpO,IAAC,CAACgC,QAAF,EAAD,CAAX,CAA0BuM,MAA1B,IAAmCzH,YAAnC;AACH;;AACDA,cAAAA,YAAY,GAAGA,YAAY,GAAG2B,OAAO,GAAGqF,WAAW,CAAC9N,IAAD,CAAX,CAAeuO,MAAf,CAAxC;AACH;AACJ;;AACD,cAAIA,KAAK,GAAGnO,GAAC,CAAC4B,QAAF,KAAe,GAA3B,CApBmC,CAoBJ;;AAC/B,cAAII,MAAM,CAACD,IAAP,CAAYzD,UAAZ,EAAwB6K,QAAxB,CAAiCvJ,IAAC,CAACgC,QAAF,EAAjC,CAAJ,EAAoD;AAChDtD,YAAAA,UAAU,CAACsB,IAAC,CAACgC,QAAF,EAAD,CAAV,CAAyBuM,KAAzB,IAAkCzH,YAAlC;AACH,WAFD,MAEO;AACHpI,YAAAA,UAAU,CAACsB,IAAC,CAACgC,QAAF,EAAD,CAAV,GAA2B,EAA3B;AACAtD,YAAAA,UAAU,CAACsB,IAAC,CAACgC,QAAF,EAAD,CAAV,CAAyBuM,KAAzB,IAAkCzH,YAAlC;AACH;;AACD,cAAI1E,MAAM,CAACD,IAAP,CAAY2L,WAAW,CAAC9N,IAAD,CAAvB,EAA4BuJ,QAA5B,CAAqCgF,KAArC,CAAJ,EAAiD;AAC7CzH,YAAAA,YAAY,GAAGA,YAAY,GAAG2B,OAAO,GAAGqF,WAAW,CAAC9N,IAAD,CAAX,CAAeuO,KAAf,CAAxC;AACH;;AACDzH,UAAAA,YAAY,GAAGA,YAAY,GAAG,EAA9B;AACH;AACJ,OAtJwD,CAuJzD;;;AACA,UAAM0H,OAAO,GAAG,MAAMN,aAAtB;AACA,UAAMO,SAAS,GAAGlO,GAAG,CAACE,MAAJ,CAAW,GAAX,EACbpB,IADa,CACR,OADQ,EACC,GADD,EAEbA,IAFa,CAER,QAFQ,EAEE,GAFF,EAGbgC,KAHa,CAGP,SAHO,EAGI,CAHJ,EAIbhC,IAJa,CAIR,WAJQ,EAIK,iBAJL,CAAlB;AAMA,UAAMqP,SAAS,GAAGnO,GAAG,CAACE,MAAJ,CAAW,GAAX,EACbpB,IADa,CACR,OADQ,EACC,GADD,EAEbA,IAFa,CAER,QAFQ,EAEE,GAFF,EAGbgC,KAHa,CAGP,SAHO,EAGI,CAHJ,EAIbhC,IAJa,CAIR,WAJQ,EAIK,iBAJL,CAAlB;AAMA,UAAM8F,aAAa,GAAGzI,EAAE,CAAC0I,IAAH,GACjBC,CADiB,CACf,UAAUC,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACD,CAAT;AAAa,OADb,EAEjBE,CAFiB,CAEf,UAAUD,CAAV,EAAa;AAAE,eAAOA,CAAC,CAACC,CAAT;AAAa,OAFb,EAGjBC,KAHiB,CAGX9I,EAAE,CAAC+I,eAAH,CAAmBC,KAAnB,CAAyB,GAAzB,CAHW,CAAtB;AAIA,UAAIiJ,eAAe,GAAGvM,MAAM,CAACD,IAAP,CAAYzD,UAAZ,CAAtB;;AACA,WAAK,IAAIsB,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAG2O,eAAe,CAAC1O,MAAhB,GAAyB,CAA7C,EAAgDD,IAAC,EAAjD,EAAqD;AAAC;AAClD,YAAI4O,gBAAgB,GAAGxM,MAAM,CAACD,IAAP,CAAYzD,UAAU,CAACsB,IAAD,CAAtB,CAAvB,CADiD,CACA;;AACjD,aAAK,IAAII,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGuC,YAApB,EAAkCvC,GAAC,EAAnC,EAAuC;AACnC,eAAK,IAAIyJ,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGlH,YAApB,EAAkCkH,GAAC,EAAnC,EAAuC;AACnC,gBAAIgF,YAAY,GAAGzO,GAAC,CAAC4B,QAAF,KAAe6H,GAAC,CAAC7H,QAAF,EAAlC;;AACA,gBAAI4M,gBAAgB,CAACrF,QAAjB,CAA0BsF,YAA1B,CAAJ,EAA6C;AACzC,kBAAIC,SAAS,GAAGV,WAAW,CAACO,eAAe,CAAC3O,IAAD,CAAhB,CAAX,CAAgC6O,YAAhC,CAAhB;;AACA,kBAAIb,WAAU,GAAGnE,GAAC,CAAC7H,QAAF,EAAjB;;AACA,kBAAIgM,WAAU,IAAI,GAAlB,EAAuB;AACnB,oBAAIM,OAAM,GAAGK,eAAe,CAAC3O,IAAD,CAAf,GAAqBgO,WAAlC;;AACA,oBAAIe,WAAW,GAAG,CAAChN,QAAQ,CAAC4M,eAAe,CAAC3O,IAAD,CAAhB,CAAR,GAA+B,CAAhC,EAAmCgC,QAAnC,KAAgDgM,WAAlE;;AACA,oBAAIgB,MAAM,GAAGX,cAAc,CAACU,WAAD,CAA3B;AACA,oBAAIE,WAAW,GAAGnB,WAAW,CAACa,eAAe,CAAC3O,IAAD,CAAhB,CAAX,CAAgC6O,YAAhC,IAAgDL,OAAlE;AACA,oBAAIzG,SAAS,GAAG,CACZ;AAAE1C,kBAAAA,CAAC,EAAEqH,OAAO,CAAC1M,IAAD,CAAP,GAAa,EAAlB;AAAsBuF,kBAAAA,CAAC,EAAEuJ,SAAS,GAAGG,WAAW,GAAG;AAAnD,iBADY,EAEZ;AAAE5J,kBAAAA,CAAC,EAAEqH,OAAO,CAAC1M,IAAD,CAAP,GAAa,EAAlB;AAAsBuF,kBAAAA,CAAC,EAAEuJ,SAAS,GAAGG,WAAW,GAAG;AAAnD,iBAFY,EAGZ;AAAE5J,kBAAAA,CAAC,EAAEqH,OAAO,CAAC1M,IAAC,GAAG,CAAL,CAAP,GAAiB,CAAtB;AAAyBuF,kBAAAA,CAAC,EAAEyJ,MAAM,GAAGC,WAAW,GAAG;AAAnD,iBAHY,EAIZ;AAAE5J,kBAAAA,CAAC,EAAEqH,OAAO,CAAC1M,IAAC,GAAG,CAAL,CAAP,GAAiB,EAAtB;AAA0BuF,kBAAAA,CAAC,EAAEyJ,MAAM,GAAGC,WAAW,GAAG;AAApD,iBAJY,CAAhB;;AAMA,oBAAIA,WAAW,GAAG,EAAlB,EAAsB;AAClBP,kBAAAA,SAAS,CAACjO,MAAV,CAAiB,MAAjB,EACKwH,KADL,CACWF,SADX,EAEK1I,IAFL,CAEU,MAFV,EAEkB,MAFlB,EAGKA,IAHL,CAGU,QAHV,EAGoBH,KAAK,CAACtB,gBAH1B,EAIKyB,IAJL,CAIU,cAJV,EAI0B4P,WAJ1B,EAKK5P,IALL,CAKU,SALV,EAKqB,GALrB,EAMKA,IANL,CAMU,GANV,EAMe8F,aANf;AAOH,iBARD,MAQO;AACHsJ,kBAAAA,SAAS,CAAChO,MAAV,CAAiB,MAAjB,EACKwH,KADL,CACWF,SADX,EAEK1I,IAFL,CAEU,MAFV,EAEkB,MAFlB,EAGKA,IAHL,CAGU,QAHV,EAGoBH,KAAK,CAACtB,gBAH1B,EAIKyB,IAJL,CAIU,cAJV,EAI0B4P,WAJ1B,EAKK5P,IALL,CAKU,SALV,EAKqB,GALrB,EAMKA,IANL,CAMU,GANV,EAMe8F,aANf;AAOH;;AAEDkJ,gBAAAA,cAAc,CAACU,WAAD,CAAd,GAA8BV,cAAc,CAACU,WAAD,CAAd,GAA8BE,WAA5D;AACH;AACJ;AACJ;AACJ;AACJ;;AAED,UAAMC,QAAQ,GAAG3O,GAAG,CAACE,MAAJ,CAAW,GAAX,EACZpB,IADY,CACP,OADO,EACE,GADF,EAEZA,IAFY,CAEP,QAFO,EAEG,GAFH,EAGZA,IAHY,CAGP,WAHO,EAGM,iBAHN,CAAjB;;AAIA,WAAK,IAAIW,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGoE,aAAa,CAACnE,MAAlC,EAA0CD,IAAC,EAA3C,EAA+C;AAC3C,YAAImP,MAAM,GAAG,CAAb;;AACA,aAAK,IAAIjP,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGkE,aAAa,CAACpE,IAAD,CAAb,CAAiBC,MAArC,EAA6CC,GAAC,EAA9C,EAAkD;AAC9C,cAAIqO,OAAK,GAAG,EAAZ;;AACA,cAAIrO,GAAC,IAAIkE,aAAa,CAACpE,IAAD,CAAb,CAAiBC,MAAjB,GAA0B,CAAnC,EAAsC;AAClCsO,YAAAA,OAAK,GAAGnK,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAjB,EAAoB8B,QAApB,KAAiC,GAAzC;AACH,WAFD,MAEO;AACHuM,YAAAA,OAAK,GAAGnK,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAjB,EAAoB8B,QAApB,KAAiCoC,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAC,GAAG,CAArB,EAAwB8B,QAAxB,EAAzC;AACH;;AACDkN,UAAAA,QAAQ,CAACzO,MAAT,CAAgB,MAAhB,EACKpB,IADL,CACU,GADV,EACeqN,OAAO,CAACxM,GAAD,CADtB,EAEKb,IAFL,CAEU,GAFV,EAEeX,UAAU,CAACwB,GAAD,CAAV,CAAcqO,OAAd,CAFf,EAGKlP,IAHL,CAGU,QAHV,EAGoBoJ,OAHpB,EAIKpJ,IAJL,CAIU,OAJV,EAImB,EAJnB,EAKKA,IALL,CAKU,MALV,EAKkBwD,KAAK,CAACuB,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAjB,CAAD,CALvB,EAMKb,IANL,CAMU,QANV,EAMoBwD,KAAK,CAACuB,aAAa,CAACpE,IAAD,CAAb,CAAiBE,GAAjB,CAAD,CANzB,EAOKb,IAPL,CAOU,OAPV,EAOmB,SAASqO,YAAY,CAAC1N,IAAD,CAAZ,CAAgBE,GAAhB,CAP5B;AASAxB,UAAAA,UAAU,CAACwB,GAAD,CAAV,CAAcqO,OAAd,IAAuB7P,UAAU,CAACwB,GAAD,CAAV,CAAcqO,OAAd,IAAuB9F,OAA9C,CAhB8C,CAiB9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA0G,UAAAA,MAAM,GAAGzQ,UAAU,CAACwB,GAAD,CAAV,CAAcqO,OAAd,CAAT;AACH;AACJ;AAEJ,KAlhDI;AAmhDLa,IAAAA,oBAnhDK,gCAmhDgBzM,YAnhDhB,EAmhD8B/F,IAnhD9B,EAmhDoC4L,OAnhDpC,EAmhD6C;AAC9C;AACA,UAAM7C,KAAK,GAAG,GAAd;AACA,UAAMC,MAAM,GAAG,GAAf;;AACA,UAAM1G,KAAK,GAAG,IAAd;;AACA,UAAMuN,WAAW,GAAG7P,IAAI,CAACqD,MAAzB;AACA,UAAMM,GAAG,GAAG7D,EAAE,CAAC8D,MAAH,CAAU,mBAAV,EAA+BC,MAA/B,CAAsC,GAAtC,EACPpB,IADO,CACF,OADE,EACO,KADP,EAEPA,IAFO,CAEF,OAFE,EAEO,GAFP,EAGPA,IAHO,CAGF,QAHE,EAGQ,GAHR,EAIPA,IAJO,CAIF,WAJE,EAIW,mBAAmBmJ,OAAO,GAAG,EAA7B,IAAmC,GAJ9C,CAAZ;AAMA,UAAI6G,QAAQ,GAAG,IAAIrR,KAAJ,EAAf;;AACA,WAAK,IAAIgC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AACzBqP,QAAAA,QAAQ,CAACrP,CAAD,CAAR,GAAc,IAAIhC,KAAJ,EAAd;;AACA,aAAK,IAAIkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyC,YAApB,EAAkCzC,CAAC,EAAnC,EAAuC;AACnCmP,UAAAA,QAAQ,CAACrP,CAAD,CAAR,CAAYE,CAAZ,IAAiB,CAAjB;AACH;AACJ;;AAED,UAAIoP,SAAS,GAAG,EAAhB;;AACA,WAAK,IAAIpP,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGyC,YAApB,EAAkCzC,GAAC,EAAnC,EAAuC;AACnCoP,QAAAA,SAAS,CAACrN,IAAV,CAAe,UAAU/B,GAAzB;AACH;;AAED,WAAK,IAAIF,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGpD,IAAI,CAACqD,MAAzB,EAAiCD,IAAC,EAAlC,EAAsC;AAAE;AACpC,aAAK,IAAIE,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGtD,IAAI,CAACoD,IAAD,CAAJ,CAAQC,MAA5B,EAAoCC,GAAC,EAArC,EAAyC;AACrC,cAAIA,GAAC,IAAI,EAAT,EAAa;AACT;AACH;;AACD,cAAIW,KAAK,GAAGjE,IAAI,CAACoD,IAAD,CAAJ,CAAQE,GAAR,EAAW,CAAX,CAAZ;AACAmP,UAAAA,QAAQ,CAACnP,GAAD,CAAR,CAAYW,KAAZ,KAAsB,CAAtB;AACH;AACJ;;AAED,UAAI0O,QAAQ,GAAG,EAAf;;AACA,WAAK,IAAIvP,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAG,EAApB,EAAwBA,IAAC,EAAzB,EAA6B;AACzB,YAAIwP,IAAI,GAAG,IAAIxR,KAAJ,EAAX;AACAwR,QAAAA,IAAI,CAAC,OAAD,CAAJ,GAAgBxP,IAAC,GAAG,CAApB;;AACA,aAAK,IAAIE,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGyC,YAApB,EAAkCzC,IAAC,EAAnC,EAAuC;AACnCsP,UAAAA,IAAI,CAAC,UAAUtP,IAAX,CAAJ,GAAoBmP,QAAQ,CAACrP,IAAD,CAAR,CAAYE,IAAZ,CAApB;AACH;;AACDqP,QAAAA,QAAQ,CAACtN,IAAT,CAAcuN,IAAd;AACH;;AAED5S,MAAAA,IAAI,GAAG2S,QAAP;AAEA,UAAIE,MAAM,GAAG/S,EAAE,CAACwE,GAAH,CAAOtE,IAAP,EAAa,UAAU0I,CAAV,EAAa;AAAE,eAAQA,CAAC,CAACoK,KAAV;AAAkB,OAA9C,EAAgDvN,IAAhD,EAAb,CA/C8C,CAiD9C;;AACA,UAAIkD,CAAC,GAAG3I,EAAE,CAACiT,SAAH,GACH5M,MADG,CACI0M,MADJ,EAEHzM,KAFG,CAEG,CAAC,EAAD,EAAK2C,KAAL,CAFH,EAGHiK,OAHG,CAGK,CAAC,GAAD,CAHL,CAAR;AAIArP,MAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EACKpB,IADL,CACU,WADV,EACuB,iBAAiBuG,MAAjB,GAA0B,GADjD,EAEKiK,IAFL,CAEUnT,EAAE,CAACoT,UAAH,CAAczK,CAAd,EAAiB0K,aAAjB,CAA+B,CAA/B,CAFV,EAtD8C,CA0D9C;;AACA,UAAIxK,CAAC,GAAG7I,EAAE,CAACiQ,WAAH,GACH5J,MADG,CACI,CAAC,CAAD,EAAI0J,WAAJ,CADJ,EAEHzJ,KAFG,CAEG,CAAC4C,MAAD,EAAS,EAAT,CAFH,CAAR;AAGArF,MAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EACKoP,IADL,CACUnT,EAAE,CAACsT,QAAH,CAAYzK,CAAZ,CADV,EAEKlG,IAFL,CAEU,WAFV,EAEuB,kBAFvB,EA9D8C,CAkE9C;;AACA,UAAIwD,KAAK,GAAGnG,EAAE,CAACoG,YAAH,GACPC,MADO,CACAuM,SADA,EAEPtM,KAFO,CAEDtG,EAAE,CAACuT,eAFF,CAAZ,CAnE8C,CAuE9C;;AACA,UAAIzH,OAAO,IAAI,CAAf,EAAkB;AACd,aAAK,IAAIvF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqM,SAAS,CAACrP,MAA9B,EAAsCgD,CAAC,EAAvC,EAA2C;AACvC1C,UAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,KAAK4D,CAAC,GAAG,EADxB,EAEK5D,IAFL,CAEU,GAFV,EAEe,CAFf,EAGKA,IAHL,CAGU,MAHV,EAGkBwD,KAAK,CAACyM,SAAS,CAACrM,CAAD,CAAV,CAHvB,EAIK5D,IAJL,CAIU,OAJV,EAImB,EAJnB,EAKKA,IALL,CAKU,QALV,EAKoB,EALpB;AAOAkB,UAAAA,GAAG,CAACE,MAAJ,CAAW,MAAX,EACKpB,IADL,CACU,GADV,EACe,KAAK4D,CAAC,GAAG,EAAT,GAAc,EAD7B,EAEK5D,IAFL,CAEU,GAFV,EAEe,EAFf,EAGKA,IAHL,CAGU,WAHV,EAGuB,CAHvB,EAIKoD,IAJL,CAIU6M,SAAS,CAACrM,CAAD,CAJnB;AAKH;AACJ,OAvF6C,CAyF9C;;;AACA,UAAIiN,WAAW,GAAGxT,EAAE,CAACyT,KAAH,GACbhO,IADa,CACRmN,SADQ,EACG1S,IADH,CAAlB,CA1F8C,CA6F9C;;AAEA2D,MAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EACK2P,SADL,CACe,GADf,EAEI;AAFJ,OAGKxT,IAHL,CAGUsT,WAHV,EAIKG,IAJL,CAIU,GAJV,EAKKhR,IALL,CAKU,MALV,EAKkB,UAAAiG,CAAC;AAAA,eAAIzC,KAAK,CAACyC,CAAC,CAACvE,GAAH,CAAT;AAAA,OALnB,EAMK1B,IANL,CAMU,OANV,EAMmB,UAAAiG,CAAC;AAAA,eAAI,YAAYA,CAAC,CAACvE,GAAlB;AAAA,OANpB,EAM2C;AAN3C,OAOKqP,SAPL,CAOe,MAPf,EAQI;AARJ,OASKxT,IATL,CASU,UAAA0I,CAAC;AAAA,eAAIA,CAAJ;AAAA,OATX,EAUK+K,IAVL,CAUU,MAVV,EAWKhR,IAXL,CAWU,GAXV,EAWe,UAAAiG,CAAC;AAAA,eAAID,CAAC,CAACC,CAAC,CAAC1I,IAAF,CAAO8S,KAAR,CAAL;AAAA,OAXhB,EAYKrQ,IAZL,CAYU,GAZV,EAYe,UAAAiG,CAAC;AAAA,eAAIC,CAAC,CAACD,CAAC,CAAC,CAAD,CAAF,CAAL;AAAA,OAZhB,EAaKjG,IAbL,CAaU,QAbV,EAaoB,UAAAiG,CAAC;AAAA,eAAIC,CAAC,CAACD,CAAC,CAAC,CAAD,CAAF,CAAD,GAAUC,CAAC,CAACD,CAAC,CAAC,CAAD,CAAF,CAAf;AAAA,OAbrB,EAcKjG,IAdL,CAcU,OAdV,EAcmBgG,CAAC,CAACiL,SAAF,EAdnB,EAeKjR,IAfL,CAeU,QAfV,EAeoB,SAfpB,EAgBKmD,EAhBL,CAgBQ,WAhBR,EAgBqB,UAAU+N,KAAV,EAAiBjL,CAAjB,EAAoB;AAAE;AACnC;AACA,YAAMkL,YAAY,GAAG9T,EAAE,CAAC8D,MAAH,CAAU,KAAKiQ,UAAf,EAA2BxI,KAA3B,GAAmClH,GAAxD,CAFiC,CAGjC;;AACArE,QAAAA,EAAE,CAAC0T,SAAH,CAAa,SAAb,EAAwB/O,KAAxB,CAA8B,SAA9B,EAAyC,GAAzC,EAJiC,CAKjC;;AACA3E,QAAAA,EAAE,CAAC0T,SAAH,CAAa,MAAMI,YAAnB,EAAiCnP,KAAjC,CAAuC,SAAvC,EAAkD,CAAlD;AACH,OAvBL,EAwBKmB,EAxBL,CAwBQ,YAxBR,EAwBsB,UAAU+N,KAAV,EAAiBjL,CAAjB,EAAoB;AAAE;AACpC5I,QAAAA,EAAE,CAAC0T,SAAH,CAAa,SAAb,EACK/O,KADL,CACW,SADX,EACsB,CADtB;AAEH,OA3BL;AA4BH;AA9oDI;AAlIE,CAAf","sourcesContent":["import dataService from '../../service/dataService.js'\nimport pipeService from '../../service/pipeService.js';\nimport * as d3 from 'd3'\nimport $, { data } from 'jquery'\nimport * as Sankey from '../../assets/sankey.js'\nimport { sliderBottom, sliderLeft } from 'd3-simple-slider'\nimport { formatPrefix, path, schemeGnBu, symbolDiamond2 } from 'd3'\n\nexport default {\n    name: 'EventprogressionView',\n    components: {\n    },\n    props: {\n    },\n    computed: {\n    },\n    data() {\n        return {\n            color_back: \"#e9ecef\", //sankey曲线的颜色\n            color_back_individual: \"#C3C3C9\", //高亮曲线的颜色\n            opacity_back: 0.6,\n            line_color: '#003049',\n            sankey_linecolor: '#d3d3d3',\n            background_color: 'white',\n            hover_color: '#C3C3C9',\n            pattern_data: new Array(),\n            segment_data: new Array(),\n            start_flag: 0,\n            better_color: '#ADC2BC',\n            worse_color: '#f5cac3',\n            angle_color: '#e5e9f2', //四个角的颜色\n            color_list: [\"#768f89\", \"#adb49f\", \"#EFE8BD\", \"#e9d1b4\", \"#ddbcab\", \"#d2aaa3\"],\n            // color_list: [\"#B6B6C6\", \"#ADB9C1\", \"#AFB5A4\", \"#EFE8BD\", \"#e9d1b4\", \"#d2aaa3\"],\n            // color_list: [\"#f4f1de\", \"#eab69f\", \"#e07a5f\", \"#3d405b\", \"#81b29a\", \"#f2cc8f\"],\n            // color_list: [\"#264653\", \"#2a9d8f\", \"#e9c46a\", \"#f4a261\", \"#e76f51\", \"#E3C6A9\"],\n            // color_list: [\"#B5B5C5\", \"#E2C9B3\", \"#ECC0C0\", \"#CAD5C3\", \"#9CB8CD\", \"#E3C6A9\"],\n            all_nodes: [],\n            divide_line: '#d0b8ac',\n            overall: 0, // 0表示默认选择查看全局better, 1表示全局worse，-1表示目前在展示align的sankey\n            y_position: {},\n            y_position_binary: {},\n            transition_map: [],\n            extracted_sequence: [], //存储包含该clickpath的序列\n            width_bar: 15,\n            y_scale_h: 0,\n            clickpath: ''\n        }\n    },\n    watch: {\n        start_flag: function () {\n            const _this = this\n            if (_this.start_flag == 2) {\n                _this.draweventprogressionSankey(_this.segment_data[0], _this.segment_data[2][0], _this.pattern_data)\n                _this.start_flag = 0\n            }\n        },\n        overall: function () {\n            const _this = this\n            $('.progressionoverview').remove()\n            $('.overall-better').attr(\"fill\", _this.background_color)\n            $('.overall-worse').attr(\"fill\", _this.background_color)\n            if (_this.overall == 0 || _this.overall == 1) {\n                pipeService.emitPatternNone(\"none\")\n            }\n            if (_this.overall == 0) {\n                $('.clickpathtransition').remove()\n                $('.overall-better').attr(\"fill\", _this.better_color)\n                _this.draweventprogressionSankey(_this.segment_data[0], _this.segment_data[2][0], _this.pattern_data)\n            }\n            if (_this.overall == 1) {\n                $('.clickpathtransition').remove()\n                $('.overall-worse').attr(\"fill\", _this.worse_color)\n                _this.draweventprogressionSankey(_this.segment_data[0], _this.segment_data[2][1], _this.pattern_data)\n            }\n        }\n    },\n    mounted: function () {\n        const _this = this\n        _this.drawLegendSelect()\n        pipeService.onPattern(function (pattern_data) {\n            //console.log('******onPattern******', pattern_data)\n            _this.pattern_data[0] = _this.dicMap(pattern_data[0])\n            _this.pattern_data[1] = _this.listMap(pattern_data[1])\n            _this.start_flag = _this.start_flag + 1\n        })\n        pipeService.onSegment(function (data) {\n            console.log('******onSegment******', data)\n            // ********map*******\n            for (let t = 0; t < 2; t++) {\n                for (let i = 0; i < data[1][t].length; i++) {\n                    for (let j = 0; j < data[1][t][i].length; j++) {\n                        data[1][t][i][j][3] = _this.stageMap(data[1][t][i][j][3])\n                    }\n                }\n            }\n            for (let t = 0; t < 2; t++) {\n                for (let i = 0; i < data[2][t].length; i++) {\n                    for (let j = 0; j < data[2][t][i].length; j++) {\n                        for (let p = 0; p < data[2][t][i][j].length; p++) {\n                            data[2][t][i][j][p][0] = _this.stageMap(data[2][t][i][j][p][0])\n                        }\n                    }\n                }\n            }\n            _this.segment_data = data\n            _this.start_flag = _this.start_flag + 1\n        })\n\n        pipeService.onClickPath(function (data) {\n            _this.overall = -1\n            if (data[1] != -1) {\n                _this.transition_map = data[1]\n                $(\".clickpathtransition\").remove()\n                _this.clickpath = data[0]\n                _this.drawKeyPath(_this.segment_data[0], _this.segment_data[2], _this.pattern_data, data[0], data[1])\n            }\n        })\n\n        // pipeService.onStage(function (msg) {\n        //     var data = msg[2]\n        //     var active_k_msg = msg[0]\n        //     var passive_k_msg = msg[1]\n        //     data = eval(\"(\" + data + \")\")\n        //     _this.drawStage(active_k_msg, passive_k_msg, data)\n        // })\n\n        const svg = d3.select(\".eventprogressionviewbody\")\n            .append(\"svg\")\n            .attr(\"width\", 880)\n            .attr(\"height\", 450)\n            .attr(\"class\", \"eventprogression\")\n\n        const svg_bound = svg.append('g')\n            .attr(\"width\", 880)\n            .attr(\"height\", 450)\n            .attr(\"transform\", \"translate(0, -30)\")\n\n    },\n    methods: {\n        number2literalMap(stage){\n            if (stage == 0) {\n                return 'a'\n            }\n            if (stage == 1) {\n                return 'b'\n            }\n            if (stage == 2) {\n                return 'c'\n            }\n            if (stage == 3) {\n                return 'd'\n            }\n            if (stage == 4) {\n                return 'e'\n            } \n            if (stage == 5) {\n                return 'f'\n            }\n        },\n        drawStageCopy(key) {\n            const _this = this\n            const key_list = key.split(\"\").map(Number); // 将字符串拆分为字符数组，然后将每个字符转换为数字\n            console.log(key_list)\n            d3.select('.stagecopysvg').remove()\n            const targetSVG = d3.select('.eventprogression')\n                .append('g')\n                .attr(\"width\", 250)\n                .attr(\"height\", 200)\n                .attr(\"class\", \"stagecopysvg\")\n                .style('z-index', 3)\n                .attr('transform', 'translate(620, 280)')\n\n            targetSVG.append('rect')\n                .attr('x', 0)\n                .attr('y', 0)\n                .attr('width', 260)\n                .attr('height', 147)\n                .attr('fill', 'white')\n                .attr('stroke', _this.sankey_linecolor)\n\n            for (let i = 0; i < key.length; i++) {\n                let sourceG1 = d3.select('.stage_single' + key_list[i])\n                let sourceG2 = d3.select('.stage_interaction' + key_list[i])\n                // 将目标SVG元素的大小设置为与源<g>元素相同\n                targetSVG.attr(\"width\", sourceG1.attr(\"width\"))\n                    .attr(\"height\", sourceG1.attr(\"height\"))\n\n                // 在目标SVG元素中创建一个新的<g>元素\n                let targetG1 = targetSVG.append(\"g\");\n                let targetG2 = targetSVG.append(\"g\");\n\n                targetG1.html(sourceG1.html())\n                    .attr(\"transform\", function () {\n                        if (key.length == 3) {\n                            return \"scale(0.6) translate(\" + (20 + i * 130) + \", 0)\"\n                        } else if (key.length == 2) {\n                            return \"scale(0.6) translate(\" + (60 + i * 170) + \", 0)\"\n                        } else {\n                            return \"scale(0.6) translate(140, 0)\"\n                        }\n                    })\n\n                targetG2.html(sourceG2.html())\n                    .attr(\"transform\", function () {\n                        if (key.length == 3) {\n                            return \"scale(0.6) translate(\" + (20 + i * 130) + \", 0)\"\n                        } else if (key.length == 2) {\n                            return \"scale(0.6) translate(\" + (60 + i * 170) + \", 0)\"\n                        } else {\n                            return \"scale(0.6) translate(140, 0)\"\n                        }\n                    })\n            }\n        },\n        listMap(lst) {\n            const _this = this\n            let result = []\n            for (let i = 0; i < lst.length; i++) {\n                let temp_t = lst[i]\n                let temp_n = ''\n                for (let j = 0; j < temp_t.length; j++) {\n                    temp_n += _this.stageMap(parseInt(temp_t[j])).toString()\n                }\n                result.push(temp_n)\n            }\n            return result\n        },\n        dicMap(dic) {\n            const _this = this\n            let keys = Object.keys(dic)\n            const result = {}\n            for (let i = 0; i < keys.length; i++) {\n                let k_t = keys[i]\n                let k_n = ''\n                for (let j = 0; j < k_t.length; j++) {\n                    k_n += _this.stageMap(parseInt(k_t[j])).toString()\n                }\n                result[k_n] = dic[k_t]\n            }\n            return result\n        },\n        stageMap(stage) {\n            if (stage == 0) {\n                return 2\n            }\n            if (stage == 1) {\n                return 4\n            }\n            if (stage == 2) {\n                return 0\n            }\n            if (stage == 3) {\n                return 1\n            }\n            if (stage == 4) {\n                return 3\n            }\n            if (stage == 5) {\n                return 5\n            }\n        },\n        drawLegendSelect() {\n            const _this = this\n            const svg = d3.select(\".progressionviewheader\")\n                .append(\"svg\")\n                .attr(\"width\", 750)\n                .attr(\"height\", 20)\n\n            let g_legend = svg.append('g')\n\n            g_legend.append(\"rect\")\n                .attr(\"x\", 20)\n                .attr(\"y\", 3)\n                .attr(\"width\", 10)\n                .attr(\"height\", 10)\n                .attr(\"fill\", _this.better_color)\n                .attr(\"stroke\", \"black\")\n                .on(\"click\", function () {\n                    _this.overall = 0\n                })\n                .attr(\"class\", \"overall-better\")\n\n            g_legend.append(\"text\")\n                .attr(\"x\", 35)\n                .attr(\"y\", 13)\n                .attr(\"font-size\", 13)\n                .text(\"group1\")\n\n            g_legend.append(\"rect\")\n                .attr(\"x\", 82)\n                .attr(\"y\", 3)\n                .attr(\"width\", 10)\n                .attr(\"height\", 10)\n                .attr(\"fill\", _this.background_color)\n                .attr(\"stroke\", \"black\")\n                .on(\"click\", function () {\n                    _this.overall = 1\n                })\n                .attr(\"class\", \"overall-worse\")\n\n            g_legend.append(\"text\")\n                .attr(\"x\", 97)\n                .attr(\"y\", 13)\n                .attr(\"font-size\", 13)\n                .text(\"group2\")\n            \n            g_legend.append(\"circle\")\n                .attr(\"cx\", 741)\n                .attr(\"cy\", 7)\n                .attr(\"r\", 5)\n                .attr(\"fill\", \"white\")\n                .attr(\"stroke\", \"red\")\n            \n            g_legend.append(\"text\")\n                .attr(\"x\", 738)\n                .attr(\"y\", 10)\n                .attr(\"font-size\", 8)\n                .text(\"?\")\n                .attr(\"fill\", \"#bc4b51\")\n        },\n        drawLegend(stage_number) {\n            const _this = this\n            const svg = d3.select(\".progressionviewheader\")\n                .append(\"svg\")\n                .attr(\"width\", 600)\n                .attr(\"height\", 20)\n\n            const domain_x = []\n            for (let i = 0; i < stage_number; i++) {\n                domain_x.push(i)\n            }\n\n            const color = d3.scaleOrdinal()\n                .domain(domain_x)\n                .range(_this.color_list)\n\n            let g_legend = svg.append('g')\n            for (let c = 0; c < stage_number; c++) {\n                svg.append(\"circle\")\n                    .attr(\"cx\", 22 + c * 80)\n                    .attr(\"cy\", 10)\n                    .attr(\"r\", 7)\n                    .attr(\"fill\", color(c))\n                    .attr(\"stroke\", \"#5b5b5b\")\n\n                svg.append(\"text\")\n                    .attr(\"x\", 35 + c * 80)\n                    .attr(\"y\", 14)\n                    .attr(\"font-size\", 13)\n                    .text(\"stage \" + (c + 1))\n            }\n        },\n        splitString(S, P) {\n            let result = [];\n\n            while (S.length > 0) {\n                let segment = '';\n                for (let i = 0; i < P.length; i++) {\n                    if (S.startsWith(P[i])) {\n                        if (P[i].length > segment.length) {\n                            segment = P[i];\n                        }\n                    }\n                }\n\n                if (segment === '') {\n                    // 如果找不到匹配的pattern，说明无法分解字符串\n                    return null;\n                }\n\n                result.push(segment);\n                S = S.slice(segment.length);\n            }\n\n            return result;\n        },\n        judgeSubString(parentString, subString) {\n            let flag = 0\n            for (let i = 0; i < parentString.length; i++) {\n                if (parentString[i] == subString[0]) {\n                    let flag_temp = 1\n                    for (let j = 0; j < subString.length; j++) {\n                        if (parentString[i + j] != subString[j]) {\n                            flag_temp = 0\n                            break\n                        }\n                    }\n                    flag = flag_temp\n                    if (flag == 1) {\n                        return true\n                    }\n                }\n            }\n            return false\n        },\n        findSubstringPositions(str, substr) {\n            const positions = [];\n            let pos = str.indexOf(substr);\n            while (pos !== -1) {\n                positions.push(pos);\n                pos = str.indexOf(substr, pos + 1);\n            }\n            return positions;\n        },\n        drawKeyPath(stage_number, segment_data, pattern_data, clickpath, path_data) {\n            const _this = this\n            const svg = d3.select(\".eventprogression\").append(\"g\")\n                .attr(\"class\", \"svg\")\n                .attr(\"width\", 800)\n                .attr(\"height\", 450)\n                .attr(\"class\", \"clickpathtransition\")\n                .attr(\"transform\", \"translate(0, 0)\")\n\n            // 首先在序列数据中extarct出所有包含clickpath的路径\n            const data_sequence = []\n            const data_string = []\n            for (let i = 0; i < segment_data[0].length; i++) {\n                let temp_individual = []\n                let temp_string = ''\n                for (let j = 0; j < segment_data[0][i].length; j++) {\n                    temp_individual.push(parseInt(segment_data[0][i][j][0]))\n                    temp_string = temp_string + segment_data[0][i][j][0]\n                }\n                data_sequence.push(temp_individual)\n                data_string.push(temp_string)\n            }\n            for (let i = 0; i < segment_data[1].length; i++) {\n                let temp_individual = []\n                let temp_string = ''\n                for (let j = 0; j < segment_data[1][i].length; j++) {\n                    temp_individual.push(parseInt(segment_data[1][i][j][0]))\n                    temp_string = temp_string + segment_data[1][i][j][0]\n                }\n                data_sequence.push(temp_individual)\n                data_string.push(temp_string)\n            }\n            // extract出所有包括该子序列的序列\n            const data_extracted = []\n            for (let i = 0; i < data_string.length; i++) {\n                if (_this.judgeSubString(data_string[i], clickpath)) {\n                    data_extracted.push(data_string[i])\n                }\n            }\n            const path_latter = []\n            const path_former = []\n            const extracted_sequence = []\n            for (let i = 0; i < data_extracted.length; i++) {\n                // 首先要找到clickpath出现的位置\n                let positions = _this.findSubstringPositions(data_extracted[i], clickpath)\n                for (let j = 0; j < positions.length; j++) {\n                    if (positions[j] == 0 || positions[j] + clickpath.length == data_extracted[i].length) {\n                        continue\n                    } else {\n                        // 然后把clickpath前后路径分解掉\n                        let f_temp = data_extracted[i].substring(0, positions[j])\n                        let l_temp = data_extracted[i].substring(positions[j] + clickpath.length, data_extracted[i].length)\n                        let f_temp_segment = _this.splitString(f_temp, pattern_data[1])\n                        let l_temp_segment = _this.splitString(l_temp, pattern_data[1])\n                        path_former.push(f_temp_segment)\n                        path_latter.push(l_temp_segment)\n                        extracted_sequence.push([_this.splitString(f_temp, pattern_data[1]), _this.splitString(l_temp, pattern_data[1])])\n                    }\n                }\n            }\n\n            const tree_former = _this.createTreeFromSequences(path_former)\n            const tree_latter = _this.createTreeFromSequences(path_latter)\n            const domain_x = []\n            for (let i = 0; i < stage_number; i++) {\n                domain_x.push(i)\n            }\n\n            const color = d3.scaleOrdinal()\n                .domain(domain_x)\n                .range(_this.color_list)\n\n            const lineGenerator = d3.line()\n                .x(function (d) { return d.x; })\n                .y(function (d) { return d.y; })\n                .curve(d3.curveCatmullRom.alpha(0.5))\n\n            // 画中间\n            const width = 840\n            const height = 250 * 1.3\n            const width_bar = 15\n            let frequency_center = path_former.length\n            const y_scale_h = height / frequency_center\n            _this.y_scale_h = y_scale_h\n            let svg_center = svg.append('g').attr('class', 'center')\n            svg_center.append(\"rect\")\n                .attr(\"x\", width / 2 - 5)\n                .attr(\"y\", 20)\n                .attr(\"width\", width_bar * 2 + 10)\n                .attr(\"height\", height + 10)\n                .attr(\"fill\", \"none\")\n                .attr(\"stroke\", _this.color_back)\n                .attr(\"opacity\", _this.opacity_back)\n\n            let y_start_bar = 25\n\n            for (let i = 0; i < clickpath.length; i++) {\n                let x_start_temp = width / 2 + i * width_bar * 2 / clickpath.length\n                if (clickpath.length == 1) {\n                    x_start_temp = width / 2 + i * width_bar + 7\n                }\n                svg_center.append('rect')\n                    .attr('x', x_start_temp)\n                    .attr('y', y_start_bar)\n                    .attr('width', function () {\n                        if (clickpath.length < 2) {\n                            return width_bar\n                        } else {\n                            return 2 / clickpath.length * width_bar\n                        }\n                    })\n                    .attr('height', y_scale_h * frequency_center)\n                    .attr('fill', color(parseInt(clickpath[i])))\n                    .attr('stroke', 'white')\n                    .attr('class', 'center-key')\n                    .on('mouseenter', function () {\n                        $('.center-key').attr('stroke', _this.hover_color).attr('stroke-width', 3)\n                        $('.center-hover').attr('visibility', 'visable')\n                        //console.log('Test1-drawStageCopy', clickpath)\n                        _this.drawStageCopy(clickpath)\n                    })\n                    .on('mouseleave', function () {\n                        $('.center-key').attr('stroke', 'white').attr('stroke-width', 0.5)\n                        $('.center-hover').attr('visibility', 'hidden')\n                        d3.select('.stagecopysvg').remove()\n                    })\n            }\n\n            // 画中心hover图标\n            let svg_center_hover = svg_center.append('g').attr(\"class\", \"center-hover\").attr('visibility', 'hidden')\n            svg_center_hover.append('rect')\n                .attr('x', width / 2 - width_bar * 3)\n                .attr('y', height / 2)\n                .attr('width', 120)\n                .attr('height', 30)\n                .attr('fill', 'white')\n                .attr('stroke', '#d3d3d3')\n                .attr('stroke-width', 0.5)\n\n            let degree = _this.pattern_data[0][clickpath]\n\n            svg_center_hover.append(\"rect\")\n                .attr(\"x\", width / 2)\n                .attr(\"y\", height / 2 + 5)\n                .attr(\"width\", 32)\n                .attr(\"height\", 20)\n                .attr(\"stroke\", function () {\n                    if (degree[0] > degree[1]) {\n                        return _this.better_color\n                    } else {\n                        return _this.worse_color\n                    }\n                })\n                .attr(\"fill\", \"none\")\n\n            svg_center_hover.append(\"text\")\n                .attr(\"x\", width / 2 + 1)\n                .attr(\"y\", height / 2 + 20)\n                .attr(\"font-size\", 15)\n                .text(function () {\n                    return Math.abs((degree[0] - degree[1]) * 100).toFixed(1)\n                })\n                .attr(\"fill\", function () {\n                    if (degree[0] > degree[1]) {\n                        return _this.better_color\n                    } else {\n                        return _this.worse_color\n                    }\n                })\n\n            let path_transition_former = _this.transition_map[clickpath][0]\n            let path_transition_latter = _this.transition_map[clickpath][1]\n\n            svg_center_hover.append(\"rect\")\n                .attr(\"x\", width / 2 - 38)\n                .attr(\"y\", height / 2 + 5)\n                .attr(\"width\", 32)\n                .attr(\"height\", 20 * path_transition_former[0])\n                .attr(\"stroke\", 'none')\n                .attr(\"fill\", _this.better_color)\n\n            svg_center_hover.append(\"rect\")\n                .attr(\"x\", width / 2 - 38)\n                .attr(\"y\", height / 2 + 5 + 20 * path_transition_former[0])\n                .attr(\"width\", 32)\n                .attr(\"height\", 20 * path_transition_former[1])\n                .attr(\"stroke\", 'none')\n                .attr(\"fill\", _this.worse_color)\n\n            svg_center_hover.append(\"rect\")\n                .attr(\"x\", width / 2 + 38)\n                .attr(\"y\", height / 2 + 5)\n                .attr(\"width\", 32)\n                .attr(\"height\", 20 * path_transition_latter[0])\n                .attr(\"stroke\", 'none')\n                .attr(\"fill\", _this.better_color)\n\n            svg_center_hover.append(\"rect\")\n                .attr(\"x\", width / 2 + 38)\n                .attr(\"y\", height / 2 + 5 + 20 * path_transition_latter[0])\n                .attr(\"width\", 32)\n                .attr(\"height\", 20 * path_transition_latter[1])\n                .attr(\"stroke\", 'none')\n                .attr(\"fill\", _this.worse_color)\n\n            // 画第i层路径，画出来并且返回每一个新状态的开始节点和结束节点\n            for (let i = 1; i < 5; i++) {\n                for (let j = 0; j < 2; j++) {\n                    let type = ''\n                    _this.all_nodes = []\n                    let x_start_temp = 0\n                    if (j == 1) {\n                        type = 'latter'\n                        _this.obtainSubPath(tree_latter, i)\n                        x_start_temp = width / 2 + i * width_bar * 6.8\n                    } else {\n                        type = 'former'\n                        _this.obtainSubPath(tree_former, i)\n                        x_start_temp = width / 2 - i * width_bar * 6.8\n                    }\n                    // j=0表示画latter，j=1表示画former\n                    let svg_temp = svg.append('g').attr('class', type + i)\n                    let path = _this.sortArray(_this.all_nodes, pattern_data)\n                    let t_sum = 0\n                    for (let tt = 0; tt < _this.all_nodes.length; tt++) {\n                        t_sum += _this.all_nodes[tt][1]\n                    }\n                    let y_start_temp = 25\n                    let path_temp = path_former\n                    if (type == 'latter') {\n                        path_temp = path_latter\n                    }\n                    _this.drawPath(path, svg_temp, x_start_temp, y_start_temp, stage_number, y_scale_h, color, width, width_bar, type + i, path_temp, extracted_sequence)\n                }\n            }\n            // 画每两层之间的link\n            for (let i = 0; i < path_former.length; i++) {\n                path_former[i].unshift(clickpath)\n            }\n            for (let i = 0; i < path_latter.length; i++) {\n                path_latter[i].unshift(clickpath)\n            }\n\n            _this.y_position_binary['latter' + 0 + '-better'] = [width / 2 - 5, y_start_bar]\n            _this.y_position_binary['former' + 0 + '-better'] = [width / 2 - 5, y_start_bar]\n            _this.y_position_binary['latter' + 0 + '-worse'] = [width / 2 - 5, y_start_bar]\n            _this.y_position_binary['former' + 0 + '-worse'] = [width / 2 - 5, y_start_bar]\n\n            for (let i = 0; i < 4; i++) {\n                let former_flow = _this.calculateFlow(path_former, i, pattern_data)\n                let latter_flow = _this.calculateFlow(path_latter, i, pattern_data)\n                // 先画latter\n                _this.drawLink('latter', latter_flow, svg, width_bar, i, y_scale_h, \"g\", 0)\n                _this.drawLink('former', former_flow, svg, width_bar, i, y_scale_h, \"g\", 0)\n            }\n\n        },\n        drawLink(type, flow, svg, width_bar, num, y_scale_h, flag, y_d) {\n            const _this = this\n            let source_x = 0\n            let source_x2 = 0\n            let t = 5\n            if (type == 'latter') {\n                source_x = _this.y_position_binary[type + num + '-better'][0] + 2 * width_bar + 10\n                source_x2 = _this.y_position_binary[type + (num + 1) + '-better'][0]\n            } else {\n                source_x = _this.y_position_binary[type + num + '-better'][0]\n                source_x2 = _this.y_position_binary[type + (num + 1) + '-better'][0] + 2 * width_bar + 10\n                t = -5\n            }\n            let source_y_better = _this.y_position_binary[type + num + '-better'][1]\n            let source_y_worse = _this.y_position_binary[type + num + '-worse'][1]\n            let source_y_better2 = _this.y_position_binary[type + (num + 1) + '-better'][1]\n            let source_y_worse2 = _this.y_position_binary[type + (num + 1) + '-worse'][1]\n            if (y_d < 0) {\n                source_y_better = -y_d\n                source_y_worse = -y_d\n            }\n            if (y_d > 0) {\n                source_y_better2 = y_d\n                source_y_worse2 = y_d\n            }\n            const lineGenerator = d3.line()\n                .x(function (d) { return d.x; })\n                .y(function (d) { return d.y; })\n                .curve(d3.curveCatmullRom.alpha(0.5))\n            for (let i = 0; i < 4; i++) {\n                flow[i] *= y_scale_h\n                let data_temp = []\n                if (i == 0) {\n                    data_temp = [\n                        { x: source_x, y: source_y_better },\n                        { x: source_x + t, y: source_y_better },\n                        { x: source_x2 - t, y: source_y_better2 },\n                        { x: source_x2, y: source_y_better2 },\n                    ]\n                    source_y_better += flow[i]\n                    source_y_better2 += flow[i]\n                } else if (i == 1) {\n                    data_temp = [\n                        { x: source_x, y: source_y_better },\n                        { x: source_x + t, y: source_y_better },\n                        { x: source_x2 - t, y: source_y_worse2 },\n                        { x: source_x2, y: source_y_worse2 },\n                    ]\n                    source_y_better += flow[i]\n                    source_y_worse2 += flow[i]\n                } else if (i == 2) {\n                    data_temp = [\n                        { x: source_x, y: source_y_worse },\n                        { x: source_x + t, y: source_y_worse },\n                        { x: source_x2 - t, y: source_y_better2 },\n                        { x: source_x2, y: source_y_better2 },\n                    ]\n                    source_y_better2 += flow[i]\n                    source_y_worse += flow[i]\n                } else {\n                    data_temp = [\n                        { x: source_x, y: source_y_worse },\n                        { x: source_x + t, y: source_y_worse },\n                        { x: source_x2 - t, y: source_y_worse2 },\n                        { x: source_x2, y: source_y_worse2 },\n                    ]\n                    source_y_worse2 += flow[i]\n                    source_y_worse += flow[i]\n                }\n\n                for (let k = 0; k < flow[i]; k++) {\n                    for (let p = 0; p < 4; p++) {\n                        data_temp[p].y += 1\n                    }\n                    svg.append(\"path\")\n                        .datum(data_temp)\n                        .attr(\"fill\", \"none\")\n                        .attr(\"stroke\", function () {\n                            if (flag == 'g') {\n                                return _this.color_back\n                            } else {\n                                return _this.color_back_individual\n                            }\n                        })\n                        .attr(\"stroke-width\", 1)\n                        .attr(\"opacity\", _this.opacity_back)\n                        .attr(\"d\", lineGenerator)\n                        .lower()\n                }\n            }\n        },\n        calculateFlow(path_sequence, n, pattern_data) {\n            // 通过sequence获得第n层到第n+1层的流量\n            let result = [0, 0, 0, 0] //好变好，好变坏，坏变好，坏变坏\n            for (let i = 0; i < path_sequence.length; i++) {\n                if (n > path_sequence[i].length - 2) {\n                    continue\n                }\n                let key1 = path_sequence[i][n]\n                let key2 = path_sequence[i][n + 1]\n                if (pattern_data[0][key1][0] > pattern_data[0][key1][1]) {\n                    //前面的路径是好\n                    if (pattern_data[0][key2][0] > pattern_data[0][key2][1]) {\n                        //后面的路径是好\n                        result[0] += 1\n                    } else {\n                        //后面的路径是坏\n                        result[1] += 1\n                    }\n                } else {\n                    if (pattern_data[0][key2][0] > pattern_data[0][key2][1]) {\n                        //后面的路径是好\n                        result[2] += 1\n                    } else {\n                        //后面的路径是坏\n                        result[3] += 1\n                    }\n                }\n            }\n            return result\n        },\n        drawPath(path, svg, x_start, y_start, stage_number, y_scale, color, width, width_bar, class_name, path_sequence, extracted_sequence) {\n            const _this = this\n            _this.y_position_binary[class_name + '-better'] = [x_start - 5, y_start]\n            let y_end = _this.drawSubPath(path[0], svg, x_start, y_start, stage_number, y_scale, color, width, width_bar, class_name, path_sequence, extracted_sequence)\n            //画好路径的背景\n            let svg_temp = svg.append('g').lower()\n            const color_stroke = _this.color_back\n\n            svg_temp.append(\"rect\")\n                .attr(\"x\", x_start - 5)\n                .attr(\"y\", y_start - 5)\n                .attr(\"width\", width_bar * 2 + 10)\n                .attr(\"height\", y_end - y_start + 10)\n                .attr(\"fill\", \"none\")\n                .attr(\"opacity\", _this.opacity_back)\n                .attr(\"stroke\", color_stroke)\n            //画分割线\n            y_end += 10\n            y_start = y_end\n            _this.y_position_binary[class_name + '-worse'] = [x_start - 10, y_start + 5]\n            svg_temp.append(\"line\")\n                .attr(\"x1\", x_start + 2 * width_bar + 10)\n                .attr(\"x2\", x_start - 10)\n                .attr(\"y1\", y_end)\n                .attr(\"y2\", y_end)\n                .attr(\"stroke-width\", 2)\n                .attr(\"stroke\", _this.divide_line)\n            y_end = _this.drawSubPath(path[1], svg, x_start, y_end + 10, stage_number, y_scale, color, width, width_bar, class_name, path_sequence, extracted_sequence)\n            // 画坏路径的背景\n            svg_temp.append(\"rect\")\n                .attr(\"x\", x_start - 5)\n                .attr(\"y\", y_start + 10)\n                .attr(\"width\", width_bar * 2 + 10)\n                .attr(\"height\", y_end - y_start - 5)\n                .attr(\"fill\", \"none\")\n                .attr(\"opacity\", _this.opacity_back)\n                .attr(\"stroke\", color_stroke)\n        },\n        obtainAllPath(num, key, path_sequence) {\n            let result = []\n            for (let i = 0; i < path_sequence.length; i++) {\n                if (path_sequence[i].length > num && path_sequence[i][num] == key) {\n                    for (let j = num + 1; j < path_sequence[i].length; j++) {\n                        result.push(path_sequence[i][j])\n                    }\n                }\n            }\n            return result\n        },\n        calculateRatio(sequence, key_degree_map) {\n            let result = [0, 0]\n            for (let i = 0; i < sequence.length; i++) {\n                let difference = key_degree_map[sequence[i]][0] - key_degree_map[sequence[i]][1]\n                if (difference > 0) {\n                    result[0] += difference\n                } else {\n                    result[1] += Math.abs(difference)\n                }\n            }\n            if (result[0] + result[1] == 0) {\n                return result\n            } else {\n                return [result[0] / (result[0] + result[1]), result[1] / (result[0] + result[1])]\n            }\n        },\n        drawSubPath(data, svg, x_start, y_start, stage_number, y_scale, color, width, width_bar, class_name, path_sequence, extracted_sequence) {\n            // data是由[路径，频率]组成的序列\n            const _this = this\n            let keys = Object.keys(data)\n            let svg_temp = svg.append('g').lower()\n            // 画hover之后会显示出来的negative/positive degree以及negative/positive change\n            let key_degree_map = _this.pattern_data[0]//存储了这个path的好坏频率'13':[0.4, 0.7]\n            let key_p = new Set()\n            for (let i = 0; i < stage_number; i++) {\n                for (let j = -1; j < stage_number; j++) {\n                    for (let ij = -1; ij < stage_number; ij++) {\n                        if (j == -1) {\n                            key_p.add(i.toString())\n                        } else {\n                            if (ij == -1) {\n                                key_p.add(i.toString() + j.toString())\n                            } else {\n                                key_p.add(i.toString() + j.toString() + ij.toString())\n                            }\n                        }\n                    }\n                }\n            }\n            for (let key of key_p) {\n                if (keys.includes(key)) {\n                    // 需要得到这一层开始以key为start的后续\n                    let sequences_temp = _this.obtainAllPath(parseInt(class_name[class_name.length - 1]) - 1, key, path_sequence)\n                    // 通过sequence得到路径的情况\n                    let path_transition_temp = _this.calculateRatio(sequences_temp, key_degree_map)\n                    let degree = key_degree_map[key]\n                    // 然后需要通过path_transition_temp和degree画图\n                    _this.y_position[class_name + '-' + key] = y_start\n                    let data_final_t = []\n                    for (let p = 0; p < extracted_sequence.length; p++) {\n                        if (class_name[0] == 'f') {\n                            if (extracted_sequence[p][0][parseInt(class_name[class_name.length - 1]) - 1] == key) {\n                                // 把序列再拼起来\n                                data_final_t.push(extracted_sequence[p])\n                            }\n                        }\n                        if (class_name[0] == 'l') {\n                            if (extracted_sequence[p][1][parseInt(class_name[class_name.length - 1]) - 1] == key) {\n                                data_final_t.push(extracted_sequence[p])\n                            }\n                        }\n                    }\n                    //console.log(\"**********data_final_t\",class_name, key, data_final_t.length, _this.calculateTemp2(data), extracted_sequence)\n                    let data_final = []\n                    for (let t = 0; t < data_final_t.length; t++) {\n                        let temp_p = []\n                        for (let q = 3; q >= 0; q--) {\n                            if (data_final_t[t][0].length > q) {\n                                if (_this.pattern_data[0][data_final_t[t][0][q]][0] > _this.pattern_data[0][data_final_t[t][0][q]][1]) {\n                                    temp_p.push(1)\n                                } else {\n                                    temp_p.push(-1)\n                                }\n                            } else {\n                                temp_p.push(0)\n                            }\n                        }\n                        if (_this.pattern_data[0][_this.clickpath][0] > _this.pattern_data[0][_this.clickpath][1]) {\n                            temp_p.push(1)\n                        } else {\n                            temp_p.push(-1)\n                        }\n                        for (let q = 0; q < 4; q++) {\n                            if (data_final_t[t][1].length > q) {\n                                if (_this.pattern_data[0][data_final_t[t][1][q]][0] > _this.pattern_data[0][data_final_t[t][1][q]][1]) {\n                                    temp_p.push(1)\n                                } else {\n                                    temp_p.push(-1)\n                                }\n                            } else {\n                                temp_p.push(0)\n                            }\n                        }\n                        data_final.push(temp_p)\n                    }\n                    for (let t = 0; t < key.length; t++) {\n                        svg_temp.append('rect')\n                            .attr('x', function () {\n                                if (key.length < 2) {\n                                    return x_start + t * 2 / key.length * width_bar\n                                } else {\n                                    return x_start + t * 2 / key.length * width_bar\n                                }\n                            })\n                            .attr('y', y_start)\n                            .attr('width', function () {\n                                if (key.length < 2) {\n                                    return width_bar\n                                } else {\n                                    return 2 / key.length * width_bar\n                                }\n                            })\n                            .attr('height', y_scale * data[key])\n                            .attr('fill', color(parseInt(key[t])))\n                            .attr('stroke', 'white')\n                            .attr('stroke-width', 0.05)\n                            .attr('class', class_name + key)\n                            .attr('id', y_start)\n                            .style('z-index', 2)\n                            .on('click', function () {\n                                pipeService.emitClickPath([key, -1])\n                            })\n                            .on('mouseenter', function () {\n                                $('.' + class_name + key).attr('stroke', _this.hover_color)\n                                    .attr('stroke-width', 1)\n                                $('.' + class_name + '.hover.' + key).attr('visibility', 'visable')\n                                //console.log('Test2-drawStageCopy', key)\n                                _this.drawStageCopy(key)\n                                // 画hover之后会显示的sankey\n                                // 先提取在这个位置上有key元素的sequence\n                                // 统计每个时间点之间的流向，result[0,0,0,0]好到好，好到坏，坏到好，坏到坏\n                                for (let p = 4; p < data_final[0].length - 1; p++) {\n                                    let temp_result = [0, 0, 0, 0]\n                                    for (let q = 0; q < data_final.length; q++) {\n                                        if (data_final[q][p] == 1) {\n                                            if (data_final[q][p + 1] == 1) {\n                                                temp_result[0] += 1\n                                            }\n                                            if (data_final[q][p + 1] == -1) {\n                                                temp_result[1] += 1\n                                            }\n                                        }\n                                        if (data_final[q][p] == -1) {\n                                            if (data_final[q][p + 1] == 1) {\n                                                temp_result[2] += 1\n                                            }\n                                            if (data_final[q][p + 1] == -1) {\n                                                temp_result[3] += 1\n                                            }\n                                        }\n                                    }\n                                    let y_start_i = 0\n                                    if (p - 3 == parseInt(class_name[6]) && class_name[0] == 'l') {\n                                        y_start_i = parseFloat($('.' + class_name + key).attr('id')) - 3\n                                    }\n                                    if (p - 4 == parseInt(class_name[6]) && class_name[0] == 'l') {\n                                        y_start_i = -parseFloat($('.' + class_name + key).attr('id')) - 3\n                                    }\n                                    _this.drawLink('latter', temp_result, svg_temp2, _this.width_bar, p - 4, _this.y_scale_h, \"i\", y_start_i)\n                                }\n                                for (let p = 4; p >= 1; p--) {\n                                    let temp_result = [0, 0, 0, 0]\n                                    for (let q = 0; q < data_final.length; q++) {\n                                        if (data_final[q][p] == 1) {\n                                            if (data_final[q][p - 1] == 1) {\n                                                temp_result[0] += 1\n                                            }\n                                            if (data_final[q][p - 1] == -1) {\n                                                temp_result[1] += 1\n                                            }\n                                        }\n                                        if (data_final[q][p] == -1) {\n                                            if (data_final[q][p - 1] == 1) {\n                                                temp_result[2] += 1\n                                            }\n                                            if (data_final[q][p - 1] == -1) {\n                                                temp_result[3] += 1\n                                            }\n                                        }\n                                    }\n                                    let y_start_i = 0\n                                    if (5 - p == parseInt(class_name[6]) && class_name[0] == 'f') {\n                                        y_start_i = parseFloat($('.' + class_name + key).attr('id')) - 3\n                                    }\n                                    if (4 - p == parseInt(class_name[6]) && class_name[0] == 'f') {\n                                        y_start_i = -parseFloat($('.' + class_name + key).attr('id')) - 3\n                                    }\n                                    _this.drawLink('former', temp_result, svg_temp2, _this.width_bar, 4 - p, _this.y_scale_h, \"i\", y_start_i)\n                                }\n                            })\n                            .on('mouseleave', function () {\n                                $('.' + class_name + key).attr('stroke', 'white')\n                                    .attr('stroke-width', 0.5)\n                                $('.' + class_name + '.hover.' + key).attr('visibility', 'hidden')\n                                d3.select('.stagecopysvg').remove()\n                            })\n                    }\n                    if (key.length < 2) {\n                        // 画空白部分的，比如当只出现一个的时候右边需要补足\n                        svg_temp.append('rect')\n                            .attr('x', x_start + width_bar)\n                            .attr('y', y_start)\n                            .attr('width', width_bar)\n                            .attr('height', y_scale * data[key])\n                            .attr('fill', 'white')\n                            .attr('stroke', '#d3d3d3')\n                            .attr('stroke-width', 0.5)\n                            .attr('class', class_name + key)\n                            .style('z-index', 2)\n                            .on('click', function () {\n                                pipeService.emitClickPath([key, -1])\n                            })\n                            .on('mouseenter', function () {\n                                $('.' + class_name + key).attr('stroke', _this.hover_color)\n                                    .attr('stroke-width', 1)\n                                $('.' + class_name + '.hover.' + key).attr('visibility', 'visable')\n                                //console.log('Test3-drawStageCopy', key)\n                                _this.drawStageCopy(key)\n                            })\n                            .on('mouseleave', function () {\n                                $('.' + class_name + key).attr('stroke', 'white')\n                                    .attr('stroke-width', 0.5)\n                                $('.' + class_name + '.hover.' + key).attr('visibility', 'hidden')\n                                d3.select('.stagecopysvg').remove()\n                            })\n                    }\n                    let svg_temp2 = svg.append('g').attr('class', class_name + ' hover ' + key).attr('visibility', 'hidden').attr(\"transform\", \"translate(0, 5)\")\n                    // 画hover之后会显示的path transition和positive/negative degree\n                    svg_temp2.append('rect')\n                        .attr('x', x_start)\n                        .attr('y', y_start + y_scale * data[key] / 2)\n                        .attr('width', 80)\n                        .attr('height', 30)\n                        .attr('fill', 'white')\n                        .attr('stroke', '#d3d3d3')\n                        .attr('stroke-width', 0.5)\n\n                    svg_temp2.append(\"rect\")\n                        .attr(\"x\", function () {\n                            if (class_name[0] == 'f') {\n                                return x_start + 42\n                            } else {\n                                return x_start + 5\n                            }\n                        })\n                        .attr(\"y\", y_start + y_scale * data[key] / 2 + 5)\n                        .attr(\"width\", 32)\n                        .attr(\"height\", 20)\n                        .attr(\"stroke\", function () {\n                            if (degree[0] > degree[1]) {\n                                return _this.better_color\n                            } else {\n                                return _this.worse_color\n                            }\n                        })\n                        .attr(\"fill\", \"none\")\n\n                    svg_temp2.append(\"text\")\n                        .attr(\"x\", function () {\n                            if (class_name[0] == 'f') {\n                                return x_start + 43\n                            } else {\n                                return x_start + 6\n                            }\n                        })\n                        .attr(\"y\", y_start + y_scale * data[key] / 2 + 20)\n                        .attr(\"font-size\", 15)\n                        .text(function () {\n                            return Math.abs((degree[0] - degree[1]) * 100).toFixed(1)\n                        })\n                        .attr(\"fill\", function () {\n                            if (degree[0] > degree[1]) {\n                                return _this.better_color\n                            } else {\n                                return _this.worse_color\n                            }\n                        })\n\n                    svg_temp2.append(\"rect\")\n                        .attr(\"x\", function () {\n                            if (class_name[0] == 'l') {\n                                return x_start + 42\n                            } else {\n                                return x_start + 5\n                            }\n                        })\n                        .attr(\"y\", y_start + y_scale * data[key] / 2 + 5)\n                        .attr(\"width\", 32)\n                        .attr(\"height\", 20 * path_transition_temp[0])\n                        .attr(\"stroke\", 'none')\n                        .attr(\"fill\", _this.better_color)\n\n                    svg_temp2.append(\"rect\")\n                        .attr(\"x\", function () {\n                            if (class_name[0] == 'l') {\n                                return x_start + 42\n                            } else {\n                                return x_start + 5\n                            }\n                        })\n                        .attr(\"y\", y_start + y_scale * data[key] / 2 + 5 + 20 * path_transition_temp[0])\n                        .attr(\"width\", 32)\n                        .attr(\"height\", 20 * path_transition_temp[1])\n                        .attr(\"stroke\", 'none')\n                        .attr(\"fill\", _this.worse_color)\n\n                    y_start += y_scale * data[key] + 0.3\n                }\n            }\n\n            return y_start\n        },\n        obtainSubPath(node, depth, currentDepth = 0) {\n            const _this = this\n            if (typeof node === \"object\") {\n                if (currentDepth === depth) {\n                    _this.all_nodes.push([node.value, node.count])\n                } else {\n                    const childNodes = Object.values(node);\n                    childNodes.forEach((childNode) => {\n                        if (typeof childNode === \"object\") {\n                            _this.obtainSubPath(childNode, depth, currentDepth + 1);\n                        }\n                    });\n                }\n            }\n        },\n        calculateTemp(arr) {\n            let sum = 0\n            for (let i = 0; i < arr.length; i++) {\n                sum += arr[i][1]\n            }\n            return sum\n        },\n        calculateTemp2(tree) {\n            let sum = 0\n            let keys = Object.keys(tree)\n            for (let i = 0; i < keys.length; i++) {\n                sum += tree[keys[i]]\n            }\n            return sum\n        },\n        sortArray(seq, pattern_data) {\n            const _this = this\n            let tree = {};\n            for (let i = 0; i < seq.length; i++) {\n                let item = seq[i];\n                if (Object.keys(tree).includes(item[0])) {\n                    tree[item[0]] += item[1];\n                } else {\n                    tree[item[0]] = item[1];\n                }\n            }\n            return _this.sortTree(tree, pattern_data)\n        },\n        sortTree(tree, pattern_data) {\n            // 好结点:[按照stage类别排序],坏节点:[按照stage类别排序]\n            const _this = this\n            let tree_keys = Object.keys(tree)\n            let better_list = {}\n            let worse_list = {}\n            for (let i = 0; i < tree_keys.length; i++) {\n                let key = tree_keys[i]\n                let number = tree[tree_keys[i]]\n                if (pattern_data[0][key][0] > pattern_data[0][key][1]) {\n                    better_list[key] = number\n                } else {\n                    worse_list[key] = number\n                }\n            }\n            return [better_list, worse_list]\n        },\n        draw_glyph(svg, pathpattern, pathtransition, color, flag) {\n            const _this = this\n            svg.append(\"rect\")\n                .attr(\"x\", 365)\n                .attr(\"y\", 400)\n                .attr(\"width\", 70)\n                .attr(\"height\", 20)\n                .attr(\"fill\", '#5b5b5b')\n                .attr(\"stroke\", '#5b5b5b')\n                .attr(\"opacity\", 0.1)\n\n            svg.append(\"rect\")\n                .attr(\"x\", 352)\n                .attr(\"y\", 395)\n                .attr(\"width\", 96)\n                .attr(\"height\", 30)\n                .attr(\"fill\", 'none')\n                .attr(\"stroke\", '#5b5b5b')\n                .attr(\"opacity\", 0.2)\n            for (let i = 0; i < pathpattern.length; i++) {\n                if (i < pathpattern.length - 1) {\n                    svg.append(\"line\")\n                        .attr(\"x1\", 384 + i * 30)\n                        .attr(\"x2\", 384 + (i + 1) * 30)\n                        .attr(\"y1\", 410)\n                        .attr(\"y2\", 410)\n                        .attr(\"stroke\", \"black\")\n                }\n                svg.append(\"circle\")\n                    .attr(\"cx\", 384 + i * 30)\n                    .attr(\"cy\", 410)\n                    .attr(\"r\", 7)\n                    .attr(\"fill\", color(parseInt(pathpattern[i])))\n                    .attr(\"stroke\", '#5b5b5b')\n            }\n            const height_path = 30\n            let good = pathtransition[0]\n            let bad = pathtransition[1]\n            // 画中心的前面和后面的路径转移\n            if (flag == \"l\") {\n                svg.append('rect')\n                    .attr(\"x\", 435)\n                    .attr(\"y\", 395)\n                    .attr(\"fill\", _this.better_color)\n                    .attr(\"width\", 13)\n                    .attr(\"height\", height_path * good)\n                    .attr(\"opacity\", 0.8)\n\n                svg.append('rect')\n                    .attr(\"x\", 435)\n                    .attr(\"y\", 395 + height_path * good)\n                    .attr(\"fill\", _this.worse_color)\n                    .attr(\"width\", 13)\n                    .attr(\"height\", height_path * bad)\n                    .attr(\"opacity\", 0.8)\n            } else {\n                svg.append('rect')\n                    .attr(\"x\", 352)\n                    .attr(\"y\", 395)\n                    .attr(\"fill\", _this.better_color)\n                    .attr(\"width\", 13)\n                    .attr(\"height\", height_path * good)\n                    .attr(\"opacity\", 0.8)\n\n                svg.append('rect')\n                    .attr(\"x\", 352)\n                    .attr(\"y\", 395 + height_path * good)\n                    .attr(\"fill\", _this.worse_color)\n                    .attr(\"width\", 13)\n                    .attr(\"height\", height_path * bad)\n                    .attr(\"opacity\", 0.8)\n            }\n        },\n        calculate_node(tree, pattern_data) {\n            const _this = this\n            var result_n1 = []\n            var result_n2 = []\n            // 计算出这个节点的子节点频率最高的四个\n            let tree_keys = Object.keys(tree)\n            let data = {}\n            for (let i = 0; i < tree_keys.length; i++) {\n                data[tree_keys[i]] = tree[tree_keys[i]]['count']\n            }\n            let result = _this.maxnObtain(data, 4)\n            //console.log(\"the four nodes next\", result)\n            for (let i = 0; i < result.length; i++) {\n                _this.all_nodes = []\n                _this.traverseTree(tree[result[i][0]])\n                if (_this.all_nodes.length == 0) {\n                    result_n1.push(result[i][0])\n                    result_n2.push('end')\n                    continue\n                }\n                let transition = [0, 0] //好，坏\n                for (let i = 0; i < _this.all_nodes.length; i++) {\n                    transition[0] += pattern_data[0][_this.all_nodes[i][0]][0] * _this.all_nodes[i][1]\n                    transition[1] += pattern_data[0][_this.all_nodes[i][0]][1] * _this.all_nodes[i][1]\n                }\n                let s1 = transition[0] + transition[1]\n                transition[0] /= s1\n                transition[1] /= s1\n                result_n1.push(result[i])\n                result_n2.push(transition)\n            }\n            return [result_n1, result_n2]\n        },\n        createTreeFromSequences(sequences) {\n            const root = {};\n            sequences.forEach((sequence) => {\n                let currentNode = root\n                sequence.forEach((value) => {\n                    if (!currentNode[value]) {\n                        currentNode[value] = {\n                            value,\n                            count: 0,\n                        };\n                    }\n                    currentNode[value].count++\n                    currentNode = currentNode[value]\n                })\n            })\n            return root\n        },\n        traverseTree(node) {\n            const _this = this\n            if (typeof node === \"object\") {\n                _this.all_nodes.push([node.value, node.count])\n                const childNodes = Object.values(node);\n                childNodes.forEach((childNode) => {\n                    if (typeof childNode === \"object\") {\n                        _this.traverseTree(childNode);\n                    }\n                });\n            }\n        },\n        drawIndividualSequence(stage_number, data, x_start, y_start, pattern_data) {\n            const svg = d3.select(\".eventprogression\").append(\"g\")\n                .attr(\"class\", \"svg\")\n                .attr(\"width\", 800)\n                .attr(\"height\", 750)\n                .attr(\"transform\", \"translate(0, \" + (y_start + 10) + \")\")\n            const width = 800\n            const height = 350\n            const _this = this\n            const user_number = data.length\n\n            const domain_x = []\n            for (let i = 0; i < stage_number; i++) {\n                domain_x.push(i)\n            }\n            const color = d3.scaleOrdinal()\n                .domain(domain_x)\n                .range(_this.color_list)\n\n            const x_scale = d3.scaleLinear()\n                .range([x_start + 10, x_start + 100])\n                .domain([0, 5])\n\n            const y_scale = d3.scaleLinear()\n                .range([y_start + 40, y_start + 40 + height])\n                .domain([0, 20])\n\n            for (let i = 0; i < 35; i++) {\n                var latter_together = 0\n                for (let j = 0; j < data[i].length; j++) {\n                    if (latter_together == 0) {\n                        // 判断后面还有多少个数据\n                        let latter_num = data[i].length - j - 1\n                        var value = 0\n                        //最多不考虑超过3个数据\n                        if (latter_num > 3) {\n                            latter_num = 3\n                        }\n                        if (latter_num == 0) {\n                            let value_arr = pattern_data[0][data[i][j][0][0].toString()]\n                            value = value_arr[0] - value_arr[1]\n                        } else {\n                            for (let t = latter_num; t >= 0; t--) {\n                                // 后面跟几个数据点\n                                var key_temp = data[i][j][0][0].toString()\n                                for (let p = 1; p <= t; p++) {\n                                    key_temp = key_temp + data[i][j + p][0][0].toString()\n                                }\n                                if (pattern_data[1].includes(key_temp)) {\n                                    latter_together = t\n                                    let value_arr = pattern_data[0][key_temp]\n                                    value = value_arr[0] - value_arr[1]\n                                    break\n                                }\n                            }\n                        }\n                        svg.append(\"rect\")\n                            .attr(\"x\", x_scale(j) - 7)\n                            .attr(\"y\", y_scale(i) - 8)\n                            .attr(\"width\", x_scale(j + latter_together) - x_scale(j) + 14)\n                            .attr(\"height\", 15)\n                            .attr(\"fill\", function () {\n                                if (value > 0) {\n                                    return _this.better_color\n                                } else {\n                                    return _this.worse_color\n                                }\n                            })\n                            .attr(\"opacity\", function () {\n                                //console.log(pattern_data)\n                                if (value < 0) {\n                                    return 0.6 + (-value)\n                                } else {\n                                    return 0.6 + (value)\n                                }\n                            })\n                        latter_together = latter_together + 1\n                    }\n                    svg.append(\"circle\")\n                        .attr(\"cx\", x_scale(j))\n                        .attr(\"cy\", y_scale(i))\n                        .attr(\"r\", 6)\n                        .attr(\"stroke\", \"#5b5b5b\")\n                        .attr(\"fill\", color(data[i][j][0][0]))\n                    latter_together = latter_together - 1\n                }\n            }\n        },\n        deepClone(initalObj, finalObj) {\n            var obj = finalObj || {};\n            for (var i in initalObj) {\n                var prop = initalObj[i];        // 避免相互引用对象导致死循环，如initalObj.a = initalObj的情况\n                if (prop === obj) {\n                    continue;\n                }\n                if (typeof prop === 'object') {\n                    obj[i] = (prop.constructor === Array) ? [] : {};\n                    arguments.callee(prop, obj[i]);\n                } else {\n                    obj[i] = prop;\n                }\n            }\n            return obj;\n        },\n        draweventprogressionSankey(stage_number, data, pattern_data) {\n            const y_start = 0\n            const domain_x = []\n            const _this = this\n            for (let i = 0; i < stage_number; i++) {\n                domain_x.push(i)\n            }\n            const color = d3.scaleOrdinal()\n                .domain(domain_x)\n                .range(_this.color_list)\n            const width = 850\n            const height = 400\n            const user_number = data.length\n            const svg = d3.select(\".eventprogression\").append(\"g\")\n                .attr(\"class\", \"progressionoverview\")\n                .attr(\"width\", 850)\n                .attr(\"height\", 450)\n                .attr(\"transform\", \"translate(0, 10)\")\n\n            var stages = []\n            for (let i = 0; i < stage_number; i++) {\n                stages.push(i)\n            }\n\n            var data_sequence = []\n            for (let i = 0; i < user_number; i++) {//对于每一个人\n                let individual_sequence = []\n                for (let j = 0; j < data[i].length - 1; j++) {//对于每一个时间\n                    individual_sequence.push(data[i][j][0][0])\n                }\n                data_sequence.push(individual_sequence)\n            }\n\n            var key_sequence = []\n            var value_sequence = []\n            // 计算每个点属于什么pattern，相当于给每个点赋予pattern key\n            for (let i = 0; i < data_sequence.length; i++) {\n                let latter_together = 0\n                let individual_key = []\n                let individual_value = []\n                for (let j = 0; j < data_sequence[i].length; j++) {\n                    if (latter_together == 0) {\n                        // 判断后面还有多少个数据\n                        let latter_num = data_sequence[i].length - j - 1\n                        var value = 0\n                        var key_temp = ''\n                        //最多不考虑超过1个数据\n                        if (latter_num > 1) {\n                            latter_num = 1\n                        }\n                        if (latter_num == 0) {\n                            let value_arr = pattern_data[0][data_sequence[i][j].toString()]\n                            value = value_arr[0] - value_arr[1]\n                            key_temp = data_sequence[i][j].toString()\n                        } else {\n                            for (let t = latter_num; t >= 0; t--) {\n                                // 后面跟几个数据点\n                                key_temp = data_sequence[i][j].toString()\n                                for (let p = 1; p <= t; p++) {\n                                    key_temp = key_temp + data_sequence[i][j + p].toString()\n                                }\n                                if (pattern_data[1].includes(key_temp)) {\n                                    latter_together = t\n                                    let value_arr = pattern_data[0][key_temp]\n                                    value = value_arr[0] - value_arr[1]\n                                    break\n                                }\n                            }\n                        }\n                        for (let t = 0; t < latter_together + 1; t++) {\n                            individual_key.push(key_temp)\n                            individual_value.push(value)\n                        }\n                        latter_together = latter_together + 1\n                    }\n                    latter_together = latter_together - 1\n                }\n                key_sequence.push(individual_key)\n                value_sequence.push(individual_value)\n            }\n\n            // 需要对每一个时间点维持一个矩阵「1-1，1-2，1-3，....」分别有多少人\n            var time_matrix = {}\n            for (let i = 0; i < data_sequence.length; i++) {\n                for (let j = 0; j < data_sequence[i].length; j++) {\n                    let current_stage = data_sequence[i][j]\n                    let next_stage = 'x'\n                    if (j < data_sequence[i].length - 1) {\n                        next_stage = data_sequence[i][j + 1]\n                    }\n                    let key_transition = current_stage.toString() + next_stage.toString()\n                    if (Object.keys(time_matrix).includes(j.toString())) {\n                        if (Object.keys(time_matrix[j.toString()]).includes(key_transition)) {\n                            time_matrix[j.toString()][key_transition] = time_matrix[j.toString()][key_transition] + 1\n                        } else {\n                            time_matrix[j.toString()][key_transition] = 1\n                        }\n                    } else {\n                        time_matrix[j.toString()] = {}\n                        time_matrix[j.toString()][key_transition] = 1\n                    }\n                }\n            }\n            const overall_scale = 500 / data.length * 0.6\n            const x_scale = d3.scaleLinear()\n                .domain([0, Object.keys(time_matrix).length - 1])\n                .range([20, 830])\n            const y_scale = 0.5 * overall_scale\n            const svg_node_boundingbox = svg.append('g')\n                .attr(\"width\", 250)\n                .attr(\"height\", 300)\n            // 记录每个节点开始的位置\n            let y_position = {}\n            let y_position2 = {}\n            let y_position_end = new Array()\n            // 先画出了最后一列的其他所有列\n            for (let i = 0; i < Object.keys(time_matrix).length; i++) {\n                var y_start_temp = 30\n                for (let p = 0; p < stage_number; p++) {\n                    let key_tt = i.toString() + p.toString()\n                    //console.log(key_tt)\n                    y_position_end[key_tt] = y_start_temp\n                    //console.log(y_position_end)\n                    for (let q = 0; q < stage_number; q++) {\n                        let key_t = p.toString() + q.toString()\n                        if (Object.keys(time_matrix[i]).includes(key_t)) {\n                            if (Object.keys(y_position).includes(i.toString())) {\n                                y_position[i.toString()][key_t] = y_start_temp\n                                y_position2[i.toString()][key_t] = y_start_temp\n                            } else {\n                                y_position[i.toString()] = {}\n                                y_position2[i.toString()] = {}\n                                y_position[i.toString()][key_t] = y_start_temp\n                                y_position2[i.toString()][key_t] = y_start_temp\n                            }\n                            y_start_temp = y_start_temp + y_scale * time_matrix[i][key_t]\n                        }\n                    }\n                    let key_t = p.toString() + 'x' //考虑最末尾的位置\n                    if (Object.keys(y_position).includes(i.toString())) {\n                        y_position[i.toString()][key_t] = y_start_temp\n                    } else {\n                        y_position[i.toString()] = {}\n                        y_position[i.toString()][key_t] = y_start_temp\n                    }\n                    if (Object.keys(time_matrix[i]).includes(key_t)) {\n                        y_start_temp = y_start_temp + y_scale * time_matrix[i][key_t]\n                    }\n                    y_start_temp = y_start_temp + 10\n                }\n            }\n            // 画link\n            const h_scale = 0.5 * overall_scale\n            const svg_link1 = svg.append('g')\n                .attr(\"width\", 250)\n                .attr(\"height\", 300)\n                .style(\"z-index\", 1)\n                .attr(\"transform\", \"translate(0, 5)\")\n\n            const svg_link2 = svg.append('g')\n                .attr(\"width\", 250)\n                .attr(\"height\", 300)\n                .style(\"z-index\", 2)\n                .attr(\"transform\", \"translate(0, 5)\")\n\n            const lineGenerator = d3.line()\n                .x(function (d) { return d.x; })\n                .y(function (d) { return d.y; })\n                .curve(d3.curveCatmullRom.alpha(0.5))\n            let y_position_keys = Object.keys(y_position)\n            for (let i = 0; i < y_position_keys.length - 1; i++) {//第几个时间\n                let y_position_keys2 = Object.keys(y_position[i])//该时间的stage-stage\n                for (let p = 0; p < stage_number; p++) {\n                    for (let q = 0; q < stage_number; q++) {\n                        let current_pair = p.toString() + q.toString()\n                        if (y_position_keys2.includes(current_pair)) {\n                            let current_y = y_position2[y_position_keys[i]][current_pair]\n                            let next_stage = q.toString()\n                            if (next_stage != 'x') {\n                                let key_tt = y_position_keys[i] + next_stage\n                                let key_tt_next = (parseInt(y_position_keys[i]) + 1).toString() + next_stage\n                                let next_y = y_position_end[key_tt_next]\n                                let height_temp = time_matrix[y_position_keys[i]][current_pair] * h_scale\n                                let data_temp = [\n                                    { x: x_scale(i) + 15, y: current_y + height_temp / 2 },\n                                    { x: x_scale(i) + 25, y: current_y + height_temp / 2 },\n                                    { x: x_scale(i + 1) - 5, y: next_y + height_temp / 2 },\n                                    { x: x_scale(i + 1) + 10, y: next_y + height_temp / 2 }\n                                ]\n                                if (height_temp > 10) {\n                                    svg_link2.append(\"path\")\n                                        .datum(data_temp)\n                                        .attr(\"fill\", \"none\")\n                                        .attr(\"stroke\", _this.sankey_linecolor)\n                                        .attr(\"stroke-width\", height_temp)\n                                        .attr(\"opacity\", 0.5)\n                                        .attr(\"d\", lineGenerator);\n                                } else {\n                                    svg_link1.append(\"path\")\n                                        .datum(data_temp)\n                                        .attr(\"fill\", \"none\")\n                                        .attr(\"stroke\", _this.sankey_linecolor)\n                                        .attr(\"stroke-width\", height_temp)\n                                        .attr(\"opacity\", 0.2)\n                                        .attr(\"d\", lineGenerator);\n                                }\n\n                                y_position_end[key_tt_next] = y_position_end[key_tt_next] + height_temp\n                            }\n                        }\n                    }\n                }\n            }\n\n            const svg_node = svg.append('g')\n                .attr(\"width\", 250)\n                .attr(\"height\", 300)\n                .attr(\"transform\", \"translate(0, 5)\")\n            for (let i = 0; i < data_sequence.length; i++) {\n                let y_last = 0\n                for (let j = 0; j < data_sequence[i].length; j++) {\n                    let key_t = ''\n                    if (j == data_sequence[i].length - 1) {\n                        key_t = data_sequence[i][j].toString() + 'x'\n                    } else {\n                        key_t = data_sequence[i][j].toString() + data_sequence[i][j + 1].toString()\n                    }\n                    svg_node.append('rect')\n                        .attr('x', x_scale(j))\n                        .attr('y', y_position[j][key_t])\n                        .attr('height', y_scale)\n                        .attr('width', 20)\n                        .attr('fill', color(data_sequence[i][j]))\n                        .attr('stroke', color(data_sequence[i][j]))\n                        .attr('class', 'node' + key_sequence[i][j])\n\n                    y_position[j][key_t] = y_position[j][key_t] + y_scale\n                    //画link，跟上一个点连起来，但是这不是sankey的画法\n                    // if (j != 0){\n                    //     svg_node.append('line')\n                    //         .attr(\"x1\", x_scale(j))\n                    //         .attr(\"x2\", x_scale(j-1) + 20)\n                    //         .attr(\"y1\", y_position[j][key_t])\n                    //         .attr(\"y2\", y_last)\n                    //         .attr(\"stroke\", \"black\")\n                    // }\n                    y_last = y_position[j][key_t]\n                }\n            }\n\n        },\n        draweventprogression(stage_number, data, y_start) {\n            //console.log(\"event progression view\", data)\n            const width = 800\n            const height = 750\n            const _this = this\n            const user_number = data.length\n            const svg = d3.select(\".eventprogression\").append(\"g\")\n                .attr(\"class\", \"svg\")\n                .attr(\"width\", 800)\n                .attr(\"height\", 750)\n                .attr(\"transform\", \"translate(0, \" + (y_start + 10) + \")\")\n\n            var data_dic = new Array()\n            for (let i = 0; i < 27; i++) {\n                data_dic[i] = new Array()\n                for (let j = 0; j < stage_number; j++) {\n                    data_dic[i][j] = 0\n                }\n            }\n\n            var subgroups = []\n            for (let j = 0; j < stage_number; j++) {\n                subgroups.push('stage' + j)\n            }\n\n            for (let i = 0; i < data.length; i++) { //第i个人\n                for (let j = 0; j < data[i].length; j++) {\n                    if (j == 27) {\n                        continue\n                    }\n                    let stage = data[i][j][3]\n                    data_dic[j][stage] += 1\n                }\n            }\n\n            var data_vis = []\n            for (let i = 0; i < 27; i++) {\n                let temp = new Array()\n                temp[\"group\"] = i + 1\n                for (let j = 0; j < stage_number; j++) {\n                    temp[\"stage\" + j] = data_dic[i][j]\n                }\n                data_vis.push(temp)\n            }\n\n            data = data_vis\n\n            var groups = d3.map(data, function (d) { return (d.group) }).keys()\n\n            // Add X axis\n            var x = d3.scaleBand()\n                .domain(groups)\n                .range([20, width])\n                .padding([0.2])\n            svg.append(\"g\")\n                .attr(\"transform\", \"translate(0,\" + height + \")\")\n                .call(d3.axisBottom(x).tickSizeOuter(0))\n\n            // Add Y axis\n            var y = d3.scaleLinear()\n                .domain([0, user_number])\n                .range([height, 20])\n            svg.append(\"g\")\n                .call(d3.axisLeft(y))\n                .attr(\"transform\", \"translate(27, 0)\")\n\n            // color palette = one color per subgroup\n            var color = d3.scaleOrdinal()\n                .domain(subgroups)\n                .range(d3.schemeTableau10)\n\n            // 把每个stage对应的颜色打印出来\n            if (y_start == 0) {\n                for (let c = 0; c < subgroups.length; c++) {\n                    svg.append(\"rect\")\n                        .attr(\"x\", 10 + c * 60)\n                        .attr(\"y\", 3)\n                        .attr(\"fill\", color(subgroups[c]))\n                        .attr(\"width\", 10)\n                        .attr(\"height\", 10)\n\n                    svg.append(\"text\")\n                        .attr(\"x\", 10 + c * 60 + 15)\n                        .attr(\"y\", 10)\n                        .attr(\"font-size\", 7)\n                        .text(subgroups[c])\n                }\n            }\n\n            //stack the data? --> stack per subgroup\n            var stackedData = d3.stack()\n                .keys(subgroups)(data)\n\n            //console.log(stackedData)\n\n            svg.append(\"g\")\n                .selectAll(\"g\")\n                // Enter in the stack data = loop key per key = group per group\n                .data(stackedData)\n                .join(\"g\")\n                .attr(\"fill\", d => color(d.key))\n                .attr(\"class\", d => \"myRect \" + d.key) // Add a class to each subgroup: their name\n                .selectAll(\"rect\")\n                // enter a second time = loop subgroup per subgroup to add all rectangles\n                .data(d => d)\n                .join(\"rect\")\n                .attr(\"x\", d => x(d.data.group))\n                .attr(\"y\", d => y(d[1]))\n                .attr(\"height\", d => y(d[0]) - y(d[1]))\n                .attr(\"width\", x.bandwidth())\n                .attr(\"stroke\", \"#5b5b5b\")\n                .on(\"mouseover\", function (event, d) { // What happens when user hover a bar\n                    // what subgroup are we hovering\n                    const subGroupName = d3.select(this.parentNode).datum().key\n                    // Reduce opacity of all rect to 0.2\n                    d3.selectAll(\".myRect\").style(\"opacity\", 0.2)\n                    // Highlight all rects of this subgroup with opacity 1. It is possible to select them since they have a specific class = their name.\n                    d3.selectAll(\".\" + subGroupName).style(\"opacity\", 1)\n                })\n                .on(\"mouseleave\", function (event, d) { // When user do not hover anymore\n                    d3.selectAll(\".myRect\")\n                        .style(\"opacity\", 1)\n                })\n        }\n    }\n}"]}]}